<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapitre 3 Agrégation socio-spatiale | Projet DATA MINING 2021</title>
  <meta name="description" content="Titre du cours" />
  <meta name="generator" content="bookdown 0.21 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapitre 3 Agrégation socio-spatiale | Projet DATA MINING 2021" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="Titre du cours" />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapitre 3 Agrégation socio-spatiale | Projet DATA MINING 2021" />
  
  <meta name="twitter:description" content="Titre du cours" />
  

<meta name="author" content="Claude Grasland et Camille Signoretto" />


<meta name="date" content="2021-03-29" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="12-Stat.html"/>
<link rel="next" href="22-cartographie.html"/>
<script src="libs/header-attrs-2.6/header-attrs.js"></script>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<script src="libs/accessible-code-block-0.0.1/empty-anchor.js"></script>
<script src="libs/htmlwidgets-1.5.3/htmlwidgets.js"></script>
<link href="libs/leaflet-1.3.1/leaflet.css" rel="stylesheet" />
<script src="libs/leaflet-1.3.1/leaflet.js"></script>
<link href="libs/leafletfix-1.0.0/leafletfix.css" rel="stylesheet" />
<script src="libs/Proj4Leaflet-1.0.1/proj4-compressed.js"></script>
<script src="libs/Proj4Leaflet-1.0.1/proj4leaflet.js"></script>
<link href="libs/rstudio_leaflet-1.3.1/rstudio_leaflet.css" rel="stylesheet" />
<script src="libs/leaflet-binding-2.0.3/leaflet.js"></script>
<script src="libs/leaflet-providers-1.9.0/leaflet-providers_1.9.0.js"></script>
<script src="libs/leaflet-providers-plugin-2.0.3/leaflet-providers-plugin.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    background-color: #ffffff;
    color: #a0a0a0;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #a0a0a0;  padding-left: 4px; }
div.sourceCode
  { color: #1f1c1b; background-color: #ffffff; }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span. { color: #1f1c1b; } /* Normal */
code span.al { color: #bf0303; background-color: #f7e6e6; font-weight: bold; } /* Alert */
code span.an { color: #ca60ca; } /* Annotation */
code span.at { color: #0057ae; } /* Attribute */
code span.bn { color: #b08000; } /* BaseN */
code span.bu { color: #644a9b; font-weight: bold; } /* BuiltIn */
code span.cf { color: #1f1c1b; font-weight: bold; } /* ControlFlow */
code span.ch { color: #924c9d; } /* Char */
code span.cn { color: #aa5500; } /* Constant */
code span.co { color: #898887; } /* Comment */
code span.cv { color: #0095ff; } /* CommentVar */
code span.do { color: #607880; } /* Documentation */
code span.dt { color: #0057ae; } /* DataType */
code span.dv { color: #b08000; } /* DecVal */
code span.er { color: #bf0303; text-decoration: underline; } /* Error */
code span.ex { color: #0095ff; font-weight: bold; } /* Extension */
code span.fl { color: #b08000; } /* Float */
code span.fu { color: #644a9b; } /* Function */
code span.im { color: #ff5500; } /* Import */
code span.in { color: #b08000; } /* Information */
code span.kw { color: #1f1c1b; font-weight: bold; } /* Keyword */
code span.op { color: #1f1c1b; } /* Operator */
code span.ot { color: #006e28; } /* Other */
code span.pp { color: #006e28; } /* Preprocessor */
code span.re { color: #0057ae; background-color: #e0e9f8; } /* RegionMarker */
code span.sc { color: #3daee9; } /* SpecialChar */
code span.ss { color: #ff5500; } /* SpecialString */
code span.st { color: #bf0303; } /* String */
code span.va { color: #0057ae; } /* Variable */
code span.vs { color: #bf0303; } /* VerbatimString */
code span.wa { color: #bf0303; } /* Warning */
</style>

<link rel="stylesheet" href="css/tidyverse.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./index.html">Projet Data Mining 2021  <em>C. Grasland (2021) & Camille Signoretto</em></a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="00-presentation.html"><a href="00-presentation.html"><i class="fa fa-check"></i>Présentation</a>
<ul>
<li class="chapter" data-level="" data-path="00-presentation.html"><a href="00-presentation.html#à-propos-de-ce-document"><i class="fa fa-check"></i>À propos de ce document</a></li>
<li class="chapter" data-level="" data-path="00-presentation.html"><a href="00-presentation.html#prérequis"><i class="fa fa-check"></i>Prérequis</a></li>
<li class="chapter" data-level="" data-path="00-presentation.html"><a href="00-presentation.html#remerciements"><i class="fa fa-check"></i>Remerciements</a></li>
<li class="chapter" data-level="" data-path="00-presentation.html"><a href="00-presentation.html#licence"><i class="fa fa-check"></i>Licence</a></li>
</ul></li>
<li class="chapter" data-level="1" data-path="11-data.html"><a href="11-data.html"><i class="fa fa-check"></i><b>1</b> Collecte de données statistiques et spatiales</a>
<ul>
<li class="chapter" data-level="1.1" data-path="11-data.html"><a href="11-data.html#introduction"><i class="fa fa-check"></i><b>1.1</b> Introduction</a></li>
<li class="chapter" data-level="1.2" data-path="11-data.html"><a href="11-data.html#données-statistiques-sur-les-individus"><i class="fa fa-check"></i><b>1.2</b> Données statistiques sur les individus</a>
<ul>
<li class="chapter" data-level="1.2.1" data-path="11-data.html"><a href="11-data.html#etape-1-téléchargement-des-données-et-stockage-temporaire"><i class="fa fa-check"></i><b>1.2.1</b> Etape 1 : téléchargement des données et stockage temporaire</a></li>
<li class="chapter" data-level="1.2.2" data-path="11-data.html"><a href="11-data.html#etape-2-transformation-des-données-au-format-r"><i class="fa fa-check"></i><b>1.2.2</b> Etape 2 : Transformation des données au format R</a></li>
<li class="chapter" data-level="1.2.3" data-path="11-data.html"><a href="11-data.html#etape-3-sélection-des-données-utiles-et-sauvegarde-au-format-.rdata"><i class="fa fa-check"></i><b>1.2.3</b> Etape 3 : Sélection des données utiles et sauvegarde au format .Rdata</a></li>
</ul></li>
<li class="chapter" data-level="1.3" data-path="11-data.html"><a href="11-data.html#données-statistiques-sur-les-logements-ordinaires"><i class="fa fa-check"></i><b>1.3</b> Données statistiques sur les logements ordinaires</a>
<ul>
<li class="chapter" data-level="1.3.1" data-path="11-data.html"><a href="11-data.html#etape-1-récupération-des-fichiers"><i class="fa fa-check"></i><b>1.3.1</b> Etape 1 : récupération des fichiers</a></li>
<li class="chapter" data-level="1.3.2" data-path="11-data.html"><a href="11-data.html#etape-2-transformation-des-données-au-format-r-1"><i class="fa fa-check"></i><b>1.3.2</b> Etape 2 : Transformation des données au format R</a></li>
<li class="chapter" data-level="1.3.3" data-path="11-data.html"><a href="11-data.html#etape-3-sélection-des-données-utiles-et-sauvegarde-au-format-.rdata-1"><i class="fa fa-check"></i><b>1.3.3</b> Etape 3 : Sélection des données utiles et sauvegarde au format .Rdata</a></li>
</ul></li>
<li class="chapter" data-level="1.4" data-path="11-data.html"><a href="11-data.html#données-géométriques"><i class="fa fa-check"></i><b>1.4</b> Données géométriques</a>
<ul>
<li class="chapter" data-level="1.4.1" data-path="11-data.html"><a href="11-data.html#etape-1-récupération-du-fonds-iris-au-format-shapefile"><i class="fa fa-check"></i><b>1.4.1</b> Etape 1 : récupération du fonds IRIS au format shapefile</a></li>
<li class="chapter" data-level="1.4.2" data-path="11-data.html"><a href="11-data.html#etape-2-importation-et-transformation-au-format-sf"><i class="fa fa-check"></i><b>1.4.2</b> Etape 2 : Importation et transformation au format sf</a></li>
<li class="chapter" data-level="1.4.3" data-path="11-data.html"><a href="11-data.html#etape-3-extraction-des-iris-de-la-zone-détude"><i class="fa fa-check"></i><b>1.4.3</b> Etape 3 : Extraction des IRIS de la zone d’étude</a></li>
<li class="chapter" data-level="1.4.4" data-path="11-data.html"><a href="11-data.html#etape-4-création-dun-fonds-de-carte-des-communes"><i class="fa fa-check"></i><b>1.4.4</b> Etape 4 : création d’un fonds de carte des communes</a></li>
<li class="chapter" data-level="1.4.5" data-path="11-data.html"><a href="11-data.html#etape-5-création-dun-fonds-de-carte-par-département"><i class="fa fa-check"></i><b>1.4.5</b> Etape 5 : création d’un fonds de carte par département</a></li>
<li class="chapter" data-level="1.4.6" data-path="11-data.html"><a href="11-data.html#etape-6-superposition-des-trois-fonds-de-carte"><i class="fa fa-check"></i><b>1.4.6</b> Etape 6: Superposition des trois fonds de carte</a></li>
</ul></li>
<li class="chapter" data-level="1.5" data-path="11-data.html"><a href="11-data.html#bilan-et-nettoyage"><i class="fa fa-check"></i><b>1.5</b> Bilan et nettoyage</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="12-Stat.html"><a href="12-Stat.html"><i class="fa fa-check"></i><b>2</b> Analyse statistique et visualisation graphique</a>
<ul>
<li class="chapter" data-level="2.1" data-path="12-Stat.html"><a href="12-Stat.html#introduction-1"><i class="fa fa-check"></i><b>2.1</b> Introduction</a>
<ul>
<li class="chapter" data-level="2.1.1" data-path="12-Stat.html"><a href="12-Stat.html#les-données-du-recensement-de-la-population-rp"><i class="fa fa-check"></i><b>2.1.1</b> Les données du Recensement de la Population (RP)</a></li>
<li class="chapter" data-level="2.1.2" data-path="12-Stat.html"><a href="12-Stat.html#quelles-variables-sont-présentes-dans-les-données-quelle-spécificité"><i class="fa fa-check"></i><b>2.1.2</b> Quelles variables sont présentes dans les données ? Quelle spécificité ?</a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="12-Stat.html"><a href="12-Stat.html#quelques-statistiques-sur-les-logements-et-ménages"><i class="fa fa-check"></i><b>2.2</b> Quelques statistiques sur les logements et ménages</a></li>
<li class="chapter" data-level="2.3" data-path="12-Stat.html"><a href="12-Stat.html#quelles-caractéristiques-des-individus-résidant-dans-le-val-de-marne-en-2017"><i class="fa fa-check"></i><b>2.3</b> Quelles caractéristiques des individus résidant dans le Val de Marne en 2017 ?</a></li>
<li class="chapter" data-level="2.4" data-path="12-Stat.html"><a href="12-Stat.html#la-création-de-fonctions"><i class="fa fa-check"></i><b>2.4</b> La création de fonctions</a>
<ul>
<li class="chapter" data-level="2.4.1" data-path="12-Stat.html"><a href="12-Stat.html#création-dune-fonction-pour-retourner-un-tableau"><i class="fa fa-check"></i><b>2.4.1</b> Création d’une fonction pour retourner un tableau</a></li>
<li class="chapter" data-level="2.4.2" data-path="12-Stat.html"><a href="12-Stat.html#création-dune-fonction-pour-retourner-un-graphique"><i class="fa fa-check"></i><b>2.4.2</b> Création d’une fonction pour retourner un graphique</a></li>
<li class="chapter" data-level="2.4.3" data-path="12-Stat.html"><a href="12-Stat.html#création-dune-seule-fonction-comprenant-tableau-et-graphe"><i class="fa fa-check"></i><b>2.4.3</b> Création d’une seule fonction comprenant tableau et graphe</a></li>
<li class="chapter" data-level="2.4.4" data-path="12-Stat.html"><a href="12-Stat.html#et-pour-distinguer-par-groupe-et-pour-avoir-des-moyennes"><i class="fa fa-check"></i><b>2.4.4</b> Et pour distinguer par groupe ? Et pour avoir des moyennes… ?</a></li>
<li class="chapter" data-level="2.4.5" data-path="12-Stat.html"><a href="12-Stat.html#enregistrerstocker-ses-fonctions"><i class="fa fa-check"></i><b>2.4.5</b> Enregistrer/Stocker ses fonctions</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="21-socio-spatial.html"><a href="21-socio-spatial.html"><i class="fa fa-check"></i><b>3</b> Agrégation socio-spatiale</a>
<ul>
<li class="chapter" data-level="3.1" data-path="21-socio-spatial.html"><a href="21-socio-spatial.html#objectifs"><i class="fa fa-check"></i><b>3.1</b> Objectifs</a>
<ul>
<li class="chapter" data-level="3.1.1" data-path="21-socio-spatial.html"><a href="21-socio-spatial.html#ménages-ou-habitants"><i class="fa fa-check"></i><b>3.1.1</b> Ménages ou habitants ?</a></li>
<li class="chapter" data-level="3.1.2" data-path="21-socio-spatial.html"><a href="21-socio-spatial.html#département-commune-ou-iris"><i class="fa fa-check"></i><b>3.1.2</b> Département, commune ou IRIS ?</a></li>
<li class="chapter" data-level="3.1.3" data-path="21-socio-spatial.html"><a href="21-socio-spatial.html#tableaux-de-contingence-et-tableaux-de-profil"><i class="fa fa-check"></i><b>3.1.3</b> Tableaux de contingence et tableaux de profil</a></li>
<li class="chapter" data-level="3.1.4" data-path="21-socio-spatial.html"><a href="21-socio-spatial.html#packages-utilisés"><i class="fa fa-check"></i><b>3.1.4</b> Packages utilisés</a></li>
<li class="chapter" data-level="3.1.5" data-path="21-socio-spatial.html"><a href="21-socio-spatial.html#choix-dune-commune"><i class="fa fa-check"></i><b>3.1.5</b> Choix d’une commune</a></li>
<li class="chapter" data-level="3.1.6" data-path="21-socio-spatial.html"><a href="21-socio-spatial.html#chargement-des-données"><i class="fa fa-check"></i><b>3.1.6</b> Chargement des données</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="21-socio-spatial.html"><a href="21-socio-spatial.html#fichier-de-référence"><i class="fa fa-check"></i><b>3.2</b> Fichier de référence</a>
<ul>
<li class="chapter" data-level="3.2.1" data-path="21-socio-spatial.html"><a href="21-socio-spatial.html#nombre-total-dhabitants-et-de-ménages-de-la-commune"><i class="fa fa-check"></i><b>3.2.1</b> Nombre total d’habitants et de ménages de la commune</a></li>
<li class="chapter" data-level="3.2.2" data-path="21-socio-spatial.html"><a href="21-socio-spatial.html#nombre-dhabitants-et-de-ménages-par-iris"><i class="fa fa-check"></i><b>3.2.2</b> Nombre d’habitants et de ménages par IRIS</a></li>
<li class="chapter" data-level="3.2.3" data-path="21-socio-spatial.html"><a href="21-socio-spatial.html#ajout-de-la-géométrie"><i class="fa fa-check"></i><b>3.2.3</b> Ajout de la géométrie</a></li>
<li class="chapter" data-level="3.2.4" data-path="21-socio-spatial.html"><a href="21-socio-spatial.html#automatisation-du-travail"><i class="fa fa-check"></i><b>3.2.4</b> Automatisation du travail</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="22-cartographie.html"><a href="22-cartographie.html"><i class="fa fa-check"></i><b>4</b> Cartographie</a>
<ul>
<li class="chapter" data-level="4.1" data-path="22-cartographie.html"><a href="22-cartographie.html#objectifs-1"><i class="fa fa-check"></i><b>4.1</b> Objectifs</a>
<ul>
<li class="chapter" data-level="4.1.1" data-path="22-cartographie.html"><a href="22-cartographie.html#packages-utilisés-1"><i class="fa fa-check"></i><b>4.1.1</b> Packages utilisés</a></li>
<li class="chapter" data-level="4.1.2" data-path="22-cartographie.html"><a href="22-cartographie.html#chargement-des-données-1"><i class="fa fa-check"></i><b>4.1.2</b> Chargement des données</a></li>
</ul></li>
<li class="chapter" data-level="4.2" data-path="22-cartographie.html"><a href="22-cartographie.html#préparation-du-tableau-de-données"><i class="fa fa-check"></i><b>4.2</b> Préparation du tableau de données</a>
<ul>
<li class="chapter" data-level="4.2.1" data-path="22-cartographie.html"><a href="22-cartographie.html#création-du-tableau-de-contingence"><i class="fa fa-check"></i><b>4.2.1</b> Création du tableau de contingence</a></li>
<li class="chapter" data-level="4.2.2" data-path="22-cartographie.html"><a href="22-cartographie.html#ajout-dun-tableau-de-pourcentage"><i class="fa fa-check"></i><b>4.2.2</b> Ajout d’un tableau de pourcentage</a></li>
<li class="chapter" data-level="4.2.3" data-path="22-cartographie.html"><a href="22-cartographie.html#estimation-du-nombre-moyen-dautomobile-par-menages"><i class="fa fa-check"></i><b>4.2.3</b> Estimation du nombre moyen d’automobile par menages</a></li>
<li class="chapter" data-level="4.2.4" data-path="22-cartographie.html"><a href="22-cartographie.html#analyse-du-tableau"><i class="fa fa-check"></i><b>4.2.4</b> Analyse du tableau</a></li>
<li class="chapter" data-level="4.2.5" data-path="22-cartographie.html"><a href="22-cartographie.html#sauvegarde-du-tableau-et-jointure-avec-le-fonds-de-carte"><i class="fa fa-check"></i><b>4.2.5</b> Sauvegarde du tableau et jointure avec le fonds de carte</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="22-cartographie.html"><a href="22-cartographie.html#utilisation-du-package-cartography"><i class="fa fa-check"></i><b>4.3</b> Utilisation du package <em>cartography</em></a>
<ul>
<li class="chapter" data-level="4.3.1" data-path="22-cartographie.html"><a href="22-cartographie.html#carte-de-stock"><i class="fa fa-check"></i><b>4.3.1</b> Carte de stock</a></li>
<li class="chapter" data-level="4.3.2" data-path="22-cartographie.html"><a href="22-cartographie.html#carte-dintensité-choroplèthe"><i class="fa fa-check"></i><b>4.3.2</b> Carte d’intensité (choroplèthe)</a></li>
<li class="chapter" data-level="4.3.3" data-path="22-cartographie.html"><a href="22-cartographie.html#carte-de-stock-intensité"><i class="fa fa-check"></i><b>4.3.3</b> Carte de stock + intensité</a></li>
</ul></li>
<li class="chapter" data-level="4.4" data-path="22-cartographie.html"><a href="22-cartographie.html#cartographie-avec-leaflet"><i class="fa fa-check"></i><b>4.4</b> Cartographie avec <em>Leaflet</em></a>
<ul>
<li class="chapter" data-level="4.4.1" data-path="22-cartographie.html"><a href="22-cartographie.html#extraction-du-fonds-de-carte-dune-ou-plusieurs-commune"><i class="fa fa-check"></i><b>4.4.1</b> Extraction du fonds de carte d’une ou plusieurs commune</a></li>
<li class="chapter" data-level="4.4.2" data-path="22-cartographie.html"><a href="22-cartographie.html#projection-et-calcul-des-centres"><i class="fa fa-check"></i><b>4.4.2</b> Projection et calcul des centres</a></li>
<li class="chapter" data-level="4.4.3" data-path="22-cartographie.html"><a href="22-cartographie.html#etape-1-centrage-et-niveau-de-zoom"><i class="fa fa-check"></i><b>4.4.3</b> Etape 1 : centrage et niveau de zoom</a></li>
<li class="chapter" data-level="4.4.4" data-path="22-cartographie.html"><a href="22-cartographie.html#etape-2-choix-des-tuiles"><i class="fa fa-check"></i><b>4.4.4</b> Etape 2 : Choix des tuiles</a></li>
<li class="chapter" data-level="4.4.5" data-path="22-cartographie.html"><a href="22-cartographie.html#etape-3-ajout-dune-carte-choroplèthe"><i class="fa fa-check"></i><b>4.4.5</b> Etape 3 : Ajout d’une carte choroplèthe</a></li>
<li class="chapter" data-level="4.4.6" data-path="22-cartographie.html"><a href="22-cartographie.html#etape-4-ajout-dune-carte-de-stock"><i class="fa fa-check"></i><b>4.4.6</b> Etape 4 : ajout d’une carte de stock</a></li>
<li class="chapter" data-level="4.4.7" data-path="22-cartographie.html"><a href="22-cartographie.html#etape-5-ajout-du-contour-des-communes"><i class="fa fa-check"></i><b>4.4.7</b> Etape 5 : ajout du contour des communes</a></li>
<li class="chapter" data-level="4.4.8" data-path="22-cartographie.html"><a href="22-cartographie.html#etape-6-ajout-dun-curseur-interactif"><i class="fa fa-check"></i><b>4.4.8</b> Etape 6 : Ajout d’un curseur interactif</a></li>
</ul></li>
</ul></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Projet DATA MINING 2021</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="c21-socio-spatial" class="section level1" number="3">
<h1><span class="header-section-number">Chapitre 3</span> Agrégation socio-spatiale</h1>
<div id="objectifs" class="section level2" number="3.1">
<h2><span class="header-section-number">3.1</span> Objectifs</h2>
<p>L’objectif de cette section est de procéder à des <strong>agrégations sociales et spatiales</strong> des données individuelles afin de pouvoir ensuite réaliser des cartes.</p>
<div id="ménages-ou-habitants" class="section level3" number="3.1.1">
<h3><span class="header-section-number">3.1.1</span> Ménages ou habitants ?</h3>
<p>La principale difficulté consistera à choisir les bonnes <strong>pondérations</strong> selon que l’on souhaite :</p>
<ul>
<li>Travailler sur les <strong>ménages</strong> : par exemple pour connaître le nombre de ménages ayant 0, 1, 2 ou plus de 3 automobiles.</li>
<li>Travailler sur les <strong>habitants</strong> : par exemple pour connaître le nombre de personnes ayant plus de 6 ans.</li>
</ul>
</div>
<div id="département-commune-ou-iris" class="section level3" number="3.1.2">
<h3><span class="header-section-number">3.1.2</span> Département, commune ou IRIS ?</h3>
<p>On devra aussi s’intéresser aux variables géographiques disponibles pour réaliser des agrégations spatiales différentes selon que l’on souhaite travailler :</p>
<ul>
<li>à l’échelle de l’ensemble du <strong>département</strong> : par exemple, quel est le taux de chômage des actifs du Val de Marne</li>
<li>à l’échelle des <strong>communes</strong> : par exemple, quel est le taux de chômage des actifs de Sucy-en-Brie</li>
<li>à l’échelle des <strong>IRIS</strong> infra-communaux : par exemple, quel est le taux de chômage des actifs du quartier de la Fossse Rouge à Sucy-en Brie.</li>
</ul>
</div>
<div id="tableaux-de-contingence-et-tableaux-de-profil" class="section level3" number="3.1.3">
<h3><span class="header-section-number">3.1.3</span> Tableaux de contingence et tableaux de profil</h3>
<p>Enfin, on fera attention de ne pas mélanger les <strong>stocks</strong> et les <strong>taux</strong> qui correspondent à des tableaux et des variables de nature différente tant pour l’analyse statistique que pour la cartogaphie.</p>
<ul>
<li>Un <strong>tableau de contingence</strong> est un tableau de comptage d’individus (habitants ou ménages) dans lequel on peut effectuer les sommes en ligne ou en colonnes. Par exemple, on peut dénombrer les actifs en fonction de leur catégorie socio-professionnelle et de leur commune de résidence. Chacune des cases du tableau correspondra à un nombre d’actifs.</li>
<li><strong>Un tableau de profil (ou de pourcentage)</strong> est une transformation du tableau de contingence permettant de calculer des pourcentages en ligne ou en colonne. Dans l’exemple précédent, si les lignes correspondent aux communes et les colonnes aux CSP, on peut produire soit un tableau des <strong>profils en lignes</strong> (pourcentage des habitants d’une commune travaillant dans une CSP), soit un tableau des <strong>profils en colonnes</strong> (pourcentage des membres d’une CSP résidant dans une commune).</li>
</ul>
</div>
<div id="packages-utilisés" class="section level3" number="3.1.4">
<h3><span class="header-section-number">3.1.4</span> Packages utilisés</h3>
<p>Nous allons nous limiter à un nombre minimum de package au cours de cette première séance dans la mesure où très peu de réalisations cartographiques seront effectuées.</p>
<ul>
<li><strong>dplyr</strong> : pour la manipulation des tableaux et leur agrégation (inutile de charger l’ensemble du package tidyverse)</li>
<li><strong>knitr</strong> : pour afficher proprement les tableaux de résultats</li>
<li><strong>ggplot2</strong> : pour visualiser les résultats sous formes de graphiques</li>
<li><strong>sf</strong> : pour manipuler les données cartographiques et les agréger</li>
</ul>
<div class="sourceCode" id="cb114"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb114-1"><a href="21-socio-spatial.html#cb114-1"></a><span class="kw">library</span>(knitr)</span>
<span id="cb114-2"><a href="21-socio-spatial.html#cb114-2"></a><span class="kw">library</span>(dplyr)</span>
<span id="cb114-3"><a href="21-socio-spatial.html#cb114-3"></a><span class="kw">library</span>(ggplot2)</span>
<span id="cb114-4"><a href="21-socio-spatial.html#cb114-4"></a><span class="kw">library</span>(sf)</span></code></pre></div>
</div>
<div id="choix-dune-commune" class="section level3" number="3.1.5">
<h3><span class="header-section-number">3.1.5</span> Choix d’une commune</h3>
<p>En prévision du projet, chaque étudiant devra choisir une commune qui fera l’objet d’analyse ciblées. Cette commune devra respecter les conditions suivantes :</p>
<ol style="list-style-type: decimal">
<li>Présence d’au moins 10 IRIS</li>
<li>Population supérieure à 20 000 habitants</li>
<li>Diversité sociale importante avec mélange de quartiers à profils différents</li>
</ol>
<p>Une fois identifiée la commune cible chaque étudiant devra trouver son <strong>code officiel géographique</strong> en tapant son nom sur la page web suivante :</p>
<p><a href="https://www.insee.fr/fr/statistiques/zones/2011101" class="uri">https://www.insee.fr/fr/statistiques/zones/2011101</a></p>
<p>Voici une première liste de communes proposées aux étudiants :</p>
<ul>
<li>Champigny-sur-Marne (94017)</li>
<li>Créteil (94028)</li>
<li>Fontenay-sous-Bois (94033)</li>
<li>Ivry-sur-Seine (94041)</li>
<li>Saint-Maur-des-Fossés (94068)</li>
<li>Vitry-sur-Seine (94081)</li>
<li>Vincennes (94080)</li>
<li>Villejuif (94076)</li>
</ul>
<p>Le cours prendra quant à lui l’exemple de la commune de Sucy-en-Brie (94071)</p>
</div>
<div id="chargement-des-données" class="section level3" number="3.1.6">
<h3><span class="header-section-number">3.1.6</span> Chargement des données</h3>
<p>Nous avons besoin de trois fichiers</p>
<ul>
<li>Le fichier des individus</li>
<li>le fichier des métadonnées relatives aux individus</li>
<li>le fonds de carte des IRIS</li>
</ul>
<div class="sourceCode" id="cb115"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb115-1"><a href="21-socio-spatial.html#cb115-1"></a>indiv &lt;-<span class="st"> </span><span class="kw">readRDS</span>(<span class="st">&quot;data/indiv2017.Rdata&quot;</span>)</span>
<span id="cb115-2"><a href="21-socio-spatial.html#cb115-2"></a>meta &lt;-<span class="st"> </span><span class="kw">readRDS</span>(<span class="st">&quot;data/indiv2017_meta.Rdata&quot;</span>)</span>
<span id="cb115-3"><a href="21-socio-spatial.html#cb115-3"></a>map &lt;-<span class="kw">readRDS</span>(<span class="st">&quot;data/map_iris.Rdata&quot;</span>)</span></code></pre></div>
</div>
</div>
<div id="fichier-de-référence" class="section level2" number="3.2">
<h2><span class="header-section-number">3.2</span> Fichier de référence</h2>
<p>Nous allons apprendre dans un premier temps à calculer pour une commune un fichier de référence comportant le nombre d’habitants et le nombre de ménage de chacun des quartiers IRIS. Puis nous y ajouerons le contour géomérique des quartiers IRIS afin de pouvoir réaliser des cartes par la suite.</p>
<div id="nombre-total-dhabitants-et-de-ménages-de-la-commune" class="section level3" number="3.2.1">
<h3><span class="header-section-number">3.2.1</span> Nombre total d’habitants et de ménages de la commune</h3>
<p>Comme le recensement n’est pas exhaustif, nous devrons pondérer tous nos calculs par la variable IPONDI qui est définie de la façon suivante dans les métadonnées :</p>
<div class="sourceCode" id="cb116"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb116-1"><a href="21-socio-spatial.html#cb116-1"></a>metavar&lt;-meta <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(COD_VAR <span class="op">==</span><span class="st"> &quot;IPONDI&quot;</span>)</span>
<span id="cb116-2"><a href="21-socio-spatial.html#cb116-2"></a><span class="kw">kable</span>(metavar)</span></code></pre></div>
<table>
<thead>
<tr>
<th style="text-align:left;">
COD_VAR
</th>
<th style="text-align:left;">
LIB_VAR
</th>
<th style="text-align:left;">
COD_MOD
</th>
<th style="text-align:left;">
LIB_MOD
</th>
<th style="text-align:left;">
TYPE_VAR
</th>
<th style="text-align:right;">
LONG_VAR
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
IPONDI
</td>
<td style="text-align:left;">
Poids de l’individu
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
CHAR
</td>
<td style="text-align:right;">
17.15
</td>
</tr>
</tbody>
</table>
<div id="nombre-dhabitants-de-la-commune" class="section level4" number="3.2.1.1">
<h4><span class="header-section-number">3.2.1.1</span> nombre d’habitants de la commune</h4>
<p>On commence par créer la variable COM qui n’existe pas mais qui est contenue dans le code IRIS, puis on regroupe par commune et enfin on effectue la somme.</p>
<div class="sourceCode" id="cb117"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb117-1"><a href="21-socio-spatial.html#cb117-1"></a>indiv <span class="op">%&gt;%</span><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">COM =</span> <span class="kw">substr</span>(IRIS,<span class="dv">1</span>,<span class="dv">5</span>)) <span class="op">%&gt;%</span></span>
<span id="cb117-2"><a href="21-socio-spatial.html#cb117-2"></a><span class="st">           </span><span class="kw">filter</span>(COM <span class="op">==</span><span class="st"> &quot;94071&quot;</span>) <span class="op">%&gt;%</span></span>
<span id="cb117-3"><a href="21-socio-spatial.html#cb117-3"></a><span class="st">           </span><span class="kw">summarise</span>(<span class="dt">nbhab =</span> <span class="kw">sum</span>(IPONDI))</span></code></pre></div>
<pre><code># A tibble: 1 x 1
   nbhab
   &lt;dbl&gt;
1 26479.</code></pre>
<p>On constate que la commune de <em>Sucy-en-Brie (94071</em>)* a une population estimée de <em>26479.068</em> habitants.</p>
</div>
<div id="nombre-de-ménage-de-la-commune" class="section level4" number="3.2.1.2">
<h4><span class="header-section-number">3.2.1.2</span> nombre de ménage de la commune</h4>
<p>Pour calculer le nombre de ménages, il faut construire un tablean <em>menag</em> ne comportant que les personnes de références. Nous allons devoir utiliser pour cela la variable <strong>LPRM</strong> dont on affiche les métadonnées :</p>
<div class="sourceCode" id="cb119"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb119-1"><a href="21-socio-spatial.html#cb119-1"></a>metavar&lt;-meta <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(COD_VAR <span class="op">==</span><span class="st"> &quot;LPRM&quot;</span>)</span>
<span id="cb119-2"><a href="21-socio-spatial.html#cb119-2"></a><span class="kw">kable</span>(metavar)</span></code></pre></div>
<table>
<thead>
<tr>
<th style="text-align:left;">
COD_VAR
</th>
<th style="text-align:left;">
LIB_VAR
</th>
<th style="text-align:left;">
COD_MOD
</th>
<th style="text-align:left;">
LIB_MOD
</th>
<th style="text-align:left;">
TYPE_VAR
</th>
<th style="text-align:right;">
LONG_VAR
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
LPRM
</td>
<td style="text-align:left;">
Lien à la personne de référence du ménage
</td>
<td style="text-align:left;">
1
</td>
<td style="text-align:left;">
Personne de référence du ménage
</td>
<td style="text-align:left;">
CHAR
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:left;">
LPRM
</td>
<td style="text-align:left;">
Lien à la personne de référence du ménage
</td>
<td style="text-align:left;">
2
</td>
<td style="text-align:left;">
Conjoint de la personne de référence du ménage
</td>
<td style="text-align:left;">
CHAR
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:left;">
LPRM
</td>
<td style="text-align:left;">
Lien à la personne de référence du ménage
</td>
<td style="text-align:left;">
3
</td>
<td style="text-align:left;">
Enfant de la personne de référence du ménage ou de son conjoint
</td>
<td style="text-align:left;">
CHAR
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:left;">
LPRM
</td>
<td style="text-align:left;">
Lien à la personne de référence du ménage
</td>
<td style="text-align:left;">
4
</td>
<td style="text-align:left;">
Petit-enfant
</td>
<td style="text-align:left;">
CHAR
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:left;">
LPRM
</td>
<td style="text-align:left;">
Lien à la personne de référence du ménage
</td>
<td style="text-align:left;">
5
</td>
<td style="text-align:left;">
Ascendant
</td>
<td style="text-align:left;">
CHAR
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:left;">
LPRM
</td>
<td style="text-align:left;">
Lien à la personne de référence du ménage
</td>
<td style="text-align:left;">
6
</td>
<td style="text-align:left;">
Autre parent
</td>
<td style="text-align:left;">
CHAR
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:left;">
LPRM
</td>
<td style="text-align:left;">
Lien à la personne de référence du ménage
</td>
<td style="text-align:left;">
7
</td>
<td style="text-align:left;">
Ami
</td>
<td style="text-align:left;">
CHAR
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:left;">
LPRM
</td>
<td style="text-align:left;">
Lien à la personne de référence du ménage
</td>
<td style="text-align:left;">
8
</td>
<td style="text-align:left;">
Pensionnaire ou sous-locataire
</td>
<td style="text-align:left;">
CHAR
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:left;">
LPRM
</td>
<td style="text-align:left;">
Lien à la personne de référence du ménage
</td>
<td style="text-align:left;">
9
</td>
<td style="text-align:left;">
Domestique ou salarié logé
</td>
<td style="text-align:left;">
CHAR
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:left;">
LPRM
</td>
<td style="text-align:left;">
Lien à la personne de référence du ménage
</td>
<td style="text-align:left;">
Z
</td>
<td style="text-align:left;">
Hors logement ordinaire
</td>
<td style="text-align:left;">
CHAR
</td>
<td style="text-align:right;">
1
</td>
</tr>
</tbody>
</table>
<p>Ce tableau montre que la modalité “1” correspond précisément aux personnes de références. Il faut donc filtrer le tableau des individus sur la condition <code>LPRF==1</code>pour ne garder que les ménages.On peut alors dénombrer les ménages en appliquant exactement la même procédure de pondération que pour la population :</p>
<div class="sourceCode" id="cb120"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb120-1"><a href="21-socio-spatial.html#cb120-1"></a>indiv <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(LPRM <span class="op">==</span><span class="st"> </span><span class="dv">1</span>) <span class="op">%&gt;%</span></span>
<span id="cb120-2"><a href="21-socio-spatial.html#cb120-2"></a><span class="st">          </span><span class="kw">mutate</span>(<span class="dt">COM =</span> <span class="kw">substr</span>(IRIS,<span class="dv">1</span>,<span class="dv">5</span>)) <span class="op">%&gt;%</span></span>
<span id="cb120-3"><a href="21-socio-spatial.html#cb120-3"></a><span class="st">          </span><span class="kw">filter</span>(COM <span class="op">==</span><span class="st"> &quot;94071&quot;</span>) <span class="op">%&gt;%</span></span>
<span id="cb120-4"><a href="21-socio-spatial.html#cb120-4"></a><span class="st">          </span><span class="kw">summarise</span>(<span class="dt">nbmen =</span> <span class="kw">sum</span>(IPONDI))</span></code></pre></div>
<pre><code># A tibble: 1 x 1
   nbmen
   &lt;dbl&gt;
1 10716.</code></pre>
<p>D’après le tableau obtenu, il y a 7466.732 ménages (ordinaires) dans la commune de Sucy-en-Brie en 2017</p>
</div>
<div id="vérification" class="section level4" number="3.2.1.3">
<h4><span class="header-section-number">3.2.1.3</span> Vérification</h4>
<p>On se rend sur le site de l’INSEE pour vérifier que les deux chiffres correspondent bien approximativement aux résultats du recensement de 2017</p>
</div>
</div>
<div id="nombre-dhabitants-et-de-ménages-par-iris" class="section level3" number="3.2.2">
<h3><span class="header-section-number">3.2.2</span> Nombre d’habitants et de ménages par IRIS</h3>
<p>On se propose maintenant d’établir un tableau du nombre d’habitant et du nombre de ménages d’une commune par quartier IRIS.</p>
<div id="nombre-dhabitants-dune-commune-par-iris" class="section level4" number="3.2.2.1">
<h4><span class="header-section-number">3.2.2.1</span> Nombre d’habitants d’une commune par IRIS</h4>
<p>On calcule le nombre d’habitants par IRIS à l’aide de l’instruction <code>group_by</code> du package dplyr:</p>
<div class="sourceCode" id="cb122"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb122-1"><a href="21-socio-spatial.html#cb122-1"></a>tabpop &lt;-<span class="st"> </span>indiv <span class="op">%&gt;%</span><span class="st">   </span><span class="kw">mutate</span>(<span class="dt">COM =</span> <span class="kw">substr</span>(IRIS,<span class="dv">1</span>,<span class="dv">5</span>)) <span class="op">%&gt;%</span></span>
<span id="cb122-2"><a href="21-socio-spatial.html#cb122-2"></a><span class="st">                      </span><span class="kw">filter</span>(COM <span class="op">==</span><span class="st"> &quot;94071&quot;</span>) <span class="op">%&gt;%</span></span>
<span id="cb122-3"><a href="21-socio-spatial.html#cb122-3"></a><span class="st">                      </span><span class="kw">group_by</span> (IRIS) <span class="op">%&gt;%</span></span>
<span id="cb122-4"><a href="21-socio-spatial.html#cb122-4"></a><span class="st">                      </span><span class="kw">summarise</span>(<span class="dt">nbhab =</span> <span class="kw">sum</span>(IPONDI))</span></code></pre></div>
<pre><code>`summarise()` ungrouping output (override with `.groups` argument)</code></pre>
<div class="sourceCode" id="cb124"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb124-1"><a href="21-socio-spatial.html#cb124-1"></a><span class="kw">kable</span>(tabpop)</span></code></pre></div>
<table>
<thead>
<tr>
<th style="text-align:left;">
IRIS
</th>
<th style="text-align:right;">
nbhab
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
940710101
</td>
<td style="text-align:right;">
2150.932
</td>
</tr>
<tr>
<td style="text-align:left;">
940710102
</td>
<td style="text-align:right;">
2203.946
</td>
</tr>
<tr>
<td style="text-align:left;">
940710103
</td>
<td style="text-align:right;">
2843.362
</td>
</tr>
<tr>
<td style="text-align:left;">
940710104
</td>
<td style="text-align:right;">
2630.590
</td>
</tr>
<tr>
<td style="text-align:left;">
940710105
</td>
<td style="text-align:right;">
3006.213
</td>
</tr>
<tr>
<td style="text-align:left;">
940710106
</td>
<td style="text-align:right;">
2368.138
</td>
</tr>
<tr>
<td style="text-align:left;">
940710107
</td>
<td style="text-align:right;">
2545.304
</td>
</tr>
<tr>
<td style="text-align:left;">
940710108
</td>
<td style="text-align:right;">
2853.129
</td>
</tr>
<tr>
<td style="text-align:left;">
940710109
</td>
<td style="text-align:right;">
2527.575
</td>
</tr>
<tr>
<td style="text-align:left;">
940710110
</td>
<td style="text-align:right;">
1524.599
</td>
</tr>
<tr>
<td style="text-align:left;">
940710111
</td>
<td style="text-align:right;">
1825.280
</td>
</tr>
</tbody>
</table>
</div>
<div id="nombre-de-ménages-dune-commune-par-iris" class="section level4" number="3.2.2.2">
<h4><span class="header-section-number">3.2.2.2</span> Nombre de ménages d’une commune par IRIS</h4>
<p>On calcule le nombre de ménages par IRIS</p>
<div class="sourceCode" id="cb125"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb125-1"><a href="21-socio-spatial.html#cb125-1"></a>tabmen &lt;-<span class="st"> </span>indiv <span class="op">%&gt;%</span><span class="st">   </span><span class="kw">filter</span>(LPRM <span class="op">==</span><span class="st"> </span><span class="dv">1</span>) <span class="op">%&gt;%</span></span>
<span id="cb125-2"><a href="21-socio-spatial.html#cb125-2"></a><span class="st">                      </span><span class="kw">mutate</span>(<span class="dt">COM =</span> <span class="kw">substr</span>(IRIS,<span class="dv">1</span>,<span class="dv">5</span>)) <span class="op">%&gt;%</span></span>
<span id="cb125-3"><a href="21-socio-spatial.html#cb125-3"></a><span class="st">                      </span><span class="kw">filter</span>(COM <span class="op">==</span><span class="st"> &quot;94071&quot;</span>) <span class="op">%&gt;%</span></span>
<span id="cb125-4"><a href="21-socio-spatial.html#cb125-4"></a><span class="st">                      </span><span class="kw">group_by</span> (IRIS) <span class="op">%&gt;%</span></span>
<span id="cb125-5"><a href="21-socio-spatial.html#cb125-5"></a><span class="st">                      </span><span class="kw">summarise</span>(<span class="dt">nbmen =</span> <span class="kw">sum</span>(IPONDI))</span></code></pre></div>
<pre><code>`summarise()` ungrouping output (override with `.groups` argument)</code></pre>
<p>Puis on effectue la jointure des deux tableaux et on crée une nouvelle variable décrivant le nombre moyen de personnes par ménage</p>
<div class="sourceCode" id="cb127"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb127-1"><a href="21-socio-spatial.html#cb127-1"></a>tabdon &lt;-<span class="st"> </span><span class="kw">left_join</span>(tabpop, tabmen) <span class="op">%&gt;%</span></span>
<span id="cb127-2"><a href="21-socio-spatial.html#cb127-2"></a><span class="st">                    </span><span class="kw">mutate</span>(<span class="dt">tailmen =</span> nbhab<span class="op">/</span>nbmen)</span></code></pre></div>
<pre><code>Joining, by = &quot;IRIS&quot;</code></pre>
<div class="sourceCode" id="cb129"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb129-1"><a href="21-socio-spatial.html#cb129-1"></a><span class="kw">kable</span>(tabdon, <span class="dt">digits =</span> <span class="kw">c</span>(<span class="ot">NA</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">2</span>))</span></code></pre></div>
<table>
<thead>
<tr>
<th style="text-align:left;">
IRIS
</th>
<th style="text-align:right;">
nbhab
</th>
<th style="text-align:right;">
nbmen
</th>
<th style="text-align:right;">
tailmen
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
940710101
</td>
<td style="text-align:right;">
2151
</td>
<td style="text-align:right;">
812
</td>
<td style="text-align:right;">
2.65
</td>
</tr>
<tr>
<td style="text-align:left;">
940710102
</td>
<td style="text-align:right;">
2204
</td>
<td style="text-align:right;">
822
</td>
<td style="text-align:right;">
2.68
</td>
</tr>
<tr>
<td style="text-align:left;">
940710103
</td>
<td style="text-align:right;">
2843
</td>
<td style="text-align:right;">
1049
</td>
<td style="text-align:right;">
2.71
</td>
</tr>
<tr>
<td style="text-align:left;">
940710104
</td>
<td style="text-align:right;">
2631
</td>
<td style="text-align:right;">
1116
</td>
<td style="text-align:right;">
2.36
</td>
</tr>
<tr>
<td style="text-align:left;">
940710105
</td>
<td style="text-align:right;">
3006
</td>
<td style="text-align:right;">
1287
</td>
<td style="text-align:right;">
2.34
</td>
</tr>
<tr>
<td style="text-align:left;">
940710106
</td>
<td style="text-align:right;">
2368
</td>
<td style="text-align:right;">
867
</td>
<td style="text-align:right;">
2.73
</td>
</tr>
<tr>
<td style="text-align:left;">
940710107
</td>
<td style="text-align:right;">
2545
</td>
<td style="text-align:right;">
966
</td>
<td style="text-align:right;">
2.63
</td>
</tr>
<tr>
<td style="text-align:left;">
940710108
</td>
<td style="text-align:right;">
2853
</td>
<td style="text-align:right;">
1034
</td>
<td style="text-align:right;">
2.76
</td>
</tr>
<tr>
<td style="text-align:left;">
940710109
</td>
<td style="text-align:right;">
2528
</td>
<td style="text-align:right;">
1289
</td>
<td style="text-align:right;">
1.96
</td>
</tr>
<tr>
<td style="text-align:left;">
940710110
</td>
<td style="text-align:right;">
1525
</td>
<td style="text-align:right;">
677
</td>
<td style="text-align:right;">
2.25
</td>
</tr>
<tr>
<td style="text-align:left;">
940710111
</td>
<td style="text-align:right;">
1825
</td>
<td style="text-align:right;">
795
</td>
<td style="text-align:right;">
2.30
</td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="ajout-de-la-géométrie" class="section level3" number="3.2.3">
<h3><span class="header-section-number">3.2.3</span> Ajout de la géométrie</h3>
<p>Notre tableau des IRIS ne comporte pas actuellement de données géométriques permettant la cartographie et on n’y trouve pas non plus le nom ds IRIS. Nous allons donc extraire ces informations du fichier cartographique. Puis nous allons fusionner les deux fichiers pour faire un objet de type <code>sf</code>(spatial features) qui pourra être facilement utilisé par la suite pour réaliser des cartes.</p>
<div id="extraction-des-iris-de-la-commune" class="section level4" number="3.2.3.1">
<h4><span class="header-section-number">3.2.3.1</span> Extraction des IRIS de la commune</h4>
<p>On charge le fichier des IRIS du départmeent et on extrait de celui-ci les contours IRIS de la commune qui nous intéresse.</p>
<div class="sourceCode" id="cb130"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb130-1"><a href="21-socio-spatial.html#cb130-1"></a>mymap &lt;-<span class="st"> </span>map <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(INSEE_COM <span class="op">==</span><span class="st"> &quot;94071&quot;</span>) <span class="op">%&gt;%</span></span>
<span id="cb130-2"><a href="21-socio-spatial.html#cb130-2"></a><span class="st">                 </span><span class="kw">select</span>(CODE_IRIS, NOM_IRIS, TYP_IRIS,NOM_COM, geometry)</span>
<span id="cb130-3"><a href="21-socio-spatial.html#cb130-3"></a>  </span>
<span id="cb130-4"><a href="21-socio-spatial.html#cb130-4"></a><span class="kw">head</span>(mymap)</span></code></pre></div>
<pre><code># A tibble: 6 x 5
  CODE_IRIS NOM_IRIS     TYP_IRIS NOM_COM                               geometry
  &lt;chr&gt;     &lt;chr&gt;        &lt;chr&gt;    &lt;chr&gt;                       &lt;MULTIPOLYGON [m]&gt;
1 940710107 Notre Dame … H        Sucy-en… (((667480.7 6851728, 667498 6851748,…
2 940710103 La Cite Ver… H        Sucy-en… (((665121.5 6852886, 665122.9 685287…
3 940710102 La Fosse Ro… H        Sucy-en… (((665788.4 6853098, 665788.8 685309…
4 940710111 Gare Varenn… H        Sucy-en… (((664052.9 6852830, 664055.5 685282…
5 940710109 Le Centre    H        Sucy-en… (((664318.9 6852899, 664337.1 685290…
6 940710101 Le Grand Val H        Sucy-en… (((664052.9 6852830, 664050.3 685283…</code></pre>
</div>
<div id="ajout-des-coordonnées-des-centres-diris" class="section level4" number="3.2.3.2">
<h4><span class="header-section-number">3.2.3.2</span> Ajout des coordonnées des centres d’IRIS</h4>
<p>On détermine les centres des quartiers IRIS à l’aide d’un combinaison de fonctions SF et on les ajoute au fichier</p>
<div class="sourceCode" id="cb132"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb132-1"><a href="21-socio-spatial.html#cb132-1"></a>coo&lt;-<span class="kw">as.data.frame</span>(<span class="kw">st_coordinates</span>(<span class="kw">st_centroid</span>(mymap)))</span></code></pre></div>
<pre><code>Warning in st_centroid.sf(mymap): st_centroid assumes attributes are constant
over geometries of x</code></pre>
<div class="sourceCode" id="cb134"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb134-1"><a href="21-socio-spatial.html#cb134-1"></a>mymap &lt;-<span class="kw">cbind</span>(mymap,coo)</span>
<span id="cb134-2"><a href="21-socio-spatial.html#cb134-2"></a></span>
<span id="cb134-3"><a href="21-socio-spatial.html#cb134-3"></a><span class="kw">kable</span>(mymap)</span></code></pre></div>
<table>
<thead>
<tr>
<th style="text-align:left;">
CODE_IRIS
</th>
<th style="text-align:left;">
NOM_IRIS
</th>
<th style="text-align:left;">
TYP_IRIS
</th>
<th style="text-align:left;">
NOM_COM
</th>
<th style="text-align:right;">
X
</th>
<th style="text-align:right;">
Y
</th>
<th style="text-align:left;">
geometry
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
940710107
</td>
<td style="text-align:left;">
Notre Dame … Bruyeres
</td>
<td style="text-align:left;">
H
</td>
<td style="text-align:left;">
Sucy-en-Brie
</td>
<td style="text-align:right;">
667852.4
</td>
<td style="text-align:right;">
6851082
</td>
<td style="text-align:left;">
MULTIPOLYGON (((667480.7 68…
</td>
</tr>
<tr>
<td style="text-align:left;">
940710103
</td>
<td style="text-align:left;">
La Cite Verte
</td>
<td style="text-align:left;">
H
</td>
<td style="text-align:left;">
Sucy-en-Brie
</td>
<td style="text-align:right;">
664869.7
</td>
<td style="text-align:right;">
6852686
</td>
<td style="text-align:left;">
MULTIPOLYGON (((665121.5 68…
</td>
</tr>
<tr>
<td style="text-align:left;">
940710102
</td>
<td style="text-align:left;">
La Fosse Rouge
</td>
<td style="text-align:left;">
H
</td>
<td style="text-align:left;">
Sucy-en-Brie
</td>
<td style="text-align:right;">
665269.2
</td>
<td style="text-align:right;">
6853014
</td>
<td style="text-align:left;">
MULTIPOLYGON (((665788.4 68…
</td>
</tr>
<tr>
<td style="text-align:left;">
940710111
</td>
<td style="text-align:left;">
Gare Varennes Zi
</td>
<td style="text-align:left;">
H
</td>
<td style="text-align:left;">
Sucy-en-Brie
</td>
<td style="text-align:right;">
663547.5
</td>
<td style="text-align:right;">
6852295
</td>
<td style="text-align:left;">
MULTIPOLYGON (((664052.9 68…
</td>
</tr>
<tr>
<td style="text-align:left;">
940710109
</td>
<td style="text-align:left;">
Le Centre
</td>
<td style="text-align:left;">
H
</td>
<td style="text-align:left;">
Sucy-en-Brie
</td>
<td style="text-align:right;">
664634.0
</td>
<td style="text-align:right;">
6852430
</td>
<td style="text-align:left;">
MULTIPOLYGON (((664318.9 68…
</td>
</tr>
<tr>
<td style="text-align:left;">
940710101
</td>
<td style="text-align:left;">
Le Grand Val
</td>
<td style="text-align:left;">
H
</td>
<td style="text-align:left;">
Sucy-en-Brie
</td>
<td style="text-align:right;">
664435.3
</td>
<td style="text-align:right;">
6853178
</td>
<td style="text-align:left;">
MULTIPOLYGON (((664052.9 68…
</td>
</tr>
<tr>
<td style="text-align:left;">
940710108
</td>
<td style="text-align:left;">
Le Petiti Val … Clos de Ville
</td>
<td style="text-align:left;">
H
</td>
<td style="text-align:left;">
Sucy-en-Brie
</td>
<td style="text-align:right;">
664604.3
</td>
<td style="text-align:right;">
6851645
</td>
<td style="text-align:left;">
MULTIPOLYGON (((663926.1 68…
</td>
</tr>
<tr>
<td style="text-align:left;">
940710105
</td>
<td style="text-align:left;">
La Procession … Fort
</td>
<td style="text-align:left;">
H
</td>
<td style="text-align:left;">
Sucy-en-Brie
</td>
<td style="text-align:right;">
665509.4
</td>
<td style="text-align:right;">
6852035
</td>
<td style="text-align:left;">
MULTIPOLYGON (((665765.1 68…
</td>
</tr>
<tr>
<td style="text-align:left;">
940710110
</td>
<td style="text-align:left;">
Berges Noyers Pv
</td>
<td style="text-align:left;">
H
</td>
<td style="text-align:left;">
Sucy-en-Brie
</td>
<td style="text-align:right;">
664124.5
</td>
<td style="text-align:right;">
6853470
</td>
<td style="text-align:left;">
MULTIPOLYGON (((664052.9 68…
</td>
</tr>
<tr>
<td style="text-align:left;">
940710106
</td>
<td style="text-align:left;">
Le Plateau-Parc
</td>
<td style="text-align:left;">
H
</td>
<td style="text-align:left;">
Sucy-en-Brie
</td>
<td style="text-align:right;">
666195.3
</td>
<td style="text-align:right;">
6851330
</td>
<td style="text-align:left;">
MULTIPOLYGON (((667480.7 68…
</td>
</tr>
<tr>
<td style="text-align:left;">
940710104
</td>
<td style="text-align:left;">
Les Monrois … Fdv
</td>
<td style="text-align:left;">
H
</td>
<td style="text-align:left;">
Sucy-en-Brie
</td>
<td style="text-align:right;">
665758.2
</td>
<td style="text-align:right;">
6852471
</td>
<td style="text-align:left;">
MULTIPOLYGON (((666202.7 68…
</td>
</tr>
</tbody>
</table>
</div>
<div id="visualisation-de-la-carte" class="section level4" number="3.2.3.3">
<h4><span class="header-section-number">3.2.3.3</span> Visualisation de la carte</h4>
<p>On visualise la carte des iris à l’aide des fonctions <code>geom_sf</code> et <code>geom_text</code>du package ggplot2</p>
<div class="sourceCode" id="cb135"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb135-1"><a href="21-socio-spatial.html#cb135-1"></a><span class="kw">ggplot</span>(mymap) <span class="op">+</span></span>
<span id="cb135-2"><a href="21-socio-spatial.html#cb135-2"></a><span class="st">  </span><span class="kw">geom_sf</span>(<span class="dt">fill =</span> <span class="st">&quot;lightyellow&quot;</span>) <span class="op">+</span></span>
<span id="cb135-3"><a href="21-socio-spatial.html#cb135-3"></a><span class="st">  </span><span class="kw">geom_text</span>(<span class="kw">aes</span>(<span class="dt">x=</span>X, <span class="dt">y=</span>Y, <span class="dt">label =</span> <span class="kw">substr</span>(CODE_IRIS,<span class="dv">6</span>,<span class="dv">9</span>)), <span class="dt">colour =</span> <span class="st">&quot;red&quot;</span>) <span class="op">+</span></span>
<span id="cb135-4"><a href="21-socio-spatial.html#cb135-4"></a><span class="st">  </span><span class="kw">ggtitle</span>(<span class="st">&quot;Découpage de la commune de Sucy-en-Brie en IRIS&quot;</span>)</span></code></pre></div>
<p><img src="Projet-Data-Mining-2021_files/figure-html/unnamed-chunk-79-1.svg" width="672" /></p>
</div>
<div id="jointure-des-deux-fichiers" class="section level4" number="3.2.3.4">
<h4><span class="header-section-number">3.2.3.4</span> Jointure des deux fichiers</h4>
<p>On va maintenant effectuer la joindure avec le tableau de données, mais en faisant attention à recoder la variable IRIS du fichier de données en CODE_IRIS pour assurer la jointure.</p>
<div class="sourceCode" id="cb136"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb136-1"><a href="21-socio-spatial.html#cb136-1"></a>mapdon &lt;-<span class="st"> </span>tabdon <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">rename</span>(<span class="dt">CODE_IRIS =</span> IRIS) <span class="op">%&gt;%</span></span>
<span id="cb136-2"><a href="21-socio-spatial.html#cb136-2"></a><span class="st">                    </span><span class="kw">left_join</span>(mymap)</span></code></pre></div>
<pre><code>Joining, by = &quot;CODE_IRIS&quot;</code></pre>
<div class="sourceCode" id="cb138"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb138-1"><a href="21-socio-spatial.html#cb138-1"></a><span class="kw">kable</span>(mapdon)</span></code></pre></div>
<table>
<thead>
<tr>
<th style="text-align:left;">
CODE_IRIS
</th>
<th style="text-align:right;">
nbhab
</th>
<th style="text-align:right;">
nbmen
</th>
<th style="text-align:right;">
tailmen
</th>
<th style="text-align:left;">
NOM_IRIS
</th>
<th style="text-align:left;">
TYP_IRIS
</th>
<th style="text-align:left;">
NOM_COM
</th>
<th style="text-align:right;">
X
</th>
<th style="text-align:right;">
Y
</th>
<th style="text-align:left;">
geometry
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
940710101
</td>
<td style="text-align:right;">
2150.932
</td>
<td style="text-align:right;">
812.2436
</td>
<td style="text-align:right;">
2.648137
</td>
<td style="text-align:left;">
Le Grand Val
</td>
<td style="text-align:left;">
H
</td>
<td style="text-align:left;">
Sucy-en-Brie
</td>
<td style="text-align:right;">
664435.3
</td>
<td style="text-align:right;">
6853178
</td>
<td style="text-align:left;">
MULTIPOLYGON (((664052.9 68…
</td>
</tr>
<tr>
<td style="text-align:left;">
940710102
</td>
<td style="text-align:right;">
2203.946
</td>
<td style="text-align:right;">
822.4033
</td>
<td style="text-align:right;">
2.679885
</td>
<td style="text-align:left;">
La Fosse Rouge
</td>
<td style="text-align:left;">
H
</td>
<td style="text-align:left;">
Sucy-en-Brie
</td>
<td style="text-align:right;">
665269.2
</td>
<td style="text-align:right;">
6853014
</td>
<td style="text-align:left;">
MULTIPOLYGON (((665788.4 68…
</td>
</tr>
<tr>
<td style="text-align:left;">
940710103
</td>
<td style="text-align:right;">
2843.362
</td>
<td style="text-align:right;">
1048.7700
</td>
<td style="text-align:right;">
2.711140
</td>
<td style="text-align:left;">
La Cite Verte
</td>
<td style="text-align:left;">
H
</td>
<td style="text-align:left;">
Sucy-en-Brie
</td>
<td style="text-align:right;">
664869.7
</td>
<td style="text-align:right;">
6852686
</td>
<td style="text-align:left;">
MULTIPOLYGON (((665121.5 68…
</td>
</tr>
<tr>
<td style="text-align:left;">
940710104
</td>
<td style="text-align:right;">
2630.590
</td>
<td style="text-align:right;">
1115.8427
</td>
<td style="text-align:right;">
2.357492
</td>
<td style="text-align:left;">
Les Monrois … Fdv
</td>
<td style="text-align:left;">
H
</td>
<td style="text-align:left;">
Sucy-en-Brie
</td>
<td style="text-align:right;">
665758.2
</td>
<td style="text-align:right;">
6852471
</td>
<td style="text-align:left;">
MULTIPOLYGON (((666202.7 68…
</td>
</tr>
<tr>
<td style="text-align:left;">
940710105
</td>
<td style="text-align:right;">
3006.213
</td>
<td style="text-align:right;">
1287.2656
</td>
<td style="text-align:right;">
2.335348
</td>
<td style="text-align:left;">
La Procession … Fort
</td>
<td style="text-align:left;">
H
</td>
<td style="text-align:left;">
Sucy-en-Brie
</td>
<td style="text-align:right;">
665509.4
</td>
<td style="text-align:right;">
6852035
</td>
<td style="text-align:left;">
MULTIPOLYGON (((665765.1 68…
</td>
</tr>
<tr>
<td style="text-align:left;">
940710106
</td>
<td style="text-align:right;">
2368.138
</td>
<td style="text-align:right;">
867.4955
</td>
<td style="text-align:right;">
2.729856
</td>
<td style="text-align:left;">
Le Plateau-Parc
</td>
<td style="text-align:left;">
H
</td>
<td style="text-align:left;">
Sucy-en-Brie
</td>
<td style="text-align:right;">
666195.3
</td>
<td style="text-align:right;">
6851330
</td>
<td style="text-align:left;">
MULTIPOLYGON (((667480.7 68…
</td>
</tr>
<tr>
<td style="text-align:left;">
940710107
</td>
<td style="text-align:right;">
2545.304
</td>
<td style="text-align:right;">
966.4696
</td>
<td style="text-align:right;">
2.633610
</td>
<td style="text-align:left;">
Notre Dame … Bruyeres
</td>
<td style="text-align:left;">
H
</td>
<td style="text-align:left;">
Sucy-en-Brie
</td>
<td style="text-align:right;">
667852.4
</td>
<td style="text-align:right;">
6851082
</td>
<td style="text-align:left;">
MULTIPOLYGON (((667480.7 68…
</td>
</tr>
<tr>
<td style="text-align:left;">
940710108
</td>
<td style="text-align:right;">
2853.129
</td>
<td style="text-align:right;">
1034.3876
</td>
<td style="text-align:right;">
2.758278
</td>
<td style="text-align:left;">
Le Petiti Val … Clos de Ville
</td>
<td style="text-align:left;">
H
</td>
<td style="text-align:left;">
Sucy-en-Brie
</td>
<td style="text-align:right;">
664604.3
</td>
<td style="text-align:right;">
6851645
</td>
<td style="text-align:left;">
MULTIPOLYGON (((663926.1 68…
</td>
</tr>
<tr>
<td style="text-align:left;">
940710109
</td>
<td style="text-align:right;">
2527.575
</td>
<td style="text-align:right;">
1288.7402
</td>
<td style="text-align:right;">
1.961276
</td>
<td style="text-align:left;">
Le Centre
</td>
<td style="text-align:left;">
H
</td>
<td style="text-align:left;">
Sucy-en-Brie
</td>
<td style="text-align:right;">
664634.0
</td>
<td style="text-align:right;">
6852430
</td>
<td style="text-align:left;">
MULTIPOLYGON (((664318.9 68…
</td>
</tr>
<tr>
<td style="text-align:left;">
940710110
</td>
<td style="text-align:right;">
1524.599
</td>
<td style="text-align:right;">
677.4526
</td>
<td style="text-align:right;">
2.250488
</td>
<td style="text-align:left;">
Berges Noyers Pv
</td>
<td style="text-align:left;">
H
</td>
<td style="text-align:left;">
Sucy-en-Brie
</td>
<td style="text-align:right;">
664124.5
</td>
<td style="text-align:right;">
6853470
</td>
<td style="text-align:left;">
MULTIPOLYGON (((664052.9 68…
</td>
</tr>
<tr>
<td style="text-align:left;">
940710111
</td>
<td style="text-align:right;">
1825.280
</td>
<td style="text-align:right;">
795.1780
</td>
<td style="text-align:right;">
2.295436
</td>
<td style="text-align:left;">
Gare Varennes Zi
</td>
<td style="text-align:left;">
H
</td>
<td style="text-align:left;">
Sucy-en-Brie
</td>
<td style="text-align:right;">
663547.5
</td>
<td style="text-align:right;">
6852295
</td>
<td style="text-align:left;">
MULTIPOLYGON (((664052.9 68…
</td>
</tr>
</tbody>
</table>
</div>
<div id="sauvegarde-du-résultat" class="section level4" number="3.2.3.5">
<h4><span class="header-section-number">3.2.3.5</span> Sauvegarde du résultat</h4>
<p>On sauvegarde précieusement le fichier final qui servira de référence pour la suite des travaux.</p>
<div class="sourceCode" id="cb139"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb139-1"><a href="21-socio-spatial.html#cb139-1"></a><span class="kw">saveRDS</span>(mapdon, <span class="st">&quot;data/mapdon_94071.Rdata&quot;</span>)</span></code></pre></div>
</div>
</div>
<div id="automatisation-du-travail" class="section level3" number="3.2.4">
<h3><span class="header-section-number">3.2.4</span> Automatisation du travail</h3>
<p>Nous avons maintenant bien décomposé toutes les étapes permettant de créer le fichier de référence pour une commune précise. Il nous reste à automatiser le processus pour une commune quelconque. Nous allons pour cela créer une <strong>fonction</strong> qui permet de créer pour une commune quelconque son fichier de référence.</p>
<div id="ecriture-de-la-fonction" class="section level4" number="3.2.4.1">
<h4><span class="header-section-number">3.2.4.1</span> Ecriture de la fonction</h4>
<p>Il suffit de reprendre tous les programmes précédents en remplaçant le code 94370 par un argument <code>codecom</code> de la fonction qu’on va appeler <strong>mapdon()</strong> :</p>
<div class="sourceCode" id="cb140"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb140-1"><a href="21-socio-spatial.html#cb140-1"></a>mapdon &lt;-<span class="st"> </span><span class="cf">function</span>(<span class="dt">indiv =</span> indiv,</span>
<span id="cb140-2"><a href="21-socio-spatial.html#cb140-2"></a>                   <span class="dt">map =</span> map,</span>
<span id="cb140-3"><a href="21-socio-spatial.html#cb140-3"></a>                   <span class="dt">codecom =</span> <span class="st">&quot;94370&quot;</span>) </span>
<span id="cb140-4"><a href="21-socio-spatial.html#cb140-4"></a>  {</span>
<span id="cb140-5"><a href="21-socio-spatial.html#cb140-5"></a></span>
<span id="cb140-6"><a href="21-socio-spatial.html#cb140-6"></a>  </span>
<span id="cb140-7"><a href="21-socio-spatial.html#cb140-7"></a>  <span class="co"># (1) Création du tableau de population par IRIS</span></span>
<span id="cb140-8"><a href="21-socio-spatial.html#cb140-8"></a>  tabpop &lt;-<span class="st"> </span>indiv <span class="op">%&gt;%</span><span class="st">   </span><span class="kw">mutate</span>(<span class="dt">COM =</span> <span class="kw">substr</span>(IRIS,<span class="dv">1</span>,<span class="dv">5</span>)) <span class="op">%&gt;%</span></span>
<span id="cb140-9"><a href="21-socio-spatial.html#cb140-9"></a><span class="st">                        </span><span class="kw">filter</span>(COM <span class="op">==</span><span class="st"> </span>codecom) <span class="op">%&gt;%</span></span>
<span id="cb140-10"><a href="21-socio-spatial.html#cb140-10"></a><span class="st">                        </span><span class="kw">group_by</span> (IRIS) <span class="op">%&gt;%</span></span>
<span id="cb140-11"><a href="21-socio-spatial.html#cb140-11"></a><span class="st">                        </span><span class="kw">summarise</span>(<span class="dt">nbhab =</span> <span class="kw">sum</span>(IPONDI))</span>
<span id="cb140-12"><a href="21-socio-spatial.html#cb140-12"></a>  </span>
<span id="cb140-13"><a href="21-socio-spatial.html#cb140-13"></a>  </span>
<span id="cb140-14"><a href="21-socio-spatial.html#cb140-14"></a>  <span class="co"># (2) Création du tableau de ménage par IRIS</span></span>
<span id="cb140-15"><a href="21-socio-spatial.html#cb140-15"></a>  tabmen &lt;-<span class="st"> </span>indiv <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(LPRM <span class="op">==</span><span class="st"> </span><span class="dv">1</span>) <span class="op">%&gt;%</span></span>
<span id="cb140-16"><a href="21-socio-spatial.html#cb140-16"></a><span class="st">                      </span><span class="kw">mutate</span>(<span class="dt">COM =</span> <span class="kw">substr</span>(IRIS,<span class="dv">1</span>,<span class="dv">5</span>)) <span class="op">%&gt;%</span></span>
<span id="cb140-17"><a href="21-socio-spatial.html#cb140-17"></a><span class="st">                      </span><span class="kw">filter</span>(COM <span class="op">==</span><span class="st"> </span>codecom) <span class="op">%&gt;%</span></span>
<span id="cb140-18"><a href="21-socio-spatial.html#cb140-18"></a><span class="st">                      </span><span class="kw">group_by</span> (IRIS) <span class="op">%&gt;%</span></span>
<span id="cb140-19"><a href="21-socio-spatial.html#cb140-19"></a><span class="st">                      </span><span class="kw">summarise</span>(<span class="dt">nbmen =</span> <span class="kw">sum</span>(IPONDI))</span>
<span id="cb140-20"><a href="21-socio-spatial.html#cb140-20"></a>  </span>
<span id="cb140-21"><a href="21-socio-spatial.html#cb140-21"></a>  <span class="co"># (3) Fusion des tableaux de données</span></span>
<span id="cb140-22"><a href="21-socio-spatial.html#cb140-22"></a>  tabdon &lt;-<span class="st"> </span><span class="kw">left_join</span>(tabpop, tabmen) <span class="op">%&gt;%</span></span>
<span id="cb140-23"><a href="21-socio-spatial.html#cb140-23"></a><span class="st">                      </span><span class="kw">mutate</span>(<span class="dt">tailmen =</span> nbhab<span class="op">/</span>nbmen)</span>
<span id="cb140-24"><a href="21-socio-spatial.html#cb140-24"></a>  </span>
<span id="cb140-25"><a href="21-socio-spatial.html#cb140-25"></a>  <span class="co"># (4) Extraction du fonds de carte des IRIS</span></span>
<span id="cb140-26"><a href="21-socio-spatial.html#cb140-26"></a>   mymap &lt;-<span class="st"> </span>map <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(INSEE_COM <span class="op">==</span><span class="st"> </span>codecom) <span class="op">%&gt;%</span></span>
<span id="cb140-27"><a href="21-socio-spatial.html#cb140-27"></a><span class="st">                 </span><span class="kw">select</span>(CODE_IRIS, NOM_IRIS, TYP_IRIS,NOM_COM, geometry)</span>
<span id="cb140-28"><a href="21-socio-spatial.html#cb140-28"></a>   </span>
<span id="cb140-29"><a href="21-socio-spatial.html#cb140-29"></a>  <span class="co"># (5) Ajout des coordonnées des centres d&#39;IRIS</span></span>
<span id="cb140-30"><a href="21-socio-spatial.html#cb140-30"></a>   coo&lt;-<span class="kw">as.data.frame</span>(<span class="kw">st_coordinates</span>(<span class="kw">st_centroid</span>(mymap)))</span>
<span id="cb140-31"><a href="21-socio-spatial.html#cb140-31"></a>   mymap &lt;-<span class="kw">cbind</span>(mymap,coo)</span>
<span id="cb140-32"><a href="21-socio-spatial.html#cb140-32"></a>   </span>
<span id="cb140-33"><a href="21-socio-spatial.html#cb140-33"></a>   <span class="co"># (6) Fusion des données et de la géométrie</span></span>
<span id="cb140-34"><a href="21-socio-spatial.html#cb140-34"></a>   mapdon &lt;-<span class="st"> </span>tabdon <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">rename</span>(<span class="dt">CODE_IRIS =</span> IRIS) <span class="op">%&gt;%</span></span>
<span id="cb140-35"><a href="21-socio-spatial.html#cb140-35"></a><span class="st">                    </span><span class="kw">left_join</span>(mymap)</span>
<span id="cb140-36"><a href="21-socio-spatial.html#cb140-36"></a>   </span>
<span id="cb140-37"><a href="21-socio-spatial.html#cb140-37"></a>   <span class="co"># (7) Conversion au format sf</span></span>
<span id="cb140-38"><a href="21-socio-spatial.html#cb140-38"></a>   mapdon&lt;-<span class="kw">st_as_sf</span>(mapdon)</span>
<span id="cb140-39"><a href="21-socio-spatial.html#cb140-39"></a>   </span>
<span id="cb140-40"><a href="21-socio-spatial.html#cb140-40"></a>   <span class="co"># (7) Sortie du résultat</span></span>
<span id="cb140-41"><a href="21-socio-spatial.html#cb140-41"></a>   <span class="kw">return</span>(mapdon)</span>
<span id="cb140-42"><a href="21-socio-spatial.html#cb140-42"></a>}</span></code></pre></div>
</div>
<div id="test-de-la-fonction" class="section level4" number="3.2.4.2">
<h4><span class="header-section-number">3.2.4.2</span> Test de la fonction</h4>
<p>Essayons maintenant d’appliquer notre fonction à une autre commune comme Saint-Maur-des-Fossés (94068). Il suffit pour cela de lui fournir les trois paramètres correspondant au tableau de données individuelles, au fonds de carte et au code de la commune</p>
<div class="sourceCode" id="cb141"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb141-1"><a href="21-socio-spatial.html#cb141-1"></a><span class="co"># indiv &lt;- readRDS(&quot;data/indiv2017.Rdata&quot;)</span></span>
<span id="cb141-2"><a href="21-socio-spatial.html#cb141-2"></a><span class="co"># map &lt;-readRDS(&quot;data/map_iris.Rdata&quot;)</span></span>
<span id="cb141-3"><a href="21-socio-spatial.html#cb141-3"></a></span>
<span id="cb141-4"><a href="21-socio-spatial.html#cb141-4"></a>stmaur &lt;-<span class="st"> </span><span class="kw">mapdon</span>(<span class="dt">indiv=</span>indiv, </span>
<span id="cb141-5"><a href="21-socio-spatial.html#cb141-5"></a>                 <span class="dt">map =</span> map, </span>
<span id="cb141-6"><a href="21-socio-spatial.html#cb141-6"></a>                 <span class="dt">codecom =</span> <span class="st">&quot;94068&quot;</span>)</span></code></pre></div>
<pre><code>`summarise()` ungrouping output (override with `.groups` argument)
`summarise()` ungrouping output (override with `.groups` argument)</code></pre>
<pre><code>Joining, by = &quot;IRIS&quot;</code></pre>
<pre><code>Warning in st_centroid.sf(mymap): st_centroid assumes attributes are constant
over geometries of x</code></pre>
<pre><code>Joining, by = &quot;CODE_IRIS&quot;</code></pre>
<div class="sourceCode" id="cb146"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb146-1"><a href="21-socio-spatial.html#cb146-1"></a><span class="kw">class</span>(stmaur)</span></code></pre></div>
<pre><code>[1] &quot;sf&quot;         &quot;tbl_df&quot;     &quot;tbl&quot;        &quot;data.frame&quot;</code></pre>
<div class="sourceCode" id="cb148"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb148-1"><a href="21-socio-spatial.html#cb148-1"></a><span class="kw">kable</span>(<span class="kw">head</span>(stmaur))</span></code></pre></div>
<table>
<thead>
<tr>
<th style="text-align:left;">
CODE_IRIS
</th>
<th style="text-align:right;">
nbhab
</th>
<th style="text-align:right;">
nbmen
</th>
<th style="text-align:right;">
tailmen
</th>
<th style="text-align:left;">
NOM_IRIS
</th>
<th style="text-align:left;">
TYP_IRIS
</th>
<th style="text-align:left;">
NOM_COM
</th>
<th style="text-align:right;">
X
</th>
<th style="text-align:right;">
Y
</th>
<th style="text-align:left;">
geometry
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
940680101
</td>
<td style="text-align:right;">
2354.834
</td>
<td style="text-align:right;">
1180.1101
</td>
<td style="text-align:right;">
1.995436
</td>
<td style="text-align:left;">
Adamville 1
</td>
<td style="text-align:left;">
H
</td>
<td style="text-align:left;">
Saint-Maur-des-Fossés
</td>
<td style="text-align:right;">
662121.0
</td>
<td style="text-align:right;">
6856007
</td>
<td style="text-align:left;">
MULTIPOLYGON (((662332.4 68…
</td>
</tr>
<tr>
<td style="text-align:left;">
940680102
</td>
<td style="text-align:right;">
2615.027
</td>
<td style="text-align:right;">
1204.4229
</td>
<td style="text-align:right;">
2.171187
</td>
<td style="text-align:left;">
Adamville 2
</td>
<td style="text-align:left;">
H
</td>
<td style="text-align:left;">
Saint-Maur-des-Fossés
</td>
<td style="text-align:right;">
661513.7
</td>
<td style="text-align:right;">
6855845
</td>
<td style="text-align:left;">
MULTIPOLYGON (((661318.1 68…
</td>
</tr>
<tr>
<td style="text-align:left;">
940680103
</td>
<td style="text-align:right;">
2630.544
</td>
<td style="text-align:right;">
1307.0014
</td>
<td style="text-align:right;">
2.012656
</td>
<td style="text-align:left;">
Adamville 3
</td>
<td style="text-align:left;">
H
</td>
<td style="text-align:left;">
Saint-Maur-des-Fossés
</td>
<td style="text-align:right;">
662092.7
</td>
<td style="text-align:right;">
6855636
</td>
<td style="text-align:left;">
MULTIPOLYGON (((661797 6855…
</td>
</tr>
<tr>
<td style="text-align:left;">
940680104
</td>
<td style="text-align:right;">
2395.176
</td>
<td style="text-align:right;">
1156.3000
</td>
<td style="text-align:right;">
2.071414
</td>
<td style="text-align:left;">
Adamville 4
</td>
<td style="text-align:left;">
H
</td>
<td style="text-align:left;">
Saint-Maur-des-Fossés
</td>
<td style="text-align:right;">
662802.3
</td>
<td style="text-align:right;">
6855656
</td>
<td style="text-align:left;">
MULTIPOLYGON (((662332.4 68…
</td>
</tr>
<tr>
<td style="text-align:left;">
940680105
</td>
<td style="text-align:right;">
2213.094
</td>
<td style="text-align:right;">
967.9966
</td>
<td style="text-align:right;">
2.286263
</td>
<td style="text-align:left;">
Adamville 5
</td>
<td style="text-align:left;">
H
</td>
<td style="text-align:left;">
Saint-Maur-des-Fossés
</td>
<td style="text-align:right;">
661794.9
</td>
<td style="text-align:right;">
6855206
</td>
<td style="text-align:left;">
MULTIPOLYGON (((661810.5 68…
</td>
</tr>
<tr>
<td style="text-align:left;">
940680106
</td>
<td style="text-align:right;">
2561.655
</td>
<td style="text-align:right;">
1264.6149
</td>
<td style="text-align:right;">
2.025640
</td>
<td style="text-align:left;">
Adamville 6
</td>
<td style="text-align:left;">
H
</td>
<td style="text-align:left;">
Saint-Maur-des-Fossés
</td>
<td style="text-align:right;">
662302.9
</td>
<td style="text-align:right;">
6855263
</td>
<td style="text-align:left;">
MULTIPOLYGON (((662285.5 68…
</td>
</tr>
</tbody>
</table>
<p>On peut visualiser la carte et ses codes :</p>
<div class="sourceCode" id="cb149"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb149-1"><a href="21-socio-spatial.html#cb149-1"></a><span class="kw">ggplot</span>(stmaur) <span class="op">+</span></span>
<span id="cb149-2"><a href="21-socio-spatial.html#cb149-2"></a><span class="st">  </span><span class="kw">geom_sf</span>(<span class="dt">fill =</span> <span class="st">&quot;lightyellow&quot;</span>) <span class="op">+</span></span>
<span id="cb149-3"><a href="21-socio-spatial.html#cb149-3"></a><span class="st">  </span><span class="kw">geom_text</span>(<span class="kw">aes</span>(<span class="dt">x=</span>X, <span class="dt">y=</span>Y, <span class="dt">label =</span> <span class="kw">substr</span>(CODE_IRIS,<span class="dv">6</span>,<span class="dv">9</span>)), <span class="dt">colour =</span> <span class="st">&quot;red&quot;</span>) <span class="op">+</span></span>
<span id="cb149-4"><a href="21-socio-spatial.html#cb149-4"></a><span class="st">  </span><span class="kw">ggtitle</span>(<span class="st">&quot;Découpage de la commune en IRIS&quot;</span>) </span></code></pre></div>
<p><img src="Projet-Data-Mining-2021_files/figure-html/unnamed-chunk-84-1.svg" width="672" /></p>
<p>Et sauvegarder le résultat s’il est correct :</p>
<div class="sourceCode" id="cb150"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb150-1"><a href="21-socio-spatial.html#cb150-1"></a><span class="kw">saveRDS</span>(stmaur, <span class="st">&quot;data/mapdon_94068.Rdata&quot;</span>)</span></code></pre></div>

</div>
</div>
</div>
</div>
<script src="js/tidyverse.js"></script>
            </section>

          </div>
        </div>
      </div>
<a href="12-Stat.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="22-cartographie.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": false,
"twitter": false,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"],
"instapper": false
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/ClaudeGrasland/DataMiningProject2021/blob/master/21-socio-spatial.Rmd",
"text": "Source"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "section"
}
});
});
</script>

</body>

</html>
