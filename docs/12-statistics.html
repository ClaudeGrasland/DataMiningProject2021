<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapitre 2 Analyse statistique I (C.S.) | Projet DATA MINING 2021</title>
  <meta name="description" content="Titre du cours" />
  <meta name="generator" content="bookdown 0.21 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapitre 2 Analyse statistique I (C.S.) | Projet DATA MINING 2021" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="Titre du cours" />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapitre 2 Analyse statistique I (C.S.) | Projet DATA MINING 2021" />
  
  <meta name="twitter:description" content="Titre du cours" />
  

<meta name="author" content="C. Grasland et C. Signoretto" />


<meta name="date" content="2021-04-12" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="11-data.html"/>
<link rel="next" href="21-cartography_V2.html"/>
<script src="libs/header-attrs-2.6/header-attrs.js"></script>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<script src="libs/accessible-code-block-0.0.1/empty-anchor.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    background-color: #ffffff;
    color: #a0a0a0;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #a0a0a0;  padding-left: 4px; }
div.sourceCode
  { color: #1f1c1b; background-color: #ffffff; }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span. { color: #1f1c1b; } /* Normal */
code span.al { color: #bf0303; background-color: #f7e6e6; font-weight: bold; } /* Alert */
code span.an { color: #ca60ca; } /* Annotation */
code span.at { color: #0057ae; } /* Attribute */
code span.bn { color: #b08000; } /* BaseN */
code span.bu { color: #644a9b; font-weight: bold; } /* BuiltIn */
code span.cf { color: #1f1c1b; font-weight: bold; } /* ControlFlow */
code span.ch { color: #924c9d; } /* Char */
code span.cn { color: #aa5500; } /* Constant */
code span.co { color: #898887; } /* Comment */
code span.cv { color: #0095ff; } /* CommentVar */
code span.do { color: #607880; } /* Documentation */
code span.dt { color: #0057ae; } /* DataType */
code span.dv { color: #b08000; } /* DecVal */
code span.er { color: #bf0303; text-decoration: underline; } /* Error */
code span.ex { color: #0095ff; font-weight: bold; } /* Extension */
code span.fl { color: #b08000; } /* Float */
code span.fu { color: #644a9b; } /* Function */
code span.im { color: #ff5500; } /* Import */
code span.in { color: #b08000; } /* Information */
code span.kw { color: #1f1c1b; font-weight: bold; } /* Keyword */
code span.op { color: #1f1c1b; } /* Operator */
code span.ot { color: #006e28; } /* Other */
code span.pp { color: #006e28; } /* Preprocessor */
code span.re { color: #0057ae; background-color: #e0e9f8; } /* RegionMarker */
code span.sc { color: #3daee9; } /* SpecialChar */
code span.ss { color: #ff5500; } /* SpecialString */
code span.st { color: #bf0303; } /* String */
code span.va { color: #0057ae; } /* Variable */
code span.vs { color: #bf0303; } /* VerbatimString */
code span.wa { color: #bf0303; } /* Warning */
</style>

<link rel="stylesheet" href="css/tidyverse.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./index.html">Data Mining 2021  <em>C. Grasland  & C.Signoretto</em></a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="00-presentation.html"><a href="00-presentation.html"><i class="fa fa-check"></i>Présentation</a>
<ul>
<li class="chapter" data-level="" data-path="00-presentation.html"><a href="00-presentation.html#à-propos-de-ce-document"><i class="fa fa-check"></i>À propos de ce document</a></li>
<li class="chapter" data-level="" data-path="00-presentation.html"><a href="00-presentation.html#prérequis"><i class="fa fa-check"></i>Prérequis</a></li>
<li class="chapter" data-level="" data-path="00-presentation.html"><a href="00-presentation.html#remerciements"><i class="fa fa-check"></i>Remerciements</a></li>
<li class="chapter" data-level="" data-path="00-presentation.html"><a href="00-presentation.html#licence"><i class="fa fa-check"></i>Licence</a></li>
</ul></li>
<li class="chapter" data-level="1" data-path="11-data.html"><a href="11-data.html"><i class="fa fa-check"></i><b>1</b> Données</a>
<ul>
<li class="chapter" data-level="1.1" data-path="11-data.html"><a href="11-data.html#introduction"><i class="fa fa-check"></i><b>1.1</b> Introduction</a></li>
<li class="chapter" data-level="1.2" data-path="11-data.html"><a href="11-data.html#données-statistiques-sur-les-individus"><i class="fa fa-check"></i><b>1.2</b> Données statistiques sur les individus</a>
<ul>
<li class="chapter" data-level="1.2.1" data-path="11-data.html"><a href="11-data.html#etape-1-téléchargement-des-données-et-stockage-temporaire"><i class="fa fa-check"></i><b>1.2.1</b> Etape 1 : téléchargement des données et stockage temporaire</a></li>
<li class="chapter" data-level="1.2.2" data-path="11-data.html"><a href="11-data.html#etape-2-transformation-des-données-au-format-r"><i class="fa fa-check"></i><b>1.2.2</b> Etape 2 : Transformation des données au format R</a></li>
<li class="chapter" data-level="1.2.3" data-path="11-data.html"><a href="11-data.html#etape-3-sélection-des-données-utiles-et-sauvegarde-au-format-.rdata"><i class="fa fa-check"></i><b>1.2.3</b> Etape 3 : Sélection des données utiles et sauvegarde au format .Rdata</a></li>
</ul></li>
<li class="chapter" data-level="1.3" data-path="11-data.html"><a href="11-data.html#données-statistiques-sur-les-logements-ordinaires"><i class="fa fa-check"></i><b>1.3</b> Données statistiques sur les logements ordinaires</a>
<ul>
<li class="chapter" data-level="1.3.1" data-path="11-data.html"><a href="11-data.html#etape-1-récupération-des-fichiers"><i class="fa fa-check"></i><b>1.3.1</b> Etape 1 : récupération des fichiers</a></li>
<li class="chapter" data-level="1.3.2" data-path="11-data.html"><a href="11-data.html#etape-2-transformation-des-données-au-format-r-1"><i class="fa fa-check"></i><b>1.3.2</b> Etape 2 : Transformation des données au format R</a></li>
<li class="chapter" data-level="1.3.3" data-path="11-data.html"><a href="11-data.html#etape-3-sélection-des-données-utiles-et-sauvegarde-au-format-.rdata-1"><i class="fa fa-check"></i><b>1.3.3</b> Etape 3 : Sélection des données utiles et sauvegarde au format .Rdata</a></li>
</ul></li>
<li class="chapter" data-level="1.4" data-path="11-data.html"><a href="11-data.html#données-géométriques"><i class="fa fa-check"></i><b>1.4</b> Données géométriques</a>
<ul>
<li class="chapter" data-level="1.4.1" data-path="11-data.html"><a href="11-data.html#etape-1-récupération-du-fonds-iris-au-format-shapefile"><i class="fa fa-check"></i><b>1.4.1</b> Etape 1 : récupération du fonds IRIS au format shapefile</a></li>
<li class="chapter" data-level="1.4.2" data-path="11-data.html"><a href="11-data.html#etape-2-importation-et-transformation-au-format-sf"><i class="fa fa-check"></i><b>1.4.2</b> Etape 2 : Importation et transformation au format sf</a></li>
<li class="chapter" data-level="1.4.3" data-path="11-data.html"><a href="11-data.html#etape-3-extraction-des-iris-de-la-zone-détude"><i class="fa fa-check"></i><b>1.4.3</b> Etape 3 : Extraction des IRIS de la zone d’étude</a></li>
<li class="chapter" data-level="1.4.4" data-path="11-data.html"><a href="11-data.html#etape-4-création-dun-fonds-de-carte-des-communes"><i class="fa fa-check"></i><b>1.4.4</b> Etape 4 : création d’un fonds de carte des communes</a></li>
<li class="chapter" data-level="1.4.5" data-path="11-data.html"><a href="11-data.html#etape-5-création-dun-fonds-de-carte-par-département"><i class="fa fa-check"></i><b>1.4.5</b> Etape 5 : création d’un fonds de carte par département</a></li>
<li class="chapter" data-level="1.4.6" data-path="11-data.html"><a href="11-data.html#etape-6-superposition-des-trois-fonds-de-carte"><i class="fa fa-check"></i><b>1.4.6</b> Etape 6: Superposition des trois fonds de carte</a></li>
</ul></li>
<li class="chapter" data-level="1.5" data-path="11-data.html"><a href="11-data.html#bilan-et-nettoyage"><i class="fa fa-check"></i><b>1.5</b> Bilan et nettoyage</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="12-statistics.html"><a href="12-statistics.html"><i class="fa fa-check"></i><b>2</b> Analyse statistique I (C.S.)</a>
<ul>
<li class="chapter" data-level="2.1" data-path="12-statistics.html"><a href="12-statistics.html#introduction-1"><i class="fa fa-check"></i><b>2.1</b> Introduction</a>
<ul>
<li class="chapter" data-level="2.1.1" data-path="12-statistics.html"><a href="12-statistics.html#les-données-du-recensement-de-la-population-rp"><i class="fa fa-check"></i><b>2.1.1</b> Les données du Recensement de la Population (RP)</a></li>
<li class="chapter" data-level="2.1.2" data-path="12-statistics.html"><a href="12-statistics.html#quelles-variables-sont-présentes-dans-les-données-quelle-spécificité"><i class="fa fa-check"></i><b>2.1.2</b> Quelles variables sont présentes dans les données ? Quelle spécificité ?</a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="12-statistics.html"><a href="12-statistics.html#quelques-statistiques-sur-les-logements-et-ménages"><i class="fa fa-check"></i><b>2.2</b> Quelques statistiques sur les logements et ménages</a></li>
<li class="chapter" data-level="2.3" data-path="12-statistics.html"><a href="12-statistics.html#quelles-caractéristiques-des-individus-résidant-dans-le-val-de-marne-en-2017"><i class="fa fa-check"></i><b>2.3</b> Quelles caractéristiques des individus résidant dans le Val de Marne en 2017 ?</a></li>
<li class="chapter" data-level="2.4" data-path="12-statistics.html"><a href="12-statistics.html#la-création-de-fonctions"><i class="fa fa-check"></i><b>2.4</b> La création de fonctions</a>
<ul>
<li class="chapter" data-level="2.4.1" data-path="12-statistics.html"><a href="12-statistics.html#création-dune-fonction-pour-retourner-un-tableau"><i class="fa fa-check"></i><b>2.4.1</b> Création d’une fonction pour retourner un tableau</a></li>
<li class="chapter" data-level="2.4.2" data-path="12-statistics.html"><a href="12-statistics.html#création-dune-fonction-pour-retourner-un-graphique"><i class="fa fa-check"></i><b>2.4.2</b> Création d’une fonction pour retourner un graphique</a></li>
<li class="chapter" data-level="2.4.3" data-path="12-statistics.html"><a href="12-statistics.html#création-dune-seule-fonction-comprenant-tableau-et-graphe"><i class="fa fa-check"></i><b>2.4.3</b> Création d’une seule fonction comprenant tableau et graphe</a></li>
<li class="chapter" data-level="2.4.4" data-path="12-statistics.html"><a href="12-statistics.html#et-pour-distinguer-par-groupe-et-pour-avoir-des-moyennes"><i class="fa fa-check"></i><b>2.4.4</b> Et pour distinguer par groupe ? Et pour avoir des moyennes… ?</a></li>
<li class="chapter" data-level="2.4.5" data-path="12-statistics.html"><a href="12-statistics.html#enregistrerstocker-ses-fonctions"><i class="fa fa-check"></i><b>2.4.5</b> Enregistrer/Stocker ses fonctions</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="21-cartography_V2.html"><a href="21-cartography_V2.html"><i class="fa fa-check"></i><b>3</b> Analyse cartographique avec mapsf (new)</a>
<ul>
<li class="chapter" data-level="3.1" data-path="21-cartography_V2.html"><a href="21-cartography_V2.html#introduction-2"><i class="fa fa-check"></i><b>3.1</b> Introduction</a>
<ul>
<li class="chapter" data-level="3.1.1" data-path="21-cartography_V2.html"><a href="21-cartography_V2.html#packages-utilisés"><i class="fa fa-check"></i><b>3.1.1</b> Packages utilisés</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="21-cartography_V2.html"><a href="21-cartography_V2.html#préparation-des-données"><i class="fa fa-check"></i><b>3.2</b> Préparation des données</a>
<ul>
<li class="chapter" data-level="3.2.1" data-path="21-cartography_V2.html"><a href="21-cartography_V2.html#chargement-des-fichiers-de-référence"><i class="fa fa-check"></i><b>3.2.1</b> Chargement des fichiers de référence</a></li>
<li class="chapter" data-level="3.2.2" data-path="21-cartography_V2.html"><a href="21-cartography_V2.html#choix-dun-indicateur"><i class="fa fa-check"></i><b>3.2.2</b> Choix d’un indicateur</a></li>
<li class="chapter" data-level="3.2.3" data-path="21-cartography_V2.html"><a href="21-cartography_V2.html#création-du-tableau-de-contingence"><i class="fa fa-check"></i><b>3.2.3</b> Création du tableau de contingence</a></li>
<li class="chapter" data-level="3.2.4" data-path="21-cartography_V2.html"><a href="21-cartography_V2.html#création-dun-tableau-de-pourcentages-en-ligne"><i class="fa fa-check"></i><b>3.2.4</b> Création d’un tableau de pourcentages en ligne</a></li>
<li class="chapter" data-level="3.2.5" data-path="21-cartography_V2.html"><a href="21-cartography_V2.html#estimation-du-nombre-moyen-dautomobile-par-menages"><i class="fa fa-check"></i><b>3.2.5</b> Estimation du nombre moyen d’automobile par menages</a></li>
<li class="chapter" data-level="3.2.6" data-path="21-cartography_V2.html"><a href="21-cartography_V2.html#analyse-statistique-des-vraiables"><i class="fa fa-check"></i><b>3.2.6</b> Analyse statistique des vraiables</a></li>
<li class="chapter" data-level="3.2.7" data-path="21-cartography_V2.html"><a href="21-cartography_V2.html#jointure-avec-le-fonds-de-carte"><i class="fa fa-check"></i><b>3.2.7</b> Jointure avec le fonds de carte</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="21-cartography_V2.html"><a href="21-cartography_V2.html#le-package-mapsf"><i class="fa fa-check"></i><b>3.3</b> Le package mapsf</a>
<ul>
<li class="chapter" data-level="3.3.1" data-path="21-cartography_V2.html"><a href="21-cartography_V2.html#création-dun-template-cartographique"><i class="fa fa-check"></i><b>3.3.1</b> Création d’un template cartographique</a></li>
<li class="chapter" data-level="3.3.2" data-path="21-cartography_V2.html"><a href="21-cartography_V2.html#carte-de-stock"><i class="fa fa-check"></i><b>3.3.2</b> Carte de stock</a></li>
<li class="chapter" data-level="3.3.3" data-path="21-cartography_V2.html"><a href="21-cartography_V2.html#carte-dintensité-choroplèthe"><i class="fa fa-check"></i><b>3.3.3</b> Carte d’intensité (choroplèthe)</a></li>
<li class="chapter" data-level="3.3.4" data-path="21-cartography_V2.html"><a href="21-cartography_V2.html#carte-de-stock-intensité"><i class="fa fa-check"></i><b>3.3.4</b> Carte de stock + intensité</a></li>
</ul></li>
<li class="chapter" data-level="3.4" data-path="21-cartography_V2.html"><a href="21-cartography_V2.html#création-de-fonctions"><i class="fa fa-check"></i><b>3.4</b> Création de fonctions</a>
<ul>
<li class="chapter" data-level="3.4.1" data-path="21-cartography_V2.html"><a href="21-cartography_V2.html#fonction-tab_cont_iris"><i class="fa fa-check"></i><b>3.4.1</b> fonction tab_cont_iris()</a></li>
<li class="chapter" data-level="3.4.2" data-path="21-cartography_V2.html"><a href="21-cartography_V2.html#fonction-map_count_iris"><i class="fa fa-check"></i><b>3.4.2</b> fonction map_count_iris</a></li>
<li class="chapter" data-level="3.4.3" data-path="21-cartography_V2.html"><a href="21-cartography_V2.html#fonction-map_pct_iris"><i class="fa fa-check"></i><b>3.4.3</b> fonction map_pct_iris</a></li>
<li class="chapter" data-level="3.4.4" data-path="21-cartography_V2.html"><a href="21-cartography_V2.html#sauvegarde-des-fonctions"><i class="fa fa-check"></i><b>3.4.4</b> Sauvegarde des fonctions</a></li>
</ul></li>
</ul></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Projet DATA MINING 2021</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="c12-statistics1" class="section level1" number="2">
<h1><span class="header-section-number">Chapitre 2</span> Analyse statistique I (C.S.)</h1>
<div align="justify">


<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="12-statistics.html#cb1-1"></a><span class="co"># On charge les librairies principales que l&#39;on va utiliser</span></span>
<span id="cb1-2"><a href="12-statistics.html#cb1-2"></a><span class="kw">library</span>(knitr)</span>
<span id="cb1-3"><a href="12-statistics.html#cb1-3"></a><span class="kw">library</span>(tidyverse)</span>
<span id="cb1-4"><a href="12-statistics.html#cb1-4"></a><span class="kw">library</span>(data.table)</span>
<span id="cb1-5"><a href="12-statistics.html#cb1-5"></a><span class="kw">library</span>(questionr)</span>
<span id="cb1-6"><a href="12-statistics.html#cb1-6"></a><span class="kw">library</span>(RColorBrewer)</span></code></pre></div>
<div id="introduction-1" class="section level2" number="2.1">
<h2><span class="header-section-number">2.1</span> Introduction</h2>
<div id="les-données-du-recensement-de-la-population-rp" class="section level3" number="2.1.1">
<h3><span class="header-section-number">2.1.1</span> Les données du Recensement de la Population (RP)</h3>
<p>Il existe plusieurs fichiers disponibles sur le site de l’Insee concernant l’enquête du Recensement de la Population, la dernière année disponible datant de 2017. Ces fichiers sont lourds, ils peuvent être téléchargés par zone, c’est ce que nous allons faire ensuite.</p>
<p>Soit vous le téléchargez <em>via</em> internet et enregistrez le fichier dans un de vos dossiers bien spécifiés et vous le “dézippez”, soit vous le télécharger directement dans <code>R</code>.</p>
<p>On va s’intéresser au fichier “Individus localisés au canton-ou-ville” : on le télécharge pour la zone A c’est-à-dire l’Ile-de-France.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="12-statistics.html#cb2-1"></a><span class="kw">download.file</span>(<span class="dt">url=</span><span class="st">&quot;https://www.insee.fr/fr/statistiques/fichier/4802064/RP2017_INDCVIZA_csv.zip&quot;</span>, </span>
<span id="cb2-2"><a href="12-statistics.html#cb2-2"></a>              <span class="dt">destfile =</span> <span class="st">&quot;tmp/RP2017_INDCVIZA_csv.zip&quot;</span>)</span>
<span id="cb2-3"><a href="12-statistics.html#cb2-3"></a><span class="co">#Le fichier a donc été téléchargé dans le dossier intitulé &quot;tmp&quot; du projet R, on va maintenant le dézippé et enregistrer les fichiers extraits dans le même dossier.</span></span>
<span id="cb2-4"><a href="12-statistics.html#cb2-4"></a><span class="kw">unzip</span>(<span class="st">&quot;tmp/RP2017_INDCVIZA_csv.zip&quot;</span>, </span>
<span id="cb2-5"><a href="12-statistics.html#cb2-5"></a>      <span class="dt">exdir =</span> <span class="st">&quot;tmp&quot;</span>)</span></code></pre></div>
<p>Il nous reste plus qu’à charger les données dans R : pour cela on utilise la commande <code>fread</code> du package <code>data.table</code> car cela va bien plus vite que les fonctions plus habituelles du type <code>read.csv</code>, et on vérifie en regardant les premiers éléments de la table qu’elle a bien été chargée :</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="12-statistics.html#cb3-1"></a><span class="co">#library(data.table)</span></span>
<span id="cb3-2"><a href="12-statistics.html#cb3-2"></a>RP &lt;-<span class="st"> </span><span class="kw">fread</span>(<span class="st">&quot;tmp/FD_INDCVIZA_2017.csv&quot;</span>, <span class="dt">stringsAsFactors=</span><span class="ot">TRUE</span>)</span>
<span id="cb3-3"><a href="12-statistics.html#cb3-3"></a>RP &lt;-<span class="st"> </span><span class="kw">as.data.frame</span>(RP)</span>
<span id="cb3-4"><a href="12-statistics.html#cb3-4"></a><span class="kw">head</span>(RP)</span>
<span id="cb3-5"><a href="12-statistics.html#cb3-5"></a><span class="kw">str</span>(RP)</span></code></pre></div>
<p>On a donc 88 variables et plus de 4 341 175 observations pour l’ensemble de l’Ile de France. Le fait que le nombre d’individus recensés soit inférieur à la population totale de l’Ile de France (plus de 12 millions d’habitants au RP 2017) s’explique par les méthodes de sondage utilisées dans le nouveau recensement en France depuis les années 2000. C’est la raison pour laquelle tous les calculs doivent être pondérés par la variable <code>IPONDI</code>pour être représentatifs</p>
<p>Certaines des variables ont été codées comme numériques alors que, selon le dictionnaire des variables, elles devraient être toutes en caractères ou ici dans <code>R</code> en facteurs, on va regarder quelles variables sont concernées et on va les transformer pour qu’elles soient dans le bon format. Ci-dessous, la fonction <code>select_if</code> du package <code>dplyr</code> permet de sélectionner les variables avec une condition (d’où le “if”) donnée entre parenthèses, ici donc si ces variables ont le format “numeric” :</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="12-statistics.html#cb4-1"></a>RP <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb4-2"><a href="12-statistics.html#cb4-2"></a><span class="st">  </span><span class="kw">select_if</span>(is.numeric) <span class="op">%&gt;%</span></span>
<span id="cb4-3"><a href="12-statistics.html#cb4-3"></a><span class="st">  </span><span class="kw">names</span>()</span></code></pre></div>
<p>On en a 23 sur 88, mais attention il y a la variable de pondération <code>IPONDI</code> qui, elle, doit rester numérique, donc on peut procéder au changement de type pour l’ensemble de ces variables sauf celle de pondération, avec la fonction <code>mutate_at</code> en spécifiant l’ensemble des variables concernées (copiées-collées depuis la sortie précédente en veillant bien sûr à bien enlever <code>IPONDI</code>), et vérifier.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="12-statistics.html#cb5-1"></a>RP <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb5-2"><a href="12-statistics.html#cb5-2"></a><span class="st">  </span><span class="kw">mutate_at</span>(<span class="kw">c</span>(<span class="st">&quot;AGED&quot;</span>, <span class="st">&quot;AGER20&quot;</span>, <span class="st">&quot;AGEREV&quot;</span>, <span class="st">&quot;AGEREVQ&quot;</span>, <span class="st">&quot;ANAI&quot;</span>, <span class="st">&quot;CATPC&quot;</span>, <span class="st">&quot;COUPLE&quot;</span>, <span class="st">&quot;CS1&quot;</span>, <span class="st">&quot;DEPT&quot;</span>,</span>
<span id="cb5-3"><a href="12-statistics.html#cb5-3"></a>              <span class="st">&quot;ETUD&quot;</span>, <span class="st">&quot;IMMI&quot;</span>, <span class="st">&quot;INAI&quot;</span>, <span class="st">&quot;INATC&quot;</span>, <span class="st">&quot;MOCO&quot;</span>, <span class="st">&quot;MODV&quot;</span>, <span class="st">&quot;NAIDT&quot;</span>, <span class="st">&quot;ORIDT&quot;</span>, <span class="st">&quot;REGION&quot;</span>, <span class="st">&quot;SEXE&quot;</span>,</span>
<span id="cb5-4"><a href="12-statistics.html#cb5-4"></a>              <span class="st">&quot;STAT_CONJ&quot;</span>,<span class="st">&quot;TACT&quot;</span>,  <span class="st">&quot;TACTD16&quot;</span>), factor) <span class="op">%&gt;%</span></span>
<span id="cb5-5"><a href="12-statistics.html#cb5-5"></a><span class="st">  </span><span class="kw">select_if</span>(is.numeric) <span class="op">%&gt;%</span></span>
<span id="cb5-6"><a href="12-statistics.html#cb5-6"></a><span class="st">  </span><span class="kw">head</span>(<span class="dv">5</span>)</span></code></pre></div>
<p>On remplace maintenant la table et dans le même temps on ne garde que le département du Val de Marne (variable <code>DEPT</code>, modalité <code>'94'</code>) sur lequel on va travailler. On procède donc finalement avec le code suivant :</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="12-statistics.html#cb6-1"></a>RP &lt;-<span class="st"> </span>RP <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb6-2"><a href="12-statistics.html#cb6-2"></a><span class="st">        </span><span class="kw">mutate_at</span>(<span class="kw">c</span>(<span class="st">&quot;AGED&quot;</span>, <span class="st">&quot;AGER20&quot;</span>, <span class="st">&quot;AGEREV&quot;</span>, <span class="st">&quot;AGEREVQ&quot;</span>, <span class="st">&quot;ANAI&quot;</span>, <span class="st">&quot;CATPC&quot;</span>, <span class="st">&quot;COUPLE&quot;</span>, <span class="st">&quot;CS1&quot;</span>, <span class="st">&quot;DEPT&quot;</span>,</span>
<span id="cb6-3"><a href="12-statistics.html#cb6-3"></a>                    <span class="st">&quot;ETUD&quot;</span>, <span class="st">&quot;IMMI&quot;</span>, <span class="st">&quot;INAI&quot;</span>, <span class="st">&quot;INATC&quot;</span>, <span class="st">&quot;MOCO&quot;</span>, <span class="st">&quot;MODV&quot;</span>, <span class="st">&quot;NAIDT&quot;</span>, <span class="st">&quot;ORIDT&quot;</span>, <span class="st">&quot;REGION&quot;</span>, <span class="st">&quot;SEXE&quot;</span>,</span>
<span id="cb6-4"><a href="12-statistics.html#cb6-4"></a>                    <span class="st">&quot;STAT_CONJ&quot;</span>, <span class="st">&quot;TACT&quot;</span>,  <span class="st">&quot;TACTD16&quot;</span>), factor) <span class="op">%&gt;%</span></span>
<span id="cb6-5"><a href="12-statistics.html#cb6-5"></a><span class="st">        </span><span class="kw">filter</span>(DEPT<span class="op">==</span><span class="st">&#39;94&#39;</span>) </span></code></pre></div>
<p>On se retrouve avec une table moins lourde puisqu’il y a dorénavant 530 007 observations.</p>
<p>On peut enregistrer ce fichier, ainsi que celui contenant les métadonnées dans le dossier <code>R</code> au format RDS avec la fonction <code>saveRDS</code>.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="12-statistics.html#cb7-1"></a><span class="kw">saveRDS</span>(<span class="dt">object =</span> RP,</span>
<span id="cb7-2"><a href="12-statistics.html#cb7-2"></a>        <span class="dt">file =</span> <span class="st">&quot;data/indiv2017.Rdata&quot;</span>)</span>
<span id="cb7-3"><a href="12-statistics.html#cb7-3"></a><span class="co"># Lecture du fichier de métadonnées et enregistrement dans le dossier Data de notre projet</span></span>
<span id="cb7-4"><a href="12-statistics.html#cb7-4"></a>meta &lt;-<span class="st"> </span><span class="kw">fread</span>(<span class="st">&quot;tmp/varmod_INDCVI_2017.csv&quot;</span>)</span>
<span id="cb7-5"><a href="12-statistics.html#cb7-5"></a><span class="co"># Enregistrement dans le dossier data</span></span>
<span id="cb7-6"><a href="12-statistics.html#cb7-6"></a><span class="kw">saveRDS</span>(<span class="dt">object =</span> meta,</span>
<span id="cb7-7"><a href="12-statistics.html#cb7-7"></a>        <span class="dt">file =</span> <span class="st">&quot;data/indiv_2017_meta.Rdata&quot;</span>)</span></code></pre></div>
<p>Pour l’importer, il faudra utiliser la fonction <code>readRDS</code>, comme l’exemple ci-dessous (sans l’exécuter) :</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="12-statistics.html#cb8-1"></a>RP&lt;-<span class="kw">readRDS</span>(<span class="dt">file =</span><span class="st">&quot;data/indiv2017.Rdata&quot;</span>) </span></code></pre></div>
</div>
<div id="quelles-variables-sont-présentes-dans-les-données-quelle-spécificité" class="section level3" number="2.1.2">
<h3><span class="header-section-number">2.1.2</span> Quelles variables sont présentes dans les données ? Quelle spécificité ?</h3>
<p>L’une des difficultés pour l’analyse de cette base de données réside dans les différents niveaux présents : “individu” pour la personne de référence du ménage ; “ménage” regroupant l’ensemble des occupants d’une résidence principale, qu’ils aient ou non des liens de parenté ; “famille” partie d’un ménage comprenant au moins 2 personnes (par exemple, un couple, ou un adulte avec un enfant…) ; et enfin “logement” qui comprend ici les <strong>résidences principales</strong>, et rassemble des informations décrivant les types de logement.</p>
<p>Pour se familiariser avec cette base de données, puisque cette année le projet que vous devrez réaliser porte sur cette base, il faut d’abord étudier les variables qu’elle contient. Un premier travail va ainsi consister à trier les 88 variables selon 5 thèmes :</p>
<ul>
<li>variables décrivant le logement ;</li>
<li>variables décrivant le ménage ;</li>
<li>variables décrivant la famille ;</li>
<li>variables décrivant l’individu ;</li>
<li>variables géographiques.</li>
</ul>
<p>Une fois cela effectué, il faut comprendre comment utiliser à bon escient ces différents niveaux. Ainsi, pour toute variable au niveau logement, ménage et famille, il faudra utiliser un filtre : ne prendre que la personne de référence du ménage. On peut toutefois vouloir donner des statistiques sur la “population des ménages”. C’est ce que nous allons voir, en prenant appui sur les statistiques produites par l’Insee pour ce département.</p>
</div>
</div>
<div id="quelques-statistiques-sur-les-logements-et-ménages" class="section level2" number="2.2">
<h2><span class="header-section-number">2.2</span> Quelques statistiques sur les logements et ménages</h2>
<p><strong>Premier exercice à faire</strong> : étudier l’équipement automobile des ménages, en essayant de retrouver les statistiques ci-dessous de l’Insee dont la source est <a href="https://www.insee.fr/fr/statistiques/4515899?sommaire=4515952&amp;geo=DEP-94">ici</a>.</p>
<center>
<p><img src="img/Equipement%20automobile%20des%20m%C3%A9nages_94_RP2017.png" /></p>
</center>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="12-statistics.html#cb9-1"></a><span class="co">#Emplacement stationnement : </span></span>
<span id="cb9-2"><a href="12-statistics.html#cb9-2"></a>RP <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb9-3"><a href="12-statistics.html#cb9-3"></a><span class="st">  </span><span class="kw">filter</span>(LPRM<span class="op">==</span><span class="st">&quot;1&quot;</span>) <span class="op">%&gt;%</span></span>
<span id="cb9-4"><a href="12-statistics.html#cb9-4"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">Stationnement=</span><span class="kw">recode</span>(GARL, <span class="st">&quot;1&quot;</span>=<span class="st">&quot;Au moins un emplacement réservé au stationnement&quot;</span>, </span>
<span id="cb9-5"><a href="12-statistics.html#cb9-5"></a>                     <span class="st">&quot;2&quot;</span> =<span class="st"> &quot;Aucun emplacement&quot;</span>)) <span class="op">%&gt;%</span></span>
<span id="cb9-6"><a href="12-statistics.html#cb9-6"></a><span class="st">  </span><span class="kw">count</span>(Stationnement, <span class="dt">wt=</span>IPONDI) <span class="op">%&gt;%</span><span class="st">  </span></span>
<span id="cb9-7"><a href="12-statistics.html#cb9-7"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">n=</span><span class="kw">round</span>(n,<span class="dv">0</span>),<span class="dt">pct=</span><span class="kw">prop.table</span>(n)<span class="op">*</span><span class="dv">100</span>, <span class="dt">pct=</span><span class="kw">round</span>(pct, <span class="dv">1</span>)) <span class="op">%&gt;%</span></span>
<span id="cb9-8"><a href="12-statistics.html#cb9-8"></a><span class="st">  </span><span class="kw">kable</span>(<span class="dt">format.args =</span> <span class="kw">list</span>(<span class="dt">big.mark =</span> <span class="st">&quot; &quot;</span>))</span></code></pre></div>
<table>
<thead>
<tr>
<th style="text-align:left;">
Stationnement
</th>
<th style="text-align:right;">
n
</th>
<th style="text-align:right;">
pct
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
Au moins un emplacement réservé au stationnement
</td>
<td style="text-align:right;">
321 768
</td>
<td style="text-align:right;">
54.8
</td>
</tr>
<tr>
<td style="text-align:left;">
Aucun emplacement
</td>
<td style="text-align:right;">
264 910
</td>
<td style="text-align:right;">
45.2
</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="12-statistics.html#cb10-1"></a><span class="co">#Voiture : </span></span>
<span id="cb10-2"><a href="12-statistics.html#cb10-2"></a>RP <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb10-3"><a href="12-statistics.html#cb10-3"></a><span class="st">  </span><span class="kw">filter</span>(LPRM<span class="op">==</span><span class="st">&quot;1&quot;</span>) <span class="op">%&gt;%</span></span>
<span id="cb10-4"><a href="12-statistics.html#cb10-4"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">Voiture=</span><span class="kw">case_when</span>(VOIT <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;1&quot;</span>, <span class="st">&quot;2&quot;</span>, <span class="st">&quot;3&quot;</span>) <span class="op">~</span><span class="st"> &quot;Au moins une voiture&quot;</span>,</span>
<span id="cb10-5"><a href="12-statistics.html#cb10-5"></a>                        VOIT<span class="op">==</span><span class="st">&quot;0&quot;</span> <span class="op">~</span><span class="st"> &quot;Pas de voiture&quot;</span>)) <span class="op">%&gt;%</span></span>
<span id="cb10-6"><a href="12-statistics.html#cb10-6"></a><span class="st">  </span><span class="kw">count</span>(Voiture, <span class="dt">wt=</span>IPONDI) <span class="op">%&gt;%</span></span>
<span id="cb10-7"><a href="12-statistics.html#cb10-7"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">n=</span><span class="kw">round</span>(n,<span class="dv">0</span>),<span class="dt">pct=</span><span class="kw">prop.table</span>(n)<span class="op">*</span><span class="dv">100</span>, <span class="dt">pct=</span><span class="kw">round</span>(pct, <span class="dv">1</span>)) <span class="op">%&gt;%</span></span>
<span id="cb10-8"><a href="12-statistics.html#cb10-8"></a><span class="st">  </span><span class="kw">kable</span>(<span class="dt">format.args =</span> <span class="kw">list</span>(<span class="dt">big.mark =</span> <span class="st">&quot; &quot;</span>))</span></code></pre></div>
<table>
<thead>
<tr>
<th style="text-align:left;">
Voiture
</th>
<th style="text-align:right;">
n
</th>
<th style="text-align:right;">
pct
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
Au moins une voiture
</td>
<td style="text-align:right;">
400 704
</td>
<td style="text-align:right;">
68.3
</td>
</tr>
<tr>
<td style="text-align:left;">
Pas de voiture
</td>
<td style="text-align:right;">
185 974
</td>
<td style="text-align:right;">
31.7
</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="12-statistics.html#cb11-1"></a>RP <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb11-2"><a href="12-statistics.html#cb11-2"></a><span class="st">  </span><span class="kw">filter</span>(LPRM<span class="op">==</span><span class="st">&quot;1&quot;</span>) <span class="op">%&gt;%</span></span>
<span id="cb11-3"><a href="12-statistics.html#cb11-3"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">Nb_voiture=</span><span class="kw">case_when</span>(VOIT<span class="op">==</span><span class="st">&quot;1&quot;</span> <span class="op">~</span><span class="st"> &quot;1 voiture&quot;</span>, VOIT <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;2&quot;</span>, <span class="st">&quot;3&quot;</span>) <span class="op">~</span><span class="st"> &quot;2 voitures ou plus&quot;</span>,</span>
<span id="cb11-4"><a href="12-statistics.html#cb11-4"></a>                           VOIT<span class="op">==</span><span class="st">&quot;0&quot;</span> <span class="op">~</span><span class="st"> &quot;Pas de voiture&quot;</span>)) <span class="op">%&gt;%</span></span>
<span id="cb11-5"><a href="12-statistics.html#cb11-5"></a><span class="st">  </span><span class="kw">count</span>(Nb_voiture, <span class="dt">wt=</span>IPONDI) <span class="op">%&gt;%</span></span>
<span id="cb11-6"><a href="12-statistics.html#cb11-6"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">n=</span><span class="kw">round</span>(n,<span class="dv">0</span>),<span class="dt">pct=</span><span class="kw">prop.table</span>(n)<span class="op">*</span><span class="dv">100</span>, <span class="dt">pct=</span><span class="kw">round</span>(pct, <span class="dv">1</span>)) <span class="op">%&gt;%</span></span>
<span id="cb11-7"><a href="12-statistics.html#cb11-7"></a><span class="st">  </span><span class="kw">kable</span>(<span class="dt">format.args =</span> <span class="kw">list</span>(<span class="dt">big.mark =</span> <span class="st">&quot; &quot;</span>))</span></code></pre></div>
<table>
<thead>
<tr>
<th style="text-align:left;">
Nb_voiture
</th>
<th style="text-align:right;">
n
</th>
<th style="text-align:right;">
pct
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
1 voiture
</td>
<td style="text-align:right;">
295 286
</td>
<td style="text-align:right;">
50.3
</td>
</tr>
<tr>
<td style="text-align:left;">
2 voitures ou plus
</td>
<td style="text-align:right;">
105 418
</td>
<td style="text-align:right;">
18.0
</td>
</tr>
<tr>
<td style="text-align:left;">
Pas de voiture
</td>
<td style="text-align:right;">
185 974
</td>
<td style="text-align:right;">
31.7
</td>
</tr>
</tbody>
</table>
<p><strong>Second exercice à faire</strong> : étudier l’ancienneté d’emménagement dans la résidence principale en 2017, en essayant de retrouver de même les statistiques ci-dessous de l’Insee (même source : <a href="https://www.insee.fr/fr/statistiques/4515899?sommaire=4515952&amp;geo=DEP-94">ici</a>) :</p>
<center>
<p><img src="img/Ancienneté%20d&#39;emménagement%20dans%20la%20résidence%20principale%20en%202017.png" /></p>
</center>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="12-statistics.html#cb12-1"></a><span class="co">#Ancienneté d&#39;emménagement en nombre de ménage</span></span>
<span id="cb12-2"><a href="12-statistics.html#cb12-2"></a>RP <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb12-3"><a href="12-statistics.html#cb12-3"></a><span class="st">  </span><span class="kw">filter</span>(LPRM<span class="op">==</span><span class="st">&quot;1&quot;</span>) <span class="op">%&gt;%</span></span>
<span id="cb12-4"><a href="12-statistics.html#cb12-4"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">Anciennete=</span><span class="kw">case_when</span>(ANEMR<span class="op">==</span><span class="st">&quot;00&quot;</span> <span class="op">~</span><span class="st"> &quot;Depuis moins de 2 ans&quot;</span>, ANEMR<span class="op">==</span><span class="st">&quot;01&quot;</span> <span class="op">~</span><span class="st"> &quot;De 2 à 4 ans&quot;</span>,</span>
<span id="cb12-5"><a href="12-statistics.html#cb12-5"></a>                       ANEMR<span class="op">==</span><span class="st">&quot;02&quot;</span> <span class="op">~</span><span class="st"> &quot;De 5 à 9 ans&quot;</span>, <span class="kw">as.numeric</span>(ANEMR)<span class="op">&gt;</span><span class="dv">3</span> <span class="op">~</span><span class="st"> &quot;10 ans ou plus&quot;</span>),</span>
<span id="cb12-6"><a href="12-statistics.html#cb12-6"></a>         <span class="dt">Anciennete =</span> <span class="kw">factor</span>(Anciennete, </span>
<span id="cb12-7"><a href="12-statistics.html#cb12-7"></a>                      <span class="dt">levels=</span><span class="kw">c</span>(<span class="st">&quot;Depuis moins de 2 ans&quot;</span>,<span class="st">&quot;De 2 à 4 ans&quot;</span>,<span class="st">&quot;De 5 à 9 ans&quot;</span>,<span class="st">&quot;10 ans ou plus&quot;</span>))) <span class="op">%&gt;%</span></span>
<span id="cb12-8"><a href="12-statistics.html#cb12-8"></a><span class="st">  </span><span class="kw">count</span>(Anciennete, <span class="dt">wt=</span>IPONDI) <span class="op">%&gt;%</span></span>
<span id="cb12-9"><a href="12-statistics.html#cb12-9"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">n=</span><span class="kw">round</span>(n,<span class="dv">0</span>),<span class="dt">pct=</span><span class="kw">prop.table</span>(n)<span class="op">*</span><span class="dv">100</span>, <span class="dt">pct=</span><span class="kw">round</span>(pct, <span class="dv">1</span>)) <span class="op">%&gt;%</span></span>
<span id="cb12-10"><a href="12-statistics.html#cb12-10"></a><span class="st">  </span><span class="kw">bind_rows</span>(<span class="kw">summarise</span>(<span class="dt">Anciennete =</span> <span class="st">&quot;Ensemble&quot;</span>, RP[RP<span class="op">$</span>LPRM<span class="op">==</span><span class="st">&quot;1&quot;</span>, ], <span class="dt">n =</span> <span class="kw">sum</span>(IPONDI), <span class="dt">pct =</span> <span class="fl">100.0</span>)) <span class="op">%&gt;%</span></span>
<span id="cb12-11"><a href="12-statistics.html#cb12-11"></a><span class="st">  </span><span class="kw">kable</span>(<span class="dt">format.args =</span> <span class="kw">list</span>(<span class="dt">big.mark =</span> <span class="st">&quot; &quot;</span>))</span></code></pre></div>
<table>
<thead>
<tr>
<th style="text-align:left;">
Anciennete
</th>
<th style="text-align:right;">
n
</th>
<th style="text-align:right;">
pct
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
Depuis moins de 2 ans
</td>
<td style="text-align:right;">
67 956
</td>
<td style="text-align:right;">
11.6
</td>
</tr>
<tr>
<td style="text-align:left;">
De 2 à 4 ans
</td>
<td style="text-align:right;">
125 587
</td>
<td style="text-align:right;">
21.4
</td>
</tr>
<tr>
<td style="text-align:left;">
De 5 à 9 ans
</td>
<td style="text-align:right;">
109 449
</td>
<td style="text-align:right;">
18.7
</td>
</tr>
<tr>
<td style="text-align:left;">
10 ans ou plus
</td>
<td style="text-align:right;">
283 686
</td>
<td style="text-align:right;">
48.4
</td>
</tr>
<tr>
<td style="text-align:left;">
Ensemble
</td>
<td style="text-align:right;">
586 678
</td>
<td style="text-align:right;">
100.0
</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="12-statistics.html#cb13-1"></a><span class="co">#Ancienneté d&#39;emménagement en population des ménages</span></span>
<span id="cb13-2"><a href="12-statistics.html#cb13-2"></a>RP <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb13-3"><a href="12-statistics.html#cb13-3"></a><span class="st">  </span><span class="kw">filter</span>(CATL<span class="op">==</span><span class="st">&quot;1&quot;</span>) <span class="op">%&gt;%</span></span>
<span id="cb13-4"><a href="12-statistics.html#cb13-4"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">Anciennete=</span><span class="kw">case_when</span>(ANEMR<span class="op">==</span><span class="st">&quot;00&quot;</span> <span class="op">~</span><span class="st"> &quot;Depuis moins de 2 ans&quot;</span>, ANEMR<span class="op">==</span><span class="st">&quot;01&quot;</span> <span class="op">~</span><span class="st"> &quot;De 2 à 4 ans&quot;</span>,</span>
<span id="cb13-5"><a href="12-statistics.html#cb13-5"></a>                       ANEMR<span class="op">==</span><span class="st">&quot;02&quot;</span> <span class="op">~</span><span class="st"> &quot;De 5 à 9 ans&quot;</span>, <span class="kw">as.numeric</span>(ANEMR)<span class="op">&gt;</span><span class="dv">3</span> <span class="op">~</span><span class="st"> &quot;10 ans ou plus&quot;</span>),</span>
<span id="cb13-6"><a href="12-statistics.html#cb13-6"></a>         <span class="dt">Anciennete =</span> <span class="kw">factor</span>(Anciennete, </span>
<span id="cb13-7"><a href="12-statistics.html#cb13-7"></a>                      <span class="dt">levels=</span><span class="kw">c</span>(<span class="st">&quot;Depuis moins de 2 ans&quot;</span>,<span class="st">&quot;De 2 à 4 ans&quot;</span>,<span class="st">&quot;De 5 à 9 ans&quot;</span>,<span class="st">&quot;10 ans ou plus&quot;</span>)),</span>
<span id="cb13-8"><a href="12-statistics.html#cb13-8"></a>         <span class="dt">nb_pieces=</span><span class="kw">as.numeric</span>(<span class="kw">as.character</span>(NBPI))) <span class="op">%&gt;%</span></span>
<span id="cb13-9"><a href="12-statistics.html#cb13-9"></a><span class="st">  </span><span class="kw">count</span>(Anciennete, <span class="dt">wt=</span>IPONDI) <span class="op">%&gt;%</span></span>
<span id="cb13-10"><a href="12-statistics.html#cb13-10"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">n=</span><span class="kw">round</span>(n,<span class="dv">0</span>), <span class="dt">pct=</span><span class="kw">prop.table</span>(n)<span class="op">*</span><span class="dv">100</span>, <span class="dt">pct=</span><span class="kw">round</span>(pct, <span class="dv">1</span>)) <span class="op">%&gt;%</span></span>
<span id="cb13-11"><a href="12-statistics.html#cb13-11"></a><span class="st">  </span><span class="kw">bind_rows</span>(<span class="kw">summarise</span>(<span class="dt">Anciennete =</span> <span class="st">&quot;Ensemble&quot;</span>, RP[RP<span class="op">$</span>CATL<span class="op">==</span><span class="st">&quot;1&quot;</span>, ], <span class="dt">n =</span> <span class="kw">sum</span>(IPONDI), <span class="dt">pct =</span> <span class="fl">100.0</span>)) <span class="op">%&gt;%</span></span>
<span id="cb13-12"><a href="12-statistics.html#cb13-12"></a><span class="st">  </span><span class="kw">kable</span>(<span class="dt">format.args =</span> <span class="kw">list</span>(<span class="dt">big.mark =</span> <span class="st">&quot; &quot;</span>))</span></code></pre></div>
<table>
<thead>
<tr>
<th style="text-align:left;">
Anciennete
</th>
<th style="text-align:right;">
n
</th>
<th style="text-align:right;">
pct
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
Depuis moins de 2 ans
</td>
<td style="text-align:right;">
141 773
</td>
<td style="text-align:right;">
10.4
</td>
</tr>
<tr>
<td style="text-align:left;">
De 2 à 4 ans
</td>
<td style="text-align:right;">
296 324
</td>
<td style="text-align:right;">
21.7
</td>
</tr>
<tr>
<td style="text-align:left;">
De 5 à 9 ans
</td>
<td style="text-align:right;">
293 371
</td>
<td style="text-align:right;">
21.5
</td>
</tr>
<tr>
<td style="text-align:left;">
10 ans ou plus
</td>
<td style="text-align:right;">
632 159
</td>
<td style="text-align:right;">
46.4
</td>
</tr>
<tr>
<td style="text-align:left;">
Ensemble
</td>
<td style="text-align:right;">
1 363 627
</td>
<td style="text-align:right;">
100.0
</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="12-statistics.html#cb14-1"></a><span class="co">#Nombre moyen de pièces par logement</span></span>
<span id="cb14-2"><a href="12-statistics.html#cb14-2"></a>RP <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb14-3"><a href="12-statistics.html#cb14-3"></a><span class="st">  </span><span class="kw">filter</span>(LPRM<span class="op">==</span><span class="st">&quot;1&quot;</span>) <span class="op">%&gt;%</span></span>
<span id="cb14-4"><a href="12-statistics.html#cb14-4"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">Anciennete=</span><span class="kw">case_when</span>(ANEMR<span class="op">==</span><span class="st">&quot;00&quot;</span> <span class="op">~</span><span class="st"> &quot;Depuis moins de 2 ans&quot;</span>, ANEMR<span class="op">==</span><span class="st">&quot;01&quot;</span> <span class="op">~</span><span class="st"> &quot;De 2 à 4 ans&quot;</span>,</span>
<span id="cb14-5"><a href="12-statistics.html#cb14-5"></a>                       ANEMR<span class="op">==</span><span class="st">&quot;02&quot;</span> <span class="op">~</span><span class="st"> &quot;De 5 à 9 ans&quot;</span>, <span class="kw">as.numeric</span>(ANEMR)<span class="op">&gt;</span><span class="dv">3</span> <span class="op">~</span><span class="st"> &quot;10 ans ou plus&quot;</span>),</span>
<span id="cb14-6"><a href="12-statistics.html#cb14-6"></a>         <span class="dt">Anciennete =</span> <span class="kw">factor</span>(Anciennete, </span>
<span id="cb14-7"><a href="12-statistics.html#cb14-7"></a>                      <span class="dt">levels=</span><span class="kw">c</span>(<span class="st">&quot;Depuis moins de 2 ans&quot;</span>,<span class="st">&quot;De 2 à 4 ans&quot;</span>,<span class="st">&quot;De 5 à 9 ans&quot;</span>,<span class="st">&quot;10 ans ou plus&quot;</span>)),</span>
<span id="cb14-8"><a href="12-statistics.html#cb14-8"></a>         <span class="dt">Np_pieces=</span><span class="kw">as.numeric</span>(<span class="kw">as.character</span>(NBPI))) <span class="op">%&gt;%</span></span>
<span id="cb14-9"><a href="12-statistics.html#cb14-9"></a><span class="st">  </span><span class="kw">group_by</span>(Anciennete) <span class="op">%&gt;%</span></span>
<span id="cb14-10"><a href="12-statistics.html#cb14-10"></a><span class="st">  </span><span class="kw">summarise</span>(<span class="dt">Np_pieces_moy=</span><span class="kw">weighted.mean</span>(Np_pieces, IPONDI, <span class="dt">na.rm=</span>T)) <span class="op">%&gt;%</span></span>
<span id="cb14-11"><a href="12-statistics.html#cb14-11"></a><span class="st">  </span><span class="kw">bind_rows</span>(<span class="kw">summarise</span>(<span class="dt">Anciennete =</span> <span class="st">&quot;Ensemble&quot;</span>, RP[RP<span class="op">$</span>LPRM<span class="op">==</span><span class="st">&quot;1&quot;</span>, ],</span>
<span id="cb14-12"><a href="12-statistics.html#cb14-12"></a>                      <span class="dt">Np_pieces_moy =</span> <span class="kw">weighted.mean</span>(<span class="kw">as.numeric</span>(<span class="kw">as.character</span>(NBPI)), </span>
<span id="cb14-13"><a href="12-statistics.html#cb14-13"></a>                                                    IPONDI, <span class="dt">na.rm=</span>T))) <span class="op">%&gt;%</span></span>
<span id="cb14-14"><a href="12-statistics.html#cb14-14"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">Np_pieces_moy=</span><span class="kw">round</span>(Np_pieces_moy, <span class="dv">1</span>)) <span class="op">%&gt;%</span></span>
<span id="cb14-15"><a href="12-statistics.html#cb14-15"></a><span class="st">  </span><span class="kw">kable</span>(<span class="dt">format.args =</span> <span class="kw">list</span>(<span class="dt">big.mark =</span> <span class="st">&quot; &quot;</span>))</span></code></pre></div>
<pre><code>`summarise()` ungrouping output (override with `.groups` argument)</code></pre>
<table>
<thead>
<tr>
<th style="text-align:left;">
Anciennete
</th>
<th style="text-align:right;">
Np_pieces_moy
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
Depuis moins de 2 ans
</td>
<td style="text-align:right;">
2.6
</td>
</tr>
<tr>
<td style="text-align:left;">
De 2 à 4 ans
</td>
<td style="text-align:right;">
2.8
</td>
</tr>
<tr>
<td style="text-align:left;">
De 5 à 9 ans
</td>
<td style="text-align:right;">
3.2
</td>
</tr>
<tr>
<td style="text-align:left;">
10 ans ou plus
</td>
<td style="text-align:right;">
3.7
</td>
</tr>
<tr>
<td style="text-align:left;">
Ensemble
</td>
<td style="text-align:right;">
3.3
</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="12-statistics.html#cb16-1"></a><span class="co">#Nombre moyen de pièces par personne</span></span>
<span id="cb16-2"><a href="12-statistics.html#cb16-2"></a>RP <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb16-3"><a href="12-statistics.html#cb16-3"></a><span class="st">  </span><span class="kw">filter</span>(CATL<span class="op">==</span><span class="st">&quot;1&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb16-4"><a href="12-statistics.html#cb16-4"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">nb_pieces=</span><span class="kw">as.numeric</span>(<span class="kw">as.character</span>(NBPI)), <span class="dt">nb_pers=</span><span class="kw">as.numeric</span>(<span class="kw">as.character</span>(INPER)),</span>
<span id="cb16-5"><a href="12-statistics.html#cb16-5"></a>         <span class="dt">np_pieces_pers=</span>nb_pieces<span class="op">/</span>nb_pers,</span>
<span id="cb16-6"><a href="12-statistics.html#cb16-6"></a>         <span class="dt">Anciennete=</span><span class="kw">case_when</span>(ANEMR<span class="op">==</span><span class="st">&quot;00&quot;</span> <span class="op">~</span><span class="st"> &quot;Depuis moins de 2 ans&quot;</span>, ANEMR<span class="op">==</span><span class="st">&quot;01&quot;</span> <span class="op">~</span><span class="st"> &quot;De 2 à 4 ans&quot;</span>,</span>
<span id="cb16-7"><a href="12-statistics.html#cb16-7"></a>                       ANEMR<span class="op">==</span><span class="st">&quot;02&quot;</span> <span class="op">~</span><span class="st"> &quot;De 5 à 9 ans&quot;</span>, <span class="kw">as.numeric</span>(ANEMR)<span class="op">&gt;</span><span class="dv">3</span> <span class="op">~</span><span class="st"> &quot;10 ans ou plus&quot;</span>),</span>
<span id="cb16-8"><a href="12-statistics.html#cb16-8"></a>         <span class="dt">Anciennete =</span> <span class="kw">factor</span>(Anciennete, </span>
<span id="cb16-9"><a href="12-statistics.html#cb16-9"></a>                      <span class="dt">levels=</span><span class="kw">c</span>(<span class="st">&quot;Depuis moins de 2 ans&quot;</span>,<span class="st">&quot;De 2 à 4 ans&quot;</span>,<span class="st">&quot;De 5 à 9 ans&quot;</span>,<span class="st">&quot;10 ans ou plus&quot;</span>))) <span class="op">%&gt;%</span></span>
<span id="cb16-10"><a href="12-statistics.html#cb16-10"></a><span class="st">  </span><span class="kw">group_by</span>(Anciennete) <span class="op">%&gt;%</span></span>
<span id="cb16-11"><a href="12-statistics.html#cb16-11"></a><span class="st">  </span><span class="kw">summarise</span>(<span class="dt">Moy_pieces_pers=</span><span class="kw">weighted.mean</span>(np_pieces_pers, IPONDI, <span class="dt">na.rm=</span>T)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb16-12"><a href="12-statistics.html#cb16-12"></a><span class="st">  </span><span class="kw">bind_rows</span>(<span class="kw">summarise</span>(<span class="dt">Anciennete =</span> <span class="st">&quot;Ensemble&quot;</span>, RP[RP<span class="op">$</span>CATL<span class="op">==</span><span class="st">&quot;1&quot;</span>, ],</span>
<span id="cb16-13"><a href="12-statistics.html#cb16-13"></a>                      <span class="dt">Moy_pieces_pers=</span><span class="kw">weighted.mean</span>(<span class="kw">as.numeric</span>(<span class="kw">as.character</span>(NBPI))<span class="op">/</span><span class="kw">as.numeric</span>(<span class="kw">as.character</span>(INPER)), IPONDI, <span class="dt">na.rm=</span>T))) <span class="op">%&gt;%</span></span>
<span id="cb16-14"><a href="12-statistics.html#cb16-14"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">Moy_pieces_pers=</span><span class="kw">round</span>(Moy_pieces_pers, <span class="dv">1</span>)) <span class="op">%&gt;%</span></span>
<span id="cb16-15"><a href="12-statistics.html#cb16-15"></a><span class="st">  </span><span class="kw">kable</span>(<span class="dt">format.args =</span> <span class="kw">list</span>(<span class="dt">big.mark =</span> <span class="st">&quot; &quot;</span>))</span></code></pre></div>
<pre><code>`summarise()` ungrouping output (override with `.groups` argument)</code></pre>
<table>
<thead>
<tr>
<th style="text-align:left;">
Anciennete
</th>
<th style="text-align:right;">
Moy_pieces_pers
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
Depuis moins de 2 ans
</td>
<td style="text-align:right;">
1.2
</td>
</tr>
<tr>
<td style="text-align:left;">
De 2 à 4 ans
</td>
<td style="text-align:right;">
1.2
</td>
</tr>
<tr>
<td style="text-align:left;">
De 5 à 9 ans
</td>
<td style="text-align:right;">
1.2
</td>
</tr>
<tr>
<td style="text-align:left;">
10 ans ou plus
</td>
<td style="text-align:right;">
1.6
</td>
</tr>
<tr>
<td style="text-align:left;">
Ensemble
</td>
<td style="text-align:right;">
1.4
</td>
</tr>
</tbody>
</table>
<p>C’est néanmoins plutôt du côté des graphiques que <code>R</code> excelle en la matière, avec le fameux package <code>ggplot</code>. On va maintenant essayer de travailler ce package avec ses différentes fonctions.</p>
<p>Si besoin, pour vous aider à démarrer avec <code>ggplot</code>, 2 liens utiles : <a href="https://larmarange.github.io/analyse-R/graphiques-bivaries-ggplot2.html">ici</a> et <a href="https://r-toulouse.netlify.app/diapos/2018-09-25_ggplot2_initiation.pdf">là</a>.</p>
<p>Dans la continuité des statistiques réalisées précédemment, <strong>troisième exercice à faire</strong> : réalisez d’abord un graphique représentant l’ancienneté d’emménagement des ménages dans le Val de Marne en 2017, selon 6 catégories (“Depuis moins de 2 ans”, “De 2 à 4 ans”, “De 5 à 9 ans”, “De 10 à 19 ans”, “De 20 à 29 ans”, “30 ans ou plus”) et en pourcentage. On peut repartir du 1er code précédent en ajoutant des catégories, puis en utilisant un <code>ggplot()</code>.</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="12-statistics.html#cb18-1"></a><span class="co"># 2 exemples : </span></span>
<span id="cb18-2"><a href="12-statistics.html#cb18-2"></a></span>
<span id="cb18-3"><a href="12-statistics.html#cb18-3"></a><span class="co">#Avec geom_col() qui crée un diagramme à barres ou graphique en colonnes</span></span>
<span id="cb18-4"><a href="12-statistics.html#cb18-4"></a>RP <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb18-5"><a href="12-statistics.html#cb18-5"></a><span class="st">  </span><span class="kw">filter</span>(LPRM<span class="op">==</span><span class="st">&quot;1&quot;</span> <span class="op">&amp;</span><span class="st"> </span>CATL<span class="op">==</span><span class="st">&quot;1&quot;</span>) <span class="op">%&gt;%</span></span>
<span id="cb18-6"><a href="12-statistics.html#cb18-6"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">anc=</span><span class="kw">case_when</span>(ANEMR<span class="op">==</span><span class="st">&quot;00&quot;</span> <span class="op">~</span><span class="st"> &quot;Depuis moins de 2 ans&quot;</span>, ANEMR<span class="op">==</span><span class="st">&quot;01&quot;</span> <span class="op">~</span><span class="st"> &quot;De 2 à 4 ans&quot;</span>,</span>
<span id="cb18-7"><a href="12-statistics.html#cb18-7"></a>                       ANEMR<span class="op">==</span><span class="st">&quot;02&quot;</span> <span class="op">~</span><span class="st"> &quot;De 5 à 9 ans&quot;</span>, ANEMR<span class="op">==</span><span class="st">&quot;03&quot;</span> <span class="op">~</span><span class="st"> &quot;De 10 à 19 ans&quot;</span>,</span>
<span id="cb18-8"><a href="12-statistics.html#cb18-8"></a>                       ANEMR<span class="op">==</span><span class="st">&quot;04&quot;</span> <span class="op">~</span><span class="st"> &quot;De 20 à 29 ans&quot;</span>, <span class="kw">as.numeric</span>(ANEMR)<span class="op">&gt;=</span><span class="dv">5</span> <span class="op">~</span><span class="st"> &quot;30 ans ou plus&quot;</span>),</span>
<span id="cb18-9"><a href="12-statistics.html#cb18-9"></a>         <span class="dt">anc =</span> <span class="kw">factor</span>(anc, <span class="dt">levels=</span><span class="kw">c</span>(<span class="st">&quot;Depuis moins de 2 ans&quot;</span>, <span class="st">&quot;De 2 à 4 ans&quot;</span>, <span class="st">&quot;De 5 à 9 ans&quot;</span>,</span>
<span id="cb18-10"><a href="12-statistics.html#cb18-10"></a>                                    <span class="st">&quot;De 10 à 19 ans&quot;</span>, <span class="st">&quot;De 20 à 29 ans&quot;</span>, <span class="st">&quot;30 ans ou plus&quot;</span>))) <span class="op">%&gt;%</span></span>
<span id="cb18-11"><a href="12-statistics.html#cb18-11"></a><span class="st">  </span><span class="kw">count</span>(anc, <span class="dt">wt=</span>IPONDI) <span class="op">%&gt;%</span></span>
<span id="cb18-12"><a href="12-statistics.html#cb18-12"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">pct=</span><span class="kw">prop.table</span>(n)<span class="op">*</span><span class="dv">100</span>, <span class="dt">pct=</span><span class="kw">round</span>(pct, <span class="dv">1</span>)) <span class="op">%&gt;%</span></span>
<span id="cb18-13"><a href="12-statistics.html#cb18-13"></a><span class="st">  </span><span class="kw">ggplot</span>() <span class="op">+</span><span class="st"> </span><span class="kw">aes</span>(<span class="dt">x=</span>anc, <span class="dt">y=</span>pct, <span class="dt">fill=</span>anc) <span class="op">+</span><span class="st"> </span><span class="kw">geom_col</span>() <span class="op">+</span><span class="st"> </span><span class="kw">scale_fill_brewer</span>(<span class="dt">palette =</span> <span class="st">&quot;Set2&quot;</span>) <span class="op">+</span></span>
<span id="cb18-14"><a href="12-statistics.html#cb18-14"></a><span class="st">  </span><span class="kw">geom_text</span>(<span class="kw">aes</span>(<span class="dt">y=</span>pct, <span class="dt">label=</span>pct), <span class="dt">vjust=</span><span class="fl">1.5</span>, <span class="dt">color=</span><span class="st">&quot;gray30&quot;</span>, <span class="dt">size=</span><span class="dv">4</span>) <span class="op">+</span><span class="st"> </span></span>
<span id="cb18-15"><a href="12-statistics.html#cb18-15"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">title =</span> <span class="st">&quot;Ancienneté d&#39;emménagement des ménages en 2017 dans le Val de Marne&quot;</span>, <span class="dt">x=</span><span class="st">&quot;&quot;</span>, <span class="dt">y=</span><span class="st">&quot;&quot;</span>) <span class="op">+</span></span>
<span id="cb18-16"><a href="12-statistics.html#cb18-16"></a><span class="st">  </span><span class="kw">theme_bw</span>() <span class="op">+</span><span class="st"> </span><span class="kw">theme</span>(<span class="dt">legend.position =</span> <span class="st">&quot;none&quot;</span>) </span></code></pre></div>
<p><img src="Projet-Data-Mining-2021_files/figure-html/unnamed-chunk-12-1.svg" width="672" /></p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="12-statistics.html#cb19-1"></a><span class="co">#Ou avec geom_bar(), mais en mettant l&#39;option &quot; stat=&quot;identity&quot; &quot; car on donne déjà les valeurs avec y=pct</span></span>
<span id="cb19-2"><a href="12-statistics.html#cb19-2"></a>RP <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb19-3"><a href="12-statistics.html#cb19-3"></a><span class="st">  </span><span class="kw">filter</span>(LPRM<span class="op">==</span><span class="st">&quot;1&quot;</span> <span class="op">&amp;</span><span class="st"> </span>CATL<span class="op">==</span><span class="st">&quot;1&quot;</span>) <span class="op">%&gt;%</span></span>
<span id="cb19-4"><a href="12-statistics.html#cb19-4"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">anc=</span><span class="kw">case_when</span>(ANEMR<span class="op">==</span><span class="st">&quot;00&quot;</span> <span class="op">~</span><span class="st"> &quot;Depuis moins de 2 ans&quot;</span>, ANEMR<span class="op">==</span><span class="st">&quot;01&quot;</span> <span class="op">~</span><span class="st"> &quot;De 2 à 4 ans&quot;</span>,</span>
<span id="cb19-5"><a href="12-statistics.html#cb19-5"></a>                       ANEMR<span class="op">==</span><span class="st">&quot;02&quot;</span> <span class="op">~</span><span class="st"> &quot;De 5 à 9 ans&quot;</span>, ANEMR<span class="op">==</span><span class="st">&quot;03&quot;</span> <span class="op">~</span><span class="st"> &quot;De 10 à 19 ans&quot;</span>,</span>
<span id="cb19-6"><a href="12-statistics.html#cb19-6"></a>                       ANEMR<span class="op">==</span><span class="st">&quot;04&quot;</span> <span class="op">~</span><span class="st"> &quot;De 20 à 29 ans&quot;</span>, <span class="kw">as.numeric</span>(ANEMR)<span class="op">&gt;=</span><span class="dv">5</span> <span class="op">~</span><span class="st"> &quot;30 ans ou plus&quot;</span>),</span>
<span id="cb19-7"><a href="12-statistics.html#cb19-7"></a>         <span class="dt">anc =</span> <span class="kw">factor</span>(anc, <span class="dt">levels=</span><span class="kw">c</span>(<span class="st">&quot;Depuis moins de 2 ans&quot;</span>, <span class="st">&quot;De 2 à 4 ans&quot;</span>, <span class="st">&quot;De 5 à 9 ans&quot;</span>,</span>
<span id="cb19-8"><a href="12-statistics.html#cb19-8"></a>                                    <span class="st">&quot;De 10 à 19 ans&quot;</span>, <span class="st">&quot;De 20 à 29 ans&quot;</span>, <span class="st">&quot;30 ans ou plus&quot;</span>))) <span class="op">%&gt;%</span></span>
<span id="cb19-9"><a href="12-statistics.html#cb19-9"></a><span class="st">  </span><span class="kw">count</span>(anc, <span class="dt">wt=</span>IPONDI) <span class="op">%&gt;%</span></span>
<span id="cb19-10"><a href="12-statistics.html#cb19-10"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">pct=</span><span class="kw">prop.table</span>(n)<span class="op">*</span><span class="dv">100</span>, <span class="dt">pct=</span><span class="kw">round</span>(pct, <span class="dv">1</span>)) <span class="op">%&gt;%</span></span>
<span id="cb19-11"><a href="12-statistics.html#cb19-11"></a><span class="st">  </span><span class="kw">ggplot</span>() <span class="op">+</span><span class="st"> </span><span class="kw">aes</span>(<span class="dt">x=</span>anc, <span class="dt">y=</span>pct, <span class="dt">fill=</span>anc) <span class="op">+</span><span class="st"> </span><span class="kw">geom_bar</span>(<span class="dt">stat=</span><span class="st">&quot;identity&quot;</span>) <span class="op">+</span><span class="st"> </span><span class="kw">scale_fill_brewer</span>(<span class="dt">palette =</span> <span class="st">&quot;Dark2&quot;</span>) <span class="op">+</span></span>
<span id="cb19-12"><a href="12-statistics.html#cb19-12"></a><span class="st">  </span><span class="kw">geom_text</span>(<span class="kw">aes</span>(<span class="dt">y=</span>pct, <span class="dt">label=</span>pct), <span class="dt">vjust=</span><span class="fl">1.5</span>, <span class="dt">color=</span><span class="st">&quot;gray22&quot;</span>, <span class="dt">size=</span><span class="dv">4</span>) <span class="op">+</span><span class="st"> </span></span>
<span id="cb19-13"><a href="12-statistics.html#cb19-13"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">title =</span> <span class="st">&quot;Ancienneté d&#39;emménagement des ménages en 2017 dans le Val de Marne&quot;</span>, <span class="dt">x=</span><span class="st">&quot;&quot;</span>, <span class="dt">y=</span><span class="st">&quot;&quot;</span>) <span class="op">+</span></span>
<span id="cb19-14"><a href="12-statistics.html#cb19-14"></a><span class="st">  </span><span class="kw">theme</span>(<span class="dt">legend.position =</span> <span class="st">&quot;none&quot;</span>)</span></code></pre></div>
<p><img src="Projet-Data-Mining-2021_files/figure-html/unnamed-chunk-12-2.svg" width="672" /></p>
<p>Réalisez ensuite un graphique de la distribution du nombre de pièces par type de logement en ne considérant que les maisons et appartements. Par exemple, cela pourrait donner cela :</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb20-1"><a href="12-statistics.html#cb20-1"></a>RP <span class="op">%&gt;%</span><span class="st">   </span></span>
<span id="cb20-2"><a href="12-statistics.html#cb20-2"></a><span class="st">  </span><span class="kw">filter</span>(LPRM<span class="op">==</span><span class="st">&quot;1&quot;</span> <span class="op">&amp;</span><span class="st"> </span>TYPL <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;1&quot;</span>, <span class="st">&quot;2&quot;</span>)) <span class="op">%&gt;%</span></span>
<span id="cb20-3"><a href="12-statistics.html#cb20-3"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">nb_pieces=</span><span class="kw">as.numeric</span>(<span class="kw">as.character</span>(NBPI)), <span class="dt">TYPL=</span><span class="kw">recode</span>(TYPL, <span class="st">&quot;1&quot;</span>=<span class="st">&quot;Maison&quot;</span>, <span class="st">&quot;2&quot;</span>=<span class="st">&quot;Appartement&quot;</span>))  <span class="op">%&gt;%</span></span>
<span id="cb20-4"><a href="12-statistics.html#cb20-4"></a><span class="st">  </span><span class="kw">ggplot</span>() <span class="op">+</span><span class="st"> </span><span class="kw">aes</span>(<span class="dt">x=</span>nb_pieces, <span class="dt">y=</span>TYPL, <span class="dt">fill=</span>TYPL) <span class="op">+</span><span class="st"> </span><span class="kw">geom_boxplot</span>(<span class="dt">outlier.shape =</span> <span class="ot">NA</span>) <span class="op">+</span><span class="st"> </span><span class="kw">coord_flip</span>() <span class="op">+</span><span class="st"> </span></span>
<span id="cb20-5"><a href="12-statistics.html#cb20-5"></a><span class="st">  </span><span class="kw">stat_summary</span>(<span class="dt">fun=</span>mean, <span class="dt">geom=</span><span class="st">&quot;point&quot;</span>, <span class="dt">shape=</span><span class="dv">20</span>, <span class="dt">size=</span><span class="dv">4</span>) <span class="op">+</span><span class="st">  </span><span class="kw">scale_x_continuous</span>(<span class="dt">limits =</span> <span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">8</span>)) <span class="op">+</span></span>
<span id="cb20-6"><a href="12-statistics.html#cb20-6"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">title=</span><span class="st">&quot;Nombre de pièces par ménage selon le type de logement en 2017&quot;</span>, <span class="dt">x=</span><span class="st">&quot;Nombre de pièces&quot;</span>,</span>
<span id="cb20-7"><a href="12-statistics.html#cb20-7"></a>       <span class="dt">y=</span><span class="st">&quot;Type de logement&quot;</span>)  <span class="op">+</span><span class="st"> </span><span class="kw">theme</span>(<span class="dt">legend.position =</span> <span class="st">&quot;none&quot;</span>)</span></code></pre></div>
<p><img src="Projet-Data-Mining-2021_files/figure-html/unnamed-chunk-13-1.svg" width="672" /></p>
</div>
<div id="quelles-caractéristiques-des-individus-résidant-dans-le-val-de-marne-en-2017" class="section level2" number="2.3">
<h2><span class="header-section-number">2.3</span> Quelles caractéristiques des individus résidant dans le Val de Marne en 2017 ?</h2>
<p>On va s’intéresser maintenant aux caractéristiques des individus qui résident dans ce département du Val de Marne. On peut ainsi décrire la population selon les variables suivantes : l’âge, le sexe, la situation quant à l’immigration, le diplôme, la catégorie sociale, le type d’activité ou encore les conditions d’emploi.</p>
<p><strong>Premier exercice à faire</strong> : faire un graphique décrivant la population de 15 ans ou plus selon la catégorie socioprofessionnelle (CS). Puis un second, différenciant la population par sexe, en plus de la CS (vous pourrez enlever les agriculteurs peu nombreux).</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="12-statistics.html#cb21-1"></a><span class="co">#Population de 15 ans ou plus selon la catégorie socioprofessionnelle (et sans les agriculteurs trop peu nombreux)</span></span>
<span id="cb21-2"><a href="12-statistics.html#cb21-2"></a>RP <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb21-3"><a href="12-statistics.html#cb21-3"></a><span class="st">  </span><span class="kw">filter</span>(<span class="op">!</span>AGER20 <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;02&quot;</span>, <span class="st">&quot;05&quot;</span>, <span class="st">&quot;10&quot;</span>, <span class="st">&quot;14&quot;</span>) <span class="op">&amp;</span><span class="st"> </span>TACT<span class="op">!=</span><span class="st">&quot;23&quot;</span> <span class="op">&amp;</span><span class="st"> </span>CS1<span class="op">!=</span><span class="st">&quot;1&quot;</span>) <span class="op">%&gt;%</span></span>
<span id="cb21-4"><a href="12-statistics.html#cb21-4"></a><span class="st">  </span><span class="kw">count</span>(CS1, <span class="dt">wt=</span>IPONDI) <span class="op">%&gt;%</span></span>
<span id="cb21-5"><a href="12-statistics.html#cb21-5"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">pct=</span><span class="kw">prop.table</span>(n)<span class="op">*</span><span class="dv">100</span>, <span class="dt">pct=</span><span class="kw">round</span>(pct, <span class="dv">1</span>),</span>
<span id="cb21-6"><a href="12-statistics.html#cb21-6"></a>         <span class="dt">CS1=</span><span class="kw">recode</span>(CS1, <span class="st">&quot;2&quot;</span>=<span class="st">&quot;Artisans, commerçants et chefs d&#39;entreprise&quot;</span>, </span>
<span id="cb21-7"><a href="12-statistics.html#cb21-7"></a>                    <span class="st">&quot;3&quot;</span>=<span class="st">&quot;Cadres et professions intellectuelles supérieures&quot;</span>, </span>
<span id="cb21-8"><a href="12-statistics.html#cb21-8"></a>                    <span class="st">&quot;4&quot;</span>=<span class="st">&quot;Professions Intermédiaires&quot;</span>, <span class="st">&quot;5&quot;</span>=<span class="st">&quot;Employés&quot;</span>, <span class="st">&quot;6&quot;</span>=<span class="st">&quot;Ouvriers&quot;</span>,</span>
<span id="cb21-9"><a href="12-statistics.html#cb21-9"></a>                    <span class="st">&quot;7&quot;</span>=<span class="st">&quot;Retraités&quot;</span>, <span class="st">&quot;8&quot;</span>=<span class="st">&quot;Autres personnes sans activité professionnelle&quot;</span>)) <span class="op">%&gt;%</span></span>
<span id="cb21-10"><a href="12-statistics.html#cb21-10"></a><span class="st">  </span><span class="kw">ggplot</span>() <span class="op">+</span><span class="st"> </span><span class="kw">aes</span>(<span class="dt">x=</span>CS1, <span class="dt">y=</span>pct, <span class="dt">fill=</span>CS1) <span class="op">+</span><span class="st"> </span><span class="kw">geom_col</span>() <span class="op">+</span><span class="st"> </span><span class="kw">scale_fill_brewer</span>(<span class="dt">palette =</span> <span class="st">&quot;Set2&quot;</span>) <span class="op">+</span></span>
<span id="cb21-11"><a href="12-statistics.html#cb21-11"></a><span class="st">  </span><span class="kw">geom_text</span>(<span class="kw">aes</span>(<span class="dt">y=</span>pct, <span class="dt">label=</span>pct), <span class="dt">vjust=</span><span class="fl">1.5</span>, <span class="dt">color=</span><span class="st">&quot;gray30&quot;</span>, <span class="dt">size=</span><span class="dv">4</span>) <span class="op">+</span><span class="st"> </span></span>
<span id="cb21-12"><a href="12-statistics.html#cb21-12"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">title =</span> <span class="st">&quot;Population de 15 ans ou plus selon la catégorie socioprofessionnelle&quot;</span>, <span class="dt">x=</span><span class="st">&quot;&quot;</span>, <span class="dt">y=</span><span class="st">&quot;&quot;</span>) <span class="op">+</span><span class="st">  </span></span>
<span id="cb21-13"><a href="12-statistics.html#cb21-13"></a><span class="st">  </span><span class="kw">theme</span>(<span class="dt">legend.position =</span> <span class="st">&quot;none&quot;</span>, <span class="dt">axis.text.x =</span> <span class="kw">element_text</span>(<span class="dt">angle =</span> <span class="dv">75</span>, <span class="dt">hjust=</span><span class="dv">1</span>))</span></code></pre></div>
<p><img src="Projet-Data-Mining-2021_files/figure-html/unnamed-chunk-14-1.svg" width="672" /></p>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb22-1"><a href="12-statistics.html#cb22-1"></a><span class="co">#Population de 15 ans ou plus par sexe et catégorie socioprofessionnelle (et sans les agriculteurs trop peu nombreux)</span></span>
<span id="cb22-2"><a href="12-statistics.html#cb22-2"></a>RP <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb22-3"><a href="12-statistics.html#cb22-3"></a><span class="st">  </span><span class="kw">filter</span>(<span class="op">!</span>AGER20 <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;02&quot;</span>, <span class="st">&quot;05&quot;</span>, <span class="st">&quot;10&quot;</span>, <span class="st">&quot;14&quot;</span>) <span class="op">&amp;</span><span class="st"> </span>TACT<span class="op">!=</span><span class="st">&quot;23&quot;</span> <span class="op">&amp;</span><span class="st"> </span>CS1<span class="op">!=</span><span class="st">&quot;1&quot;</span>) <span class="op">%&gt;%</span></span>
<span id="cb22-4"><a href="12-statistics.html#cb22-4"></a><span class="st">  </span><span class="kw">group_by</span>(SEXE) <span class="op">%&gt;%</span></span>
<span id="cb22-5"><a href="12-statistics.html#cb22-5"></a><span class="st">  </span><span class="kw">count</span>(CS1, <span class="dt">wt=</span>IPONDI) <span class="op">%&gt;%</span></span>
<span id="cb22-6"><a href="12-statistics.html#cb22-6"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">pct=</span><span class="kw">prop.table</span>(n)<span class="op">*</span><span class="dv">100</span>, <span class="dt">pct=</span><span class="kw">round</span>(pct, <span class="dv">1</span>),</span>
<span id="cb22-7"><a href="12-statistics.html#cb22-7"></a>         <span class="dt">CS1=</span><span class="kw">recode</span>(CS1, <span class="st">&quot;2&quot;</span>=<span class="st">&quot;Artisans, commerçants et chefs d&#39;entreprise&quot;</span>, </span>
<span id="cb22-8"><a href="12-statistics.html#cb22-8"></a>                    <span class="st">&quot;3&quot;</span>=<span class="st">&quot;Cadres et professions intellectuelles supérieures&quot;</span>, </span>
<span id="cb22-9"><a href="12-statistics.html#cb22-9"></a>                    <span class="st">&quot;4&quot;</span>=<span class="st">&quot;Professions Intermédiaires&quot;</span>, <span class="st">&quot;5&quot;</span>=<span class="st">&quot;Employés&quot;</span>, <span class="st">&quot;6&quot;</span>=<span class="st">&quot;Ouvriers&quot;</span>,</span>
<span id="cb22-10"><a href="12-statistics.html#cb22-10"></a>                    <span class="st">&quot;7&quot;</span>=<span class="st">&quot;Retraités&quot;</span>, <span class="st">&quot;8&quot;</span>=<span class="st">&quot;Autres personnes sans activité professionnelle&quot;</span>),</span>
<span id="cb22-11"><a href="12-statistics.html#cb22-11"></a>         <span class="dt">SEXE=</span><span class="kw">recode</span>(SEXE, <span class="st">&quot;1&quot;</span>=<span class="st">&quot;Homme&quot;</span>, <span class="st">&quot;2&quot;</span>=<span class="st">&quot;Femme&quot;</span>)) <span class="op">%&gt;%</span></span>
<span id="cb22-12"><a href="12-statistics.html#cb22-12"></a><span class="st">  </span><span class="kw">ggplot</span>() <span class="op">+</span><span class="st"> </span><span class="kw">aes</span>(<span class="dt">x=</span>CS1, <span class="dt">y=</span>pct, <span class="dt">fill=</span>CS1) <span class="op">+</span><span class="st"> </span><span class="kw">geom_bar</span>(<span class="dt">stat=</span><span class="st">&quot;identity&quot;</span>)<span class="op">+</span></span>
<span id="cb22-13"><a href="12-statistics.html#cb22-13"></a><span class="st">  </span><span class="kw">facet_wrap</span>(<span class="op">~</span>SEXE,<span class="dt">nrow=</span><span class="dv">1</span>, <span class="dt">ncol=</span><span class="dv">2</span>) <span class="op">+</span><span class="st">  </span><span class="kw">scale_fill_brewer</span>(<span class="dt">palette =</span> <span class="st">&quot;Set2&quot;</span>) <span class="op">+</span></span>
<span id="cb22-14"><a href="12-statistics.html#cb22-14"></a><span class="st">  </span><span class="kw">geom_text</span>(<span class="kw">aes</span>(<span class="dt">y=</span>pct, <span class="dt">label=</span>pct), <span class="dt">vjust=</span><span class="dv">1</span>, <span class="dt">color=</span><span class="st">&quot;gray23&quot;</span>, <span class="dt">size=</span><span class="fl">3.5</span>) <span class="op">+</span><span class="st"> </span></span>
<span id="cb22-15"><a href="12-statistics.html#cb22-15"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">title =</span> <span class="st">&quot;Population de 15 ans ou plus par sexe et catégorie socioprofessionnelle&quot;</span>, <span class="dt">x=</span><span class="st">&quot;&quot;</span>, <span class="dt">y=</span><span class="st">&quot;&quot;</span>) <span class="op">+</span><span class="st">  </span></span>
<span id="cb22-16"><a href="12-statistics.html#cb22-16"></a><span class="st">  </span><span class="kw">theme_grey</span>() <span class="op">+</span><span class="st"> </span><span class="kw">theme</span>(<span class="dt">axis.text.x=</span><span class="kw">element_blank</span>(), <span class="dt">axis.ticks.x=</span><span class="kw">element_blank</span>(),</span>
<span id="cb22-17"><a href="12-statistics.html#cb22-17"></a>                       <span class="dt">legend.position=</span><span class="st">&quot;bottom&quot;</span>, <span class="dt">legend.title =</span> <span class="kw">element_blank</span>(), </span>
<span id="cb22-18"><a href="12-statistics.html#cb22-18"></a>                       <span class="dt">plot.title =</span> <span class="kw">element_text</span>(<span class="dt">hjust =</span> <span class="fl">0.5</span>))</span></code></pre></div>
<p><img src="Projet-Data-Mining-2021_files/figure-html/unnamed-chunk-14-2.svg" width="672" /></p>
<p>On peut dorénavant s’intéresser aux personnes en emploi, <strong>second exercice à faire</strong> : faîtes un graphique représentant la population de 15 ans ou plus en emploi par statut (salariés/non-salariés), sexe et catégorie socioprofessionnelle (en enlevant de nouveau les agriculteurs)</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb23-1"><a href="12-statistics.html#cb23-1"></a>RP <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb23-2"><a href="12-statistics.html#cb23-2"></a><span class="st">  </span><span class="kw">filter</span>(<span class="op">!</span>AGER20 <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;02&quot;</span>, <span class="st">&quot;05&quot;</span>, <span class="st">&quot;10&quot;</span>, <span class="st">&quot;14&quot;</span>) <span class="op">&amp;</span><span class="st"> </span>TACT<span class="op">==</span><span class="st">&quot;11&quot;</span> <span class="op">&amp;</span><span class="st"> </span>CS1<span class="op">!=</span><span class="st">&quot;1&quot;</span>) <span class="op">%&gt;%</span></span>
<span id="cb23-3"><a href="12-statistics.html#cb23-3"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">EMPL=</span><span class="kw">case_when</span>(EMPL <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;11&quot;</span>,<span class="st">&quot;12&quot;</span>,<span class="st">&quot;13&quot;</span>,<span class="st">&quot;14&quot;</span>,<span class="st">&quot;15&quot;</span>,<span class="st">&quot;16&quot;</span>) <span class="op">~</span><span class="st"> &quot;Salariés&quot;</span>, </span>
<span id="cb23-4"><a href="12-statistics.html#cb23-4"></a>                              EMPL <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;21&quot;</span>,<span class="st">&quot;22&quot;</span>,<span class="st">&quot;23&quot;</span>) <span class="op">~</span><span class="st"> &quot;Non Salariés&quot;</span>),</span>
<span id="cb23-5"><a href="12-statistics.html#cb23-5"></a>         <span class="dt">CS1=</span><span class="kw">recode</span>(CS1, <span class="st">&quot;2&quot;</span>=<span class="st">&quot;Artisans, commerçants et chefs d&#39;entreprise&quot;</span>, </span>
<span id="cb23-6"><a href="12-statistics.html#cb23-6"></a>                    <span class="st">&quot;3&quot;</span>=<span class="st">&quot;Cadres et professions intellectuelles supérieures&quot;</span>, </span>
<span id="cb23-7"><a href="12-statistics.html#cb23-7"></a>                    <span class="st">&quot;4&quot;</span>=<span class="st">&quot;Professions Intermédiaires&quot;</span>, <span class="st">&quot;5&quot;</span>=<span class="st">&quot;Employés&quot;</span>, <span class="st">&quot;6&quot;</span>=<span class="st">&quot;Ouvriers&quot;</span>,</span>
<span id="cb23-8"><a href="12-statistics.html#cb23-8"></a>                    <span class="st">&quot;7&quot;</span>=<span class="st">&quot;Retraités&quot;</span>, <span class="st">&quot;8&quot;</span>=<span class="st">&quot;Autres personnes sans activité professionnelle&quot;</span>),</span>
<span id="cb23-9"><a href="12-statistics.html#cb23-9"></a>         <span class="dt">SEXE=</span><span class="kw">recode</span>(SEXE, <span class="st">&quot;1&quot;</span>=<span class="st">&quot;Homme&quot;</span>, <span class="st">&quot;2&quot;</span>=<span class="st">&quot;Femme&quot;</span>)) <span class="op">%&gt;%</span></span>
<span id="cb23-10"><a href="12-statistics.html#cb23-10"></a><span class="st">  </span><span class="kw">group_by</span>(SEXE, EMPL) <span class="op">%&gt;%</span></span>
<span id="cb23-11"><a href="12-statistics.html#cb23-11"></a><span class="st">  </span><span class="kw">count</span>(CS1, <span class="dt">wt=</span>IPONDI) <span class="op">%&gt;%</span></span>
<span id="cb23-12"><a href="12-statistics.html#cb23-12"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">pct=</span><span class="kw">prop.table</span>(n)<span class="op">*</span><span class="dv">100</span>, <span class="dt">pct=</span><span class="kw">round</span>(pct, <span class="dv">1</span>)) <span class="op">%&gt;%</span></span>
<span id="cb23-13"><a href="12-statistics.html#cb23-13"></a><span class="st">  </span><span class="kw">ggplot</span>() <span class="op">+</span><span class="st"> </span><span class="kw">aes</span>(<span class="dt">x =</span>SEXE, <span class="dt">y=</span>pct, <span class="dt">fill =</span> CS1) <span class="op">+</span><span class="st"> </span><span class="kw">geom_bar</span>(<span class="dt">stat=</span><span class="st">&quot;identity&quot;</span>) <span class="op">+</span></span>
<span id="cb23-14"><a href="12-statistics.html#cb23-14"></a><span class="st">  </span><span class="kw">facet_wrap</span>(<span class="op">~</span>EMPL, <span class="dt">nrow=</span><span class="dv">1</span>, <span class="dt">ncol=</span><span class="dv">2</span>)  <span class="op">+</span><span class="st">  </span><span class="kw">scale_fill_brewer</span>(<span class="dt">palette =</span> <span class="st">&quot;Set2&quot;</span>) <span class="op">+</span></span>
<span id="cb23-15"><a href="12-statistics.html#cb23-15"></a><span class="st">  </span><span class="kw">geom_text</span>(<span class="kw">aes</span>(<span class="dt">label =</span> <span class="kw">after_stat</span>(y)), <span class="dt">color=</span><span class="st">&quot;gray24&quot;</span>,  <span class="dt">position =</span> <span class="kw">position_stack</span>(.<span class="dv">5</span>)) <span class="op">+</span></span>
<span id="cb23-16"><a href="12-statistics.html#cb23-16"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">title =</span> <span class="st">&quot;Population de 15 ans ou plus en emploi par statut, sexe et catégorie socioprofessionnelle&quot;</span>,</span>
<span id="cb23-17"><a href="12-statistics.html#cb23-17"></a>       <span class="dt">x=</span><span class="st">&quot;&quot;</span>, <span class="dt">y=</span><span class="st">&quot;&quot;</span>, <span class="dt">fill=</span><span class="st">&quot;Catégorie socio-professionnelle&quot;</span>) <span class="op">+</span><span class="st">  </span></span>
<span id="cb23-18"><a href="12-statistics.html#cb23-18"></a><span class="st">  </span><span class="kw">theme_grey</span>() <span class="op">+</span><span class="st"> </span><span class="kw">theme</span>(<span class="dt">legend.position=</span><span class="st">&quot;right&quot;</span>)</span></code></pre></div>
<p><img src="Projet-Data-Mining-2021_files/figure-html/unnamed-chunk-15-1.svg" width="672" /></p>
</div>
<div id="la-création-de-fonctions" class="section level2" number="2.4">
<h2><span class="header-section-number">2.4</span> La création de fonctions</h2>
<p>Et oui, le copier-coller c’est bien et simple, mais voilà pour ré-utiliser un code de façon plus automatique, créer des fonctions est très utile (et on peut même les stocker dans un fichier <code>.r</code> pour les réutiliser plus tard pour une autre étude).</p>
<p>L’idée est qu’à partir d’un bloc d’instructions ou de lignes de code, on l’intègre dans une fonction qui portera un nom et qui pourra être appliquée sur les paramètres que l’on veut (table/objet différent, ici communes différentes, variables différentes) et qui nous retournera une valeur en sortie (qu’il faut préciser donc). Par exemple :</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb24-1"><a href="12-statistics.html#cb24-1"></a><span class="co">#Les &quot;...&quot; seront des instructions bien sûr !</span></span>
<span id="cb24-2"><a href="12-statistics.html#cb24-2"></a>nom_fonction &lt;-<span class="st"> </span><span class="cf">function</span>(data, var)</span>
<span id="cb24-3"><a href="12-statistics.html#cb24-3"></a>{</span>
<span id="cb24-4"><a href="12-statistics.html#cb24-4"></a>  tab &lt;-<span class="st"> </span>data <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb24-5"><a href="12-statistics.html#cb24-5"></a><span class="st">            </span>... <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb24-6"><a href="12-statistics.html#cb24-6"></a><span class="st">            </span>...</span>
<span id="cb24-7"><a href="12-statistics.html#cb24-7"></a></span>
<span id="cb24-8"><a href="12-statistics.html#cb24-8"></a>  <span class="kw">return</span>(tab)</span>
<span id="cb24-9"><a href="12-statistics.html#cb24-9"></a>}</span>
<span id="cb24-10"><a href="12-statistics.html#cb24-10"></a></span>
<span id="cb24-11"><a href="12-statistics.html#cb24-11"></a><span class="co">#L&#39;appel de la fonction devra ainsi préciser la table de données sur laquelle l&#39;appliquer et les autres arguments : </span></span>
<span id="cb24-12"><a href="12-statistics.html#cb24-12"></a><span class="kw">nom_fonction</span>(<span class="dt">data =</span> nom_de_ma_table , <span class="dt">var =</span> nom_de_ma_variable)</span>
<span id="cb24-13"><a href="12-statistics.html#cb24-13"></a></span>
<span id="cb24-14"><a href="12-statistics.html#cb24-14"></a><span class="co">#De plus, on pourra créer un nouvel objet (ici &quot;tab_var&quot;) pour stocker la table qui est en valeur de sortie de la fonction : </span></span>
<span id="cb24-15"><a href="12-statistics.html#cb24-15"></a>tab_var &lt;-<span class="st"> </span><span class="kw">nom_fonction</span>(<span class="dt">data =</span> nom_de_ma_table , <span class="dt">var =</span> nom_de_ma_variable)</span></code></pre></div>
<div id="création-dune-fonction-pour-retourner-un-tableau" class="section level3" number="2.4.1">
<h3><span class="header-section-number">2.4.1</span> Création d’une fonction pour retourner un tableau</h3>
<p>Alors, reprenons notre code précédent (ci-dessous), et essayons d’écrire une fonction pour faire des sorties de tableaux, de sorte qu’il suffise d’appeler cette fonction en indiquant le nom de notre table, de notre commune et de notre variable. On n’exécute pas de nouveau ce code, mais on l’affiche seulement sur notre script : pour cela il faut, dans le chunk, mettre l’option <code>eval=FALSE</code> comme ceci : <code>{r eval=FALSE}</code>.</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb25-1"><a href="12-statistics.html#cb25-1"></a><span class="co">#Rappel exemple code précédent (avec ajout de la commune prise en référence - Sucy-en-Brie) : </span></span>
<span id="cb25-2"><a href="12-statistics.html#cb25-2"></a>RP <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb25-3"><a href="12-statistics.html#cb25-3"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">COM =</span> <span class="kw">substr</span>(IRIS,<span class="dv">1</span>,<span class="dv">5</span>)) <span class="op">%&gt;%</span></span>
<span id="cb25-4"><a href="12-statistics.html#cb25-4"></a><span class="st">  </span><span class="kw">filter</span>(LPRM<span class="op">==</span><span class="st">&quot;1&quot;</span> <span class="op">&amp;</span><span class="st"> </span>COM <span class="op">==</span><span class="st"> &quot;94071&quot;</span>) <span class="op">%&gt;%</span></span>
<span id="cb25-5"><a href="12-statistics.html#cb25-5"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">Nb_voiture=</span><span class="kw">case_when</span>(VOIT<span class="op">==</span><span class="st">&quot;1&quot;</span> <span class="op">~</span><span class="st"> &quot;1 voiture&quot;</span>, VOIT <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;2&quot;</span>, <span class="st">&quot;3&quot;</span>) <span class="op">~</span><span class="st"> &quot;2 voitures ou plus&quot;</span>,</span>
<span id="cb25-6"><a href="12-statistics.html#cb25-6"></a>                           VOIT<span class="op">==</span><span class="st">&quot;0&quot;</span> <span class="op">~</span><span class="st"> &quot;Pas de voiture&quot;</span>)) <span class="op">%&gt;%</span></span>
<span id="cb25-7"><a href="12-statistics.html#cb25-7"></a><span class="st">  </span><span class="kw">count</span>(Nb_voiture, <span class="dt">wt=</span>IPONDI) <span class="op">%&gt;%</span></span>
<span id="cb25-8"><a href="12-statistics.html#cb25-8"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">n=</span><span class="kw">round</span>(n,<span class="dv">0</span>),<span class="dt">pct=</span><span class="kw">prop.table</span>(n)<span class="op">*</span><span class="dv">100</span>, <span class="dt">pct=</span><span class="kw">round</span>(pct, <span class="dv">1</span>))</span></code></pre></div>
<p>On crée donc une fonction qu’on appelle <code>tab_menage</code> avec comme paramètres “data”, “codecom” et “var” qui s’appliquerait dans le cas de statistiques au niveau “ménages” :</p>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb26-1"><a href="12-statistics.html#cb26-1"></a>tab_menage &lt;-<span class="st"> </span><span class="cf">function</span>(data, codecom, var)</span>
<span id="cb26-2"><a href="12-statistics.html#cb26-2"></a>{</span>
<span id="cb26-3"><a href="12-statistics.html#cb26-3"></a>  tab &lt;-<span class="st"> </span>data <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb26-4"><a href="12-statistics.html#cb26-4"></a><span class="st">          </span><span class="kw">mutate</span>(<span class="dt">COM =</span> <span class="kw">substr</span>(IRIS,<span class="dv">1</span>,<span class="dv">5</span>)) <span class="op">%&gt;%</span></span>
<span id="cb26-5"><a href="12-statistics.html#cb26-5"></a><span class="st">          </span><span class="kw">filter</span>(LPRM<span class="op">==</span><span class="st">&quot;1&quot;</span> <span class="op">&amp;</span><span class="st"> </span>COM <span class="op">==</span><span class="st"> </span>codecom) <span class="op">%&gt;%</span></span>
<span id="cb26-6"><a href="12-statistics.html#cb26-6"></a><span class="st">          </span><span class="kw">count</span>({{ var }}, <span class="dt">wt=</span>IPONDI) <span class="op">%&gt;%</span><span class="st">  </span></span>
<span id="cb26-7"><a href="12-statistics.html#cb26-7"></a><span class="st">          </span><span class="kw">mutate</span>(<span class="dt">n=</span><span class="kw">round</span>(n,<span class="dv">0</span>), <span class="dt">pct=</span><span class="kw">prop.table</span>(n)<span class="op">*</span><span class="dv">100</span>, <span class="dt">pct=</span><span class="kw">round</span>(pct, <span class="dv">1</span>))</span>
<span id="cb26-8"><a href="12-statistics.html#cb26-8"></a></span>
<span id="cb26-9"><a href="12-statistics.html#cb26-9"></a>  <span class="kw">return</span>(tab)</span>
<span id="cb26-10"><a href="12-statistics.html#cb26-10"></a>}</span></code></pre></div>
<p>Le plus difficile ici est l’appel de la variable dans la fonction notamment lorsqu’on utilise le langage <code>dplyr</code> : une méthode (mais il en existe une autre, cf. <a href="https://thinkr.fr/comment-creer-des-fonctions-dans-le-tidyverse-avec-la-tidyeval-et-le-stash-stash/">ici</a>) est d’utiliser les <code>{{ }}</code>. En outre, il ne faut pas oublier de préciser la valeur de sortie avec <code>return()</code>.</p>
<p>En revanche, si l’on veut recoder la variable soit en regroupant des modalités, soit en renommant les modalités (ou les 2 !), il faudra le faire dans une étape préalable. De manière générale, il est bien comme on l’a vu dans les 2 premières séances de ce ciyrs (cf. script de cours associé) de prendre le temps de bien préparer la table, recoder toutes les variables comme on le souhaite, inspecter et traiter les valeurs manquantes, etc., avant l’étape de l’analyse statistique des données.</p>
<p>Ainsi, si l’on reprend l’exemple des trois premiers tableaux que nous avons réalisés lors de la dernière séance (cf. plus haut), on peut le refaire en 2 étapes : préparation de la table, et appel des fonctions. (On peut aussi intégrer la fonction dans un code <code>dplyr</code> en ajoutant un <code>%&gt;%</code>, dans ce cas il faut enlever le paramètre “data =” dans la fonction lorsqu’on l’appelle, cf. après.)</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb27-1"><a href="12-statistics.html#cb27-1"></a><span class="co"># Etape 1 : création d&#39;une nouvelle table (ou en remplacement si on l&#39;appelle de la même façon)</span></span>
<span id="cb27-2"><a href="12-statistics.html#cb27-2"></a>RP &lt;-<span class="st"> </span>RP <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb27-3"><a href="12-statistics.html#cb27-3"></a><span class="st">        </span><span class="kw">mutate</span>(<span class="dt">Stationnement =</span> <span class="kw">recode</span>(GARL, <span class="st">&quot;1&quot;</span> =<span class="st"> &quot;Au moins un emplacement réservé au stationnement&quot;</span>, </span>
<span id="cb27-4"><a href="12-statistics.html#cb27-4"></a>                                            <span class="st">&quot;2&quot;</span> =<span class="st"> &quot;Aucun emplacement&quot;</span>),</span>
<span id="cb27-5"><a href="12-statistics.html#cb27-5"></a>               <span class="dt">Voiture =</span> <span class="kw">case_when</span>(VOIT <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;1&quot;</span>, <span class="st">&quot;2&quot;</span>, <span class="st">&quot;3&quot;</span>) <span class="op">~</span><span class="st"> &quot;Au moins une voiture&quot;</span>,</span>
<span id="cb27-6"><a href="12-statistics.html#cb27-6"></a>                                         VOIT <span class="op">==</span><span class="st"> &quot;0&quot;</span> <span class="op">~</span><span class="st"> &quot;Pas de voiture&quot;</span>),</span>
<span id="cb27-7"><a href="12-statistics.html#cb27-7"></a>               <span class="dt">Nb_voiture =</span> <span class="kw">case_when</span>(VOIT <span class="op">==</span><span class="st"> &quot;1&quot;</span> <span class="op">~</span><span class="st"> &quot;1 voiture&quot;</span>, </span>
<span id="cb27-8"><a href="12-statistics.html#cb27-8"></a>                                         VOIT <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;2&quot;</span>, <span class="st">&quot;3&quot;</span>) <span class="op">~</span><span class="st"> &quot;2 voitures ou plus&quot;</span>,</span>
<span id="cb27-9"><a href="12-statistics.html#cb27-9"></a>                                         VOIT <span class="op">==</span><span class="st"> &quot;0&quot;</span> <span class="op">~</span><span class="st"> &quot;Pas de voiture&quot;</span>))</span>
<span id="cb27-10"><a href="12-statistics.html#cb27-10"></a></span>
<span id="cb27-11"><a href="12-statistics.html#cb27-11"></a><span class="co">#Etape 2 : création des tableaux, soit en sortie dans la console (1er cas), soit en nouvel objet R (cas suivants)</span></span>
<span id="cb27-12"><a href="12-statistics.html#cb27-12"></a><span class="kw">tab_menage</span>(<span class="dt">data =</span> RP, <span class="dt">codecom =</span> <span class="st">&quot;94071&quot;</span>, <span class="dt">var =</span> Stationnement)</span></code></pre></div>
<pre><code># A tibble: 2 x 3
  Stationnement                                        n   pct
  &lt;fct&gt;                                            &lt;dbl&gt; &lt;dbl&gt;
1 Au moins un emplacement réservé au stationnement  7432  69.4
2 Aucun emplacement                                 3284  30.6</code></pre>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb29-1"><a href="12-statistics.html#cb29-1"></a>tab_voit &lt;-<span class="st"> </span><span class="kw">tab_menage</span>(<span class="dt">data =</span> RP, <span class="dt">codecom =</span> <span class="st">&quot;94071&quot;</span>, <span class="dt">var =</span> Voiture)</span>
<span id="cb29-2"><a href="12-statistics.html#cb29-2"></a>tab_nbvoit &lt;-<span class="st"> </span><span class="kw">tab_menage</span>(<span class="dt">data =</span> RP, <span class="dt">codecom =</span> <span class="st">&quot;94071&quot;</span>, <span class="dt">var =</span> Nb_voiture)</span>
<span id="cb29-3"><a href="12-statistics.html#cb29-3"></a><span class="co">#Visualisation des 2 tables créées</span></span>
<span id="cb29-4"><a href="12-statistics.html#cb29-4"></a>tab_voit</span></code></pre></div>
<pre><code># A tibble: 2 x 3
  Voiture                  n   pct
  &lt;chr&gt;                &lt;dbl&gt; &lt;dbl&gt;
1 Au moins une voiture  9011  84.1
2 Pas de voiture        1705  15.9</code></pre>
<div class="sourceCode" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb31-1"><a href="12-statistics.html#cb31-1"></a>tab_nbvoit</span></code></pre></div>
<pre><code># A tibble: 3 x 3
  Nb_voiture             n   pct
  &lt;chr&gt;              &lt;dbl&gt; &lt;dbl&gt;
1 1 voiture           5399  50.4
2 2 voitures ou plus  3611  33.7
3 Pas de voiture      1705  15.9</code></pre>
<p>On peut créer une même fonction pour réaliser des statistiques cette fois au niveau individus, il suffit de supprimer le 1er filtre avec la variable <code>LPRM()</code>.</p>
<div class="sourceCode" id="cb33"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb33-1"><a href="12-statistics.html#cb33-1"></a>tab_indiv &lt;-<span class="st"> </span><span class="cf">function</span>(data, codecom, var)</span>
<span id="cb33-2"><a href="12-statistics.html#cb33-2"></a>{</span>
<span id="cb33-3"><a href="12-statistics.html#cb33-3"></a>  tab &lt;-<span class="st"> </span>data <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb33-4"><a href="12-statistics.html#cb33-4"></a><span class="st">          </span><span class="kw">mutate</span>(<span class="dt">COM =</span> <span class="kw">substr</span>(IRIS,<span class="dv">1</span>,<span class="dv">5</span>)) <span class="op">%&gt;%</span></span>
<span id="cb33-5"><a href="12-statistics.html#cb33-5"></a><span class="st">          </span><span class="kw">filter</span>(COM <span class="op">==</span><span class="st"> </span>codecom) <span class="op">%&gt;%</span></span>
<span id="cb33-6"><a href="12-statistics.html#cb33-6"></a><span class="st">          </span><span class="kw">count</span>({{ var }}, <span class="dt">wt=</span>IPONDI) <span class="op">%&gt;%</span><span class="st">  </span></span>
<span id="cb33-7"><a href="12-statistics.html#cb33-7"></a><span class="st">          </span><span class="kw">mutate</span>(<span class="dt">n=</span><span class="kw">round</span>(n,<span class="dv">0</span>), <span class="dt">pct=</span><span class="kw">prop.table</span>(n)<span class="op">*</span><span class="dv">100</span>, <span class="dt">pct=</span><span class="kw">round</span>(pct, <span class="dv">1</span>))</span>
<span id="cb33-8"><a href="12-statistics.html#cb33-8"></a></span>
<span id="cb33-9"><a href="12-statistics.html#cb33-9"></a>  <span class="kw">return</span>(tab)</span>
<span id="cb33-10"><a href="12-statistics.html#cb33-10"></a>}</span></code></pre></div>
<p>Exemple, avec la variable <code>CS</code> de catégorie socio-professionnelle</p>
<div class="sourceCode" id="cb34"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb34-1"><a href="12-statistics.html#cb34-1"></a><span class="co">#Pour être pertinent, table restreinte à la population de 15 ans ou plus (sans les agriculteurs non plus, trop peu nobmreux) :</span></span>
<span id="cb34-2"><a href="12-statistics.html#cb34-2"></a>RP <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb34-3"><a href="12-statistics.html#cb34-3"></a><span class="st">  </span><span class="kw">filter</span>(<span class="op">!</span>AGER20 <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;02&quot;</span>, <span class="st">&quot;05&quot;</span>, <span class="st">&quot;10&quot;</span>, <span class="st">&quot;14&quot;</span>) <span class="op">&amp;</span><span class="st"> </span>TACT<span class="op">!=</span><span class="st">&quot;23&quot;</span> <span class="op">&amp;</span><span class="st"> </span>CS1<span class="op">!=</span><span class="st">&quot;1&quot;</span>) <span class="op">%&gt;%</span></span>
<span id="cb34-4"><a href="12-statistics.html#cb34-4"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">CS1=</span><span class="kw">recode</span>(CS1, <span class="st">&quot;2&quot;</span>=<span class="st">&quot;Artisans, commerçants et chefs d&#39;entreprise&quot;</span>, </span>
<span id="cb34-5"><a href="12-statistics.html#cb34-5"></a>                    <span class="st">&quot;3&quot;</span>=<span class="st">&quot;Cadres et professions intellectuelles supérieures&quot;</span>,</span>
<span id="cb34-6"><a href="12-statistics.html#cb34-6"></a>                    <span class="st">&quot;4&quot;</span>=<span class="st">&quot;Professions Intermédiaires&quot;</span>, <span class="st">&quot;5&quot;</span>=<span class="st">&quot;Employés&quot;</span>, <span class="st">&quot;6&quot;</span>=<span class="st">&quot;Ouvriers&quot;</span>,</span>
<span id="cb34-7"><a href="12-statistics.html#cb34-7"></a>                    <span class="st">&quot;7&quot;</span>=<span class="st">&quot;Retraités&quot;</span>, <span class="st">&quot;8&quot;</span>=<span class="st">&quot;Autres personnes sans activité professionnelle&quot;</span>)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb34-8"><a href="12-statistics.html#cb34-8"></a><span class="st">  </span><span class="kw">tab_indiv</span>(<span class="dt">codecom =</span> <span class="st">&quot;94071&quot;</span>, <span class="dt">var =</span> CS1)</span></code></pre></div>
<pre><code># A tibble: 7 x 3
  CS1                                                   n   pct
  &lt;fct&gt;                                             &lt;dbl&gt; &lt;dbl&gt;
1 Artisans, commerçants et chefs d&#39;entreprise         713   3.3
2 Cadres et professions intellectuelles supérieures  3487  16.1
3 Professions Intermédiaires                         3317  15.3
4 Employés                                           3244  14.9
5 Ouvriers                                           1691   7.8
6 Retraités                                          5610  25.8
7 Autres personnes sans activité professionnelle     3644  16.8</code></pre>
<p>Et si on cherchait à n’avoir qu’une fonction à appliquer, que nos statistiques ensuite soient au niveau ménages ou au niveau individus ?</p>
<div class="sourceCode" id="cb36"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb36-1"><a href="12-statistics.html#cb36-1"></a>tab_var &lt;-<span class="st"> </span><span class="cf">function</span>(data, codecom, list_mod, var)</span>
<span id="cb36-2"><a href="12-statistics.html#cb36-2"></a>{</span>
<span id="cb36-3"><a href="12-statistics.html#cb36-3"></a>  tab &lt;-<span class="st"> </span>data <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb36-4"><a href="12-statistics.html#cb36-4"></a><span class="st">    </span><span class="kw">mutate</span>(<span class="dt">COM =</span> <span class="kw">substr</span>(IRIS,<span class="dv">1</span>,<span class="dv">5</span>)) <span class="op">%&gt;%</span></span>
<span id="cb36-5"><a href="12-statistics.html#cb36-5"></a><span class="st">    </span><span class="kw">filter</span>(LPRM <span class="op">%in%</span><span class="st"> </span>list_mod <span class="op">&amp;</span><span class="st"> </span>COM <span class="op">==</span><span class="st"> </span>codecom) <span class="op">%&gt;%</span></span>
<span id="cb36-6"><a href="12-statistics.html#cb36-6"></a><span class="st">    </span><span class="kw">count</span>({{ var }}, <span class="dt">wt=</span>IPONDI) <span class="op">%&gt;%</span><span class="st">  </span></span>
<span id="cb36-7"><a href="12-statistics.html#cb36-7"></a><span class="st">    </span><span class="kw">mutate</span>(<span class="dt">n=</span><span class="kw">round</span>(n,<span class="dv">0</span>), <span class="dt">pct=</span><span class="kw">prop.table</span>(n)<span class="op">*</span><span class="dv">100</span>, <span class="dt">pct=</span><span class="kw">round</span>(pct, <span class="dv">1</span>))</span>
<span id="cb36-8"><a href="12-statistics.html#cb36-8"></a></span>
<span id="cb36-9"><a href="12-statistics.html#cb36-9"></a>  <span class="kw">return</span>(tab)</span>
<span id="cb36-10"><a href="12-statistics.html#cb36-10"></a>}</span></code></pre></div>
<p>Ce qui donnerait pour le niveau ménage l’appel de la fonction :</p>
<div class="sourceCode" id="cb37"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb37-1"><a href="12-statistics.html#cb37-1"></a><span class="kw">tab_var</span>(<span class="dt">data =</span> RP, <span class="dt">codecom =</span> <span class="st">&quot;94071&quot;</span>, <span class="dt">list_mod=</span><span class="kw">c</span>(<span class="st">&quot;1&quot;</span>), <span class="dt">var =</span> Nb_voiture)</span></code></pre></div>
<pre><code># A tibble: 3 x 3
  Nb_voiture             n   pct
  &lt;chr&gt;              &lt;dbl&gt; &lt;dbl&gt;
1 1 voiture           5399  50.4
2 2 voitures ou plus  3611  33.7
3 Pas de voiture      1705  15.9</code></pre>
<p>Et pour l’ensemble des individus :</p>
<div class="sourceCode" id="cb39"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb39-1"><a href="12-statistics.html#cb39-1"></a>RP <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb39-2"><a href="12-statistics.html#cb39-2"></a><span class="st">  </span><span class="kw">filter</span>(<span class="op">!</span>AGER20 <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;02&quot;</span>, <span class="st">&quot;05&quot;</span>, <span class="st">&quot;10&quot;</span>, <span class="st">&quot;14&quot;</span>) <span class="op">&amp;</span><span class="st"> </span>TACT<span class="op">!=</span><span class="st">&quot;23&quot;</span> <span class="op">&amp;</span><span class="st"> </span>CS1<span class="op">!=</span><span class="st">&quot;1&quot;</span>) <span class="op">%&gt;%</span></span>
<span id="cb39-3"><a href="12-statistics.html#cb39-3"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">CS1=</span><span class="kw">recode</span>(CS1, <span class="st">&quot;2&quot;</span>=<span class="st">&quot;Artisans, commerçants et chefs d&#39;entreprise&quot;</span>, </span>
<span id="cb39-4"><a href="12-statistics.html#cb39-4"></a>                    <span class="st">&quot;3&quot;</span>=<span class="st">&quot;Cadres et professions intellectuelles supérieures&quot;</span>,</span>
<span id="cb39-5"><a href="12-statistics.html#cb39-5"></a>                    <span class="st">&quot;4&quot;</span>=<span class="st">&quot;Professions Intermédiaires&quot;</span>, <span class="st">&quot;5&quot;</span>=<span class="st">&quot;Employés&quot;</span>, <span class="st">&quot;6&quot;</span>=<span class="st">&quot;Ouvriers&quot;</span>,</span>
<span id="cb39-6"><a href="12-statistics.html#cb39-6"></a>                    <span class="st">&quot;7&quot;</span>=<span class="st">&quot;Retraités&quot;</span>, <span class="st">&quot;8&quot;</span>=<span class="st">&quot;Autres personnes sans activité professionnelle&quot;</span>)) <span class="op">%&gt;%</span></span>
<span id="cb39-7"><a href="12-statistics.html#cb39-7"></a><span class="st">  </span><span class="kw">tab_var</span>(<span class="dt">codecom =</span> <span class="st">&quot;94071&quot;</span>, <span class="dt">list_mod=</span><span class="kw">c</span>(<span class="st">&quot;1&quot;</span>, <span class="st">&quot;2&quot;</span>, <span class="st">&quot;3&quot;</span>, <span class="st">&quot;4&quot;</span>, <span class="st">&quot;5&quot;</span>, <span class="st">&quot;6&quot;</span>, <span class="st">&quot;7&quot;</span>, <span class="st">&quot;8&quot;</span>, <span class="st">&quot;9&quot;</span>, <span class="st">&quot;Z&quot;</span>), <span class="dt">var =</span> CS1)</span></code></pre></div>
<pre><code># A tibble: 7 x 3
  CS1                                                   n   pct
  &lt;fct&gt;                                             &lt;dbl&gt; &lt;dbl&gt;
1 Artisans, commerçants et chefs d&#39;entreprise         713   3.3
2 Cadres et professions intellectuelles supérieures  3487  16.1
3 Professions Intermédiaires                         3317  15.3
4 Employés                                           3244  14.9
5 Ouvriers                                           1691   7.8
6 Retraités                                          5610  25.8
7 Autres personnes sans activité professionnelle     3644  16.8</code></pre>
<p>C’est un peu fastidieux ici de rentrer toutes les modalités de la variable <code>LPRM</code>. Une solution rapide est de créer une nouvelle variable à partir de <code>LPRM</code> qu’on appelerait <code>LPRM_1</code> qui n’ait que 2 modalités, ce qui peut être fait idéalement dans l’étape initiale de préparation des données (sinon comme ci-dessous) !</p>
<div class="sourceCode" id="cb41"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb41-1"><a href="12-statistics.html#cb41-1"></a>tab_var &lt;-<span class="st"> </span><span class="cf">function</span>(data, codecom, list_mod, var)</span>
<span id="cb41-2"><a href="12-statistics.html#cb41-2"></a>{</span>
<span id="cb41-3"><a href="12-statistics.html#cb41-3"></a>  tab &lt;-<span class="st"> </span>data <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb41-4"><a href="12-statistics.html#cb41-4"></a><span class="st">    </span><span class="kw">mutate</span>(<span class="dt">COM =</span> <span class="kw">substr</span>(IRIS,<span class="dv">1</span>,<span class="dv">5</span>)) <span class="op">%&gt;%</span></span>
<span id="cb41-5"><a href="12-statistics.html#cb41-5"></a><span class="st">    </span><span class="kw">filter</span>(LPRM_<span class="dv">1</span> <span class="op">%in%</span><span class="st"> </span>list_mod <span class="op">&amp;</span><span class="st"> </span>COM <span class="op">==</span><span class="st"> </span>codecom) <span class="op">%&gt;%</span></span>
<span id="cb41-6"><a href="12-statistics.html#cb41-6"></a><span class="st">    </span><span class="kw">count</span>({{ var }}, <span class="dt">wt=</span>IPONDI) <span class="op">%&gt;%</span><span class="st">  </span></span>
<span id="cb41-7"><a href="12-statistics.html#cb41-7"></a><span class="st">    </span><span class="kw">mutate</span>(<span class="dt">n=</span><span class="kw">round</span>(n,<span class="dv">0</span>), <span class="dt">pct=</span><span class="kw">prop.table</span>(n)<span class="op">*</span><span class="dv">100</span>, <span class="dt">pct=</span><span class="kw">round</span>(pct, <span class="dv">1</span>))</span>
<span id="cb41-8"><a href="12-statistics.html#cb41-8"></a></span>
<span id="cb41-9"><a href="12-statistics.html#cb41-9"></a>  <span class="kw">return</span>(tab)</span>
<span id="cb41-10"><a href="12-statistics.html#cb41-10"></a>}</span>
<span id="cb41-11"><a href="12-statistics.html#cb41-11"></a><span class="co"># Appliquée sur le même exemple que précédemment :</span></span>
<span id="cb41-12"><a href="12-statistics.html#cb41-12"></a>RP <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb41-13"><a href="12-statistics.html#cb41-13"></a><span class="st">  </span><span class="kw">filter</span>(<span class="op">!</span>AGER20 <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;02&quot;</span>, <span class="st">&quot;05&quot;</span>, <span class="st">&quot;10&quot;</span>, <span class="st">&quot;14&quot;</span>) <span class="op">&amp;</span><span class="st"> </span>TACT<span class="op">!=</span><span class="st">&quot;23&quot;</span> <span class="op">&amp;</span><span class="st"> </span>CS1<span class="op">!=</span><span class="st">&quot;1&quot;</span>) <span class="op">%&gt;%</span></span>
<span id="cb41-14"><a href="12-statistics.html#cb41-14"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">CS1=</span><span class="kw">recode</span>(CS1, <span class="st">&quot;2&quot;</span>=<span class="st">&quot;Artisans, commerçants et chefs d&#39;entreprise&quot;</span>, </span>
<span id="cb41-15"><a href="12-statistics.html#cb41-15"></a>                    <span class="st">&quot;3&quot;</span>=<span class="st">&quot;Cadres et professions intellectuelles supérieures&quot;</span>,</span>
<span id="cb41-16"><a href="12-statistics.html#cb41-16"></a>                    <span class="st">&quot;4&quot;</span>=<span class="st">&quot;Professions Intermédiaires&quot;</span>, <span class="st">&quot;5&quot;</span>=<span class="st">&quot;Employés&quot;</span>, <span class="st">&quot;6&quot;</span>=<span class="st">&quot;Ouvriers&quot;</span>,</span>
<span id="cb41-17"><a href="12-statistics.html#cb41-17"></a>                    <span class="st">&quot;7&quot;</span>=<span class="st">&quot;Retraités&quot;</span>, <span class="st">&quot;8&quot;</span>=<span class="st">&quot;Autres personnes sans activité professionnelle&quot;</span>),</span>
<span id="cb41-18"><a href="12-statistics.html#cb41-18"></a>         <span class="dt">LPRM_1 =</span> <span class="kw">case_when</span>(LPRM <span class="op">==</span><span class="st"> &quot;1&quot;</span> <span class="op">~</span><span class="st"> &quot;1&quot;</span>, <span class="ot">TRUE</span> <span class="op">~</span><span class="st"> &quot;0&quot;</span>)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb41-19"><a href="12-statistics.html#cb41-19"></a><span class="st">  </span><span class="kw">tab_var</span>(<span class="dt">codecom =</span> <span class="st">&quot;94071&quot;</span>, <span class="dt">list_mod=</span><span class="kw">c</span>(<span class="st">&quot;1&quot;</span>, <span class="st">&quot;0&quot;</span>), <span class="dt">var =</span> CS1)</span></code></pre></div>
<pre><code># A tibble: 7 x 3
  CS1                                                   n   pct
  &lt;fct&gt;                                             &lt;dbl&gt; &lt;dbl&gt;
1 Artisans, commerçants et chefs d&#39;entreprise         713   3.3
2 Cadres et professions intellectuelles supérieures  3487  16.1
3 Professions Intermédiaires                         3317  15.3
4 Employés                                           3244  14.9
5 Ouvriers                                           1691   7.8
6 Retraités                                          5610  25.8
7 Autres personnes sans activité professionnelle     3644  16.8</code></pre>
</div>
<div id="création-dune-fonction-pour-retourner-un-graphique" class="section level3" number="2.4.2">
<h3><span class="header-section-number">2.4.2</span> Création d’une fonction pour retourner un graphique</h3>
<p>Maintenant, créons, de la même façon, une fonction qui retourne en valeur de sortie un graphique, comme ceux que l’on a construit plus haut. On peut dans un premier temps, partir du principe que l’on appelera d’abord notre fonction <code>tab_var()</code> pour créer le tableau en sortie, à partir duquel on appliquera la fonction du graphe.</p>
<p>Pour rappel, voici le code initialement utilisé pour créer un graphique représentant la population de 15 ans ou plus selon la catégorie socioprofessionnelle dans notre commune de référence (de nouveau, on ne l’exécute pas ici, et on spécifie <code>eval=FALSE</code>).</p>
<div class="sourceCode" id="cb43"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb43-1"><a href="12-statistics.html#cb43-1"></a><span class="co">#Population de 15 ans ou plus selon la catégorie socioprofessionnelle (sans les agriculteurs ; et avec ajout de la commune prise en référence - Sucy-en-Brie)</span></span>
<span id="cb43-2"><a href="12-statistics.html#cb43-2"></a>RP <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb43-3"><a href="12-statistics.html#cb43-3"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">COM =</span> <span class="kw">substr</span>(IRIS, <span class="dv">1</span>, <span class="dv">5</span>)) <span class="op">%&gt;%</span></span>
<span id="cb43-4"><a href="12-statistics.html#cb43-4"></a><span class="st">  </span><span class="kw">filter</span>(COM <span class="op">==</span><span class="st"> &quot;94071&quot;</span> <span class="op">&amp;</span><span class="st"> </span><span class="op">!</span>AGER20 <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;02&quot;</span>, <span class="st">&quot;05&quot;</span>, <span class="st">&quot;10&quot;</span>, <span class="st">&quot;14&quot;</span>) <span class="op">&amp;</span><span class="st"> </span>TACT<span class="op">!=</span><span class="st">&quot;23&quot;</span> <span class="op">&amp;</span><span class="st"> </span>CS1<span class="op">!=</span><span class="st">&quot;1&quot;</span>) <span class="op">%&gt;%</span></span>
<span id="cb43-5"><a href="12-statistics.html#cb43-5"></a><span class="st">  </span><span class="kw">count</span>(CS1, <span class="dt">wt=</span>IPONDI) <span class="op">%&gt;%</span></span>
<span id="cb43-6"><a href="12-statistics.html#cb43-6"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">pct=</span><span class="kw">prop.table</span>(n)<span class="op">*</span><span class="dv">100</span>, <span class="dt">pct=</span><span class="kw">round</span>(pct, <span class="dv">1</span>),</span>
<span id="cb43-7"><a href="12-statistics.html#cb43-7"></a>         <span class="dt">CS1=</span><span class="kw">recode</span>(CS1, <span class="st">&quot;2&quot;</span>=<span class="st">&quot;Artisans, commerçants et chefs d&#39;entreprise&quot;</span>, </span>
<span id="cb43-8"><a href="12-statistics.html#cb43-8"></a>                    <span class="st">&quot;3&quot;</span>=<span class="st">&quot;Cadres et professions intellectuelles supérieures&quot;</span>, </span>
<span id="cb43-9"><a href="12-statistics.html#cb43-9"></a>                    <span class="st">&quot;4&quot;</span>=<span class="st">&quot;Professions Intermédiaires&quot;</span>, <span class="st">&quot;5&quot;</span>=<span class="st">&quot;Employés&quot;</span>, <span class="st">&quot;6&quot;</span>=<span class="st">&quot;Ouvriers&quot;</span>,</span>
<span id="cb43-10"><a href="12-statistics.html#cb43-10"></a>                    <span class="st">&quot;7&quot;</span>=<span class="st">&quot;Retraités&quot;</span>, <span class="st">&quot;8&quot;</span>=<span class="st">&quot;Autres personnes sans activité professionnelle&quot;</span>)) <span class="op">%&gt;%</span></span>
<span id="cb43-11"><a href="12-statistics.html#cb43-11"></a><span class="st">  </span><span class="kw">ggplot</span>() <span class="op">+</span><span class="st"> </span><span class="kw">aes</span>(<span class="dt">x=</span>CS1, <span class="dt">y=</span>pct, <span class="dt">fill=</span>CS1) <span class="op">+</span><span class="st"> </span><span class="kw">geom_col</span>() <span class="op">+</span><span class="st"> </span><span class="kw">scale_fill_brewer</span>(<span class="dt">palette =</span> <span class="st">&quot;Set2&quot;</span>) <span class="op">+</span></span>
<span id="cb43-12"><a href="12-statistics.html#cb43-12"></a><span class="st">  </span><span class="kw">geom_text</span>(<span class="kw">aes</span>(<span class="dt">y=</span>pct, <span class="dt">label=</span>pct), <span class="dt">vjust=</span><span class="fl">1.4</span>, <span class="dt">color=</span><span class="st">&quot;gray30&quot;</span>, <span class="dt">size=</span><span class="fl">3.5</span>) <span class="op">+</span><span class="st"> </span></span>
<span id="cb43-13"><a href="12-statistics.html#cb43-13"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">title =</span> <span class="st">&quot;Population de 15 ans ou plus selon la catégorie socioprofessionnelle&quot;</span>, <span class="dt">x=</span><span class="st">&quot;&quot;</span>, <span class="dt">y=</span><span class="st">&quot;&quot;</span>) <span class="op">+</span><span class="st">  </span></span>
<span id="cb43-14"><a href="12-statistics.html#cb43-14"></a><span class="st">  </span><span class="kw">theme</span>(<span class="dt">legend.position =</span> <span class="st">&quot;none&quot;</span>, <span class="dt">axis.text.x =</span> <span class="kw">element_text</span>(<span class="dt">angle =</span> <span class="dv">75</span>, <span class="dt">hjust=</span><span class="dv">1</span>))</span></code></pre></div>
<p>On s’intéresse donc aux dernières lignes de codes pour créer notre fonction qu’on appelera par exemple <code>graph_baton</code>, en considérant qu’on aura avant un tableau avec 3 colonnes : la variable, le nombre “n” et le pourcentage “pct”. On peut donc réutiliser certains de ces noms de variables dans la fonction, ou se laisser la possibilité de l’indiquer dans les paramètres de la fonction (les lignes de codes suivantes ne sont pas exécutées, de nouveau l’option <code>{r eval=FALSE}</code> est ici inscrite dans le script Markdown).</p>
<div class="sourceCode" id="cb44"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb44-1"><a href="12-statistics.html#cb44-1"></a><span class="co"># On peut proposer une première écriture avec &quot;pct&quot; comme variable indiquée pour &quot;y=&quot; car ici c&#39;est le pourcentage qu&#39;on reprend, et dans nos tableaux il portera toujours le nom de &quot;pct&quot; :</span></span>
<span id="cb44-2"><a href="12-statistics.html#cb44-2"></a>graph_baton &lt;-<span class="st"> </span><span class="cf">function</span>(data, var_x, nom_titre)</span>
<span id="cb44-3"><a href="12-statistics.html#cb44-3"></a>{</span>
<span id="cb44-4"><a href="12-statistics.html#cb44-4"></a>  graph &lt;-<span class="st"> </span>data <span class="op">%&gt;%</span></span>
<span id="cb44-5"><a href="12-statistics.html#cb44-5"></a><span class="st">    </span><span class="kw">ggplot</span>() <span class="op">+</span><span class="st"> </span><span class="kw">aes</span>(<span class="dt">x =</span> {{ var_x }}, <span class="dt">y =</span> pct, <span class="dt">fill =</span> {{ var_x }}) <span class="op">+</span><span class="st"> </span></span>
<span id="cb44-6"><a href="12-statistics.html#cb44-6"></a><span class="st">    </span><span class="kw">geom_col</span>() <span class="op">+</span><span class="st"> </span><span class="kw">scale_fill_brewer</span>(<span class="dt">palette =</span> <span class="st">&quot;Set2&quot;</span>) <span class="op">+</span></span>
<span id="cb44-7"><a href="12-statistics.html#cb44-7"></a><span class="st">    </span><span class="kw">geom_text</span>(<span class="kw">aes</span>(<span class="dt">y =</span> pct, <span class="dt">label =</span> pct), <span class="dt">vjust=</span><span class="fl">1.4</span>, <span class="dt">color=</span><span class="st">&quot;gray30&quot;</span>, <span class="dt">size=</span><span class="fl">3.5</span>) <span class="op">+</span><span class="st"> </span></span>
<span id="cb44-8"><a href="12-statistics.html#cb44-8"></a><span class="st">    </span><span class="kw">labs</span>(<span class="dt">title =</span> nom_titre, <span class="dt">x=</span><span class="st">&quot;&quot;</span>, <span class="dt">y=</span><span class="st">&quot;&quot;</span>) <span class="op">+</span><span class="st">  </span></span>
<span id="cb44-9"><a href="12-statistics.html#cb44-9"></a><span class="st">    </span><span class="kw">theme</span>(<span class="dt">legend.position =</span> <span class="st">&quot;none&quot;</span>, <span class="dt">axis.text.x =</span> <span class="kw">element_text</span>(<span class="dt">angle =</span> <span class="dv">75</span>, <span class="dt">hjust=</span><span class="dv">1</span>))</span>
<span id="cb44-10"><a href="12-statistics.html#cb44-10"></a>  </span>
<span id="cb44-11"><a href="12-statistics.html#cb44-11"></a>  <span class="kw">return</span>(graph)</span>
<span id="cb44-12"><a href="12-statistics.html#cb44-12"></a>}</span>
<span id="cb44-13"><a href="12-statistics.html#cb44-13"></a></span>
<span id="cb44-14"><a href="12-statistics.html#cb44-14"></a><span class="co"># Mais si on veut se laisser la possibilité de ne pas forcément mettre le pourcentage mais aussi les effectifs... alors il vaut mieux indiquer un nouveau paramètre que l&#39;on aura à &quot;remplir&quot; en appelant la fonction :</span></span>
<span id="cb44-15"><a href="12-statistics.html#cb44-15"></a>graph_baton &lt;-<span class="st"> </span><span class="cf">function</span>(data, var_x, var_y, nom_titre)</span>
<span id="cb44-16"><a href="12-statistics.html#cb44-16"></a>{</span>
<span id="cb44-17"><a href="12-statistics.html#cb44-17"></a>  graph &lt;-<span class="st"> </span>data <span class="op">%&gt;%</span></span>
<span id="cb44-18"><a href="12-statistics.html#cb44-18"></a><span class="st">    </span><span class="kw">ggplot</span>() <span class="op">+</span><span class="st"> </span><span class="kw">aes</span>(<span class="dt">x =</span> {{ var_x }}, <span class="dt">y =</span> {{ var_y }}, <span class="dt">fill =</span> {{ var_x }}) <span class="op">+</span><span class="st"> </span></span>
<span id="cb44-19"><a href="12-statistics.html#cb44-19"></a><span class="st">    </span><span class="kw">geom_col</span>() <span class="op">+</span><span class="st"> </span><span class="kw">scale_fill_brewer</span>(<span class="dt">palette =</span> <span class="st">&quot;Set2&quot;</span>) <span class="op">+</span></span>
<span id="cb44-20"><a href="12-statistics.html#cb44-20"></a><span class="st">    </span><span class="kw">geom_text</span>(<span class="kw">aes</span>(<span class="dt">y =</span> {{ var_y }}, <span class="dt">label =</span> {{ var_y }}), <span class="dt">vjust=</span><span class="fl">1.4</span>, <span class="dt">color=</span><span class="st">&quot;gray30&quot;</span>, <span class="dt">size=</span><span class="fl">3.5</span>) <span class="op">+</span><span class="st"> </span></span>
<span id="cb44-21"><a href="12-statistics.html#cb44-21"></a><span class="st">    </span><span class="kw">labs</span>(<span class="dt">title =</span> nom_titre, <span class="dt">x=</span><span class="st">&quot;&quot;</span>, <span class="dt">y=</span><span class="st">&quot;&quot;</span>) <span class="op">+</span><span class="st">  </span></span>
<span id="cb44-22"><a href="12-statistics.html#cb44-22"></a><span class="st">    </span><span class="kw">theme</span>(<span class="dt">legend.position =</span> <span class="st">&quot;none&quot;</span>, <span class="dt">axis.text.x =</span> <span class="kw">element_text</span>(<span class="dt">angle =</span> <span class="dv">75</span>, <span class="dt">hjust=</span><span class="dv">1</span>))</span>
<span id="cb44-23"><a href="12-statistics.html#cb44-23"></a>  </span>
<span id="cb44-24"><a href="12-statistics.html#cb44-24"></a>  <span class="kw">return</span>(graph)</span>
<span id="cb44-25"><a href="12-statistics.html#cb44-25"></a>}</span>
<span id="cb44-26"><a href="12-statistics.html#cb44-26"></a></span>
<span id="cb44-27"><a href="12-statistics.html#cb44-27"></a><span class="co">#On avait vu qu&#39;on pouvait également utiliser la fonction `geom_bar()` en mettant l&#39;option &quot;(stat=&quot;identity&quot;)&quot; à la place de `geom_col()`, c&#39;est ce que nous allons privilégier ensuite : </span></span>
<span id="cb44-28"><a href="12-statistics.html#cb44-28"></a>graph_baton &lt;-<span class="st"> </span><span class="cf">function</span>(data, var_x, var_y, nom_titre)</span>
<span id="cb44-29"><a href="12-statistics.html#cb44-29"></a>{</span>
<span id="cb44-30"><a href="12-statistics.html#cb44-30"></a>  graph &lt;-<span class="st"> </span>data <span class="op">%&gt;%</span></span>
<span id="cb44-31"><a href="12-statistics.html#cb44-31"></a><span class="st">    </span><span class="kw">ggplot</span>() <span class="op">+</span><span class="st"> </span><span class="kw">aes</span>(<span class="dt">x =</span> {{ var_x }}, <span class="dt">y =</span> {{ var_y }}, <span class="dt">fill =</span> {{ var_x }}) <span class="op">+</span><span class="st"> </span></span>
<span id="cb44-32"><a href="12-statistics.html#cb44-32"></a><span class="st">    </span><span class="kw">geom_bar</span>(<span class="dt">stat=</span><span class="st">&quot;identity&quot;</span>) <span class="op">+</span><span class="st"> </span><span class="kw">scale_fill_brewer</span>(<span class="dt">palette =</span> <span class="st">&quot;Set2&quot;</span>) <span class="op">+</span></span>
<span id="cb44-33"><a href="12-statistics.html#cb44-33"></a><span class="st">    </span><span class="kw">geom_text</span>(<span class="kw">aes</span>(<span class="dt">y =</span> {{ var_y }}, <span class="dt">label =</span> {{ var_y }}), <span class="dt">vjust=</span><span class="fl">1.4</span>, <span class="dt">color=</span><span class="st">&quot;gray30&quot;</span>, <span class="dt">size=</span><span class="fl">3.5</span>) <span class="op">+</span><span class="st"> </span></span>
<span id="cb44-34"><a href="12-statistics.html#cb44-34"></a><span class="st">    </span><span class="kw">labs</span>(<span class="dt">title =</span> nom_titre, <span class="dt">x=</span><span class="st">&quot;&quot;</span>, <span class="dt">y=</span><span class="st">&quot;&quot;</span>) <span class="op">+</span><span class="st">  </span></span>
<span id="cb44-35"><a href="12-statistics.html#cb44-35"></a><span class="st">    </span><span class="kw">theme</span>(<span class="dt">legend.position =</span> <span class="st">&quot;none&quot;</span>, <span class="dt">axis.text.x =</span> <span class="kw">element_text</span>(<span class="dt">angle =</span> <span class="dv">75</span>, <span class="dt">hjust=</span><span class="dv">1</span>))</span>
<span id="cb44-36"><a href="12-statistics.html#cb44-36"></a>  </span>
<span id="cb44-37"><a href="12-statistics.html#cb44-37"></a>  <span class="kw">return</span>(graph)</span>
<span id="cb44-38"><a href="12-statistics.html#cb44-38"></a>}</span></code></pre></div>
<p>Essayons de l’appliquer en lien avec le code initial :</p>
<div class="sourceCode" id="cb45"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb45-1"><a href="12-statistics.html#cb45-1"></a>graph_baton &lt;-<span class="st"> </span><span class="cf">function</span>(data, var_x, var_y, nom_titre)</span>
<span id="cb45-2"><a href="12-statistics.html#cb45-2"></a>{</span>
<span id="cb45-3"><a href="12-statistics.html#cb45-3"></a>  graph &lt;-<span class="st"> </span>data <span class="op">%&gt;%</span></span>
<span id="cb45-4"><a href="12-statistics.html#cb45-4"></a><span class="st">    </span><span class="kw">ggplot</span>() <span class="op">+</span><span class="st"> </span><span class="kw">aes</span>(<span class="dt">x =</span> {{ var_x }}, <span class="dt">y =</span> {{ var_y }}, <span class="dt">fill =</span> {{ var_x }}) <span class="op">+</span><span class="st"> </span></span>
<span id="cb45-5"><a href="12-statistics.html#cb45-5"></a><span class="st">    </span><span class="kw">geom_bar</span>(<span class="dt">stat=</span><span class="st">&quot;identity&quot;</span>) <span class="op">+</span><span class="st"> </span><span class="kw">scale_fill_brewer</span>(<span class="dt">palette =</span> <span class="st">&quot;Set2&quot;</span>) <span class="op">+</span></span>
<span id="cb45-6"><a href="12-statistics.html#cb45-6"></a><span class="st">    </span><span class="kw">geom_text</span>(<span class="kw">aes</span>(<span class="dt">y =</span> {{ var_y }}, <span class="dt">label =</span> {{ var_y }}), <span class="dt">vjust=</span><span class="fl">1.4</span>, <span class="dt">color=</span><span class="st">&quot;gray30&quot;</span>, <span class="dt">size=</span><span class="fl">3.5</span>) <span class="op">+</span><span class="st"> </span></span>
<span id="cb45-7"><a href="12-statistics.html#cb45-7"></a><span class="st">    </span><span class="kw">labs</span>(<span class="dt">title =</span> nom_titre, <span class="dt">x=</span><span class="st">&quot;&quot;</span>, <span class="dt">y=</span><span class="st">&quot;&quot;</span>) <span class="op">+</span><span class="st">  </span></span>
<span id="cb45-8"><a href="12-statistics.html#cb45-8"></a><span class="st">    </span><span class="kw">theme</span>(<span class="dt">legend.position =</span> <span class="st">&quot;none&quot;</span>, <span class="dt">axis.text.x =</span> <span class="kw">element_text</span>(<span class="dt">angle =</span> <span class="dv">75</span>, <span class="dt">hjust=</span><span class="dv">1</span>))</span>
<span id="cb45-9"><a href="12-statistics.html#cb45-9"></a>  </span>
<span id="cb45-10"><a href="12-statistics.html#cb45-10"></a>  <span class="kw">return</span>(graph)</span>
<span id="cb45-11"><a href="12-statistics.html#cb45-11"></a>}</span>
<span id="cb45-12"><a href="12-statistics.html#cb45-12"></a></span>
<span id="cb45-13"><a href="12-statistics.html#cb45-13"></a><span class="co">#Restreignons là aussi l&#39;analyse aux 15 ans ou plus (sans les agriculteurs de nouveau)</span></span>
<span id="cb45-14"><a href="12-statistics.html#cb45-14"></a>tab_CS &lt;-<span class="st"> </span>RP <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb45-15"><a href="12-statistics.html#cb45-15"></a><span class="st">            </span><span class="kw">filter</span>(<span class="op">!</span>AGER20 <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;02&quot;</span>, <span class="st">&quot;05&quot;</span>, <span class="st">&quot;10&quot;</span>, <span class="st">&quot;14&quot;</span>) <span class="op">&amp;</span><span class="st"> </span>TACT<span class="op">!=</span><span class="st">&quot;23&quot;</span> <span class="op">&amp;</span><span class="st"> </span>CS1<span class="op">!=</span><span class="st">&quot;1&quot;</span>) <span class="op">%&gt;%</span></span>
<span id="cb45-16"><a href="12-statistics.html#cb45-16"></a><span class="st">            </span><span class="kw">mutate</span>(<span class="dt">CS1=</span><span class="kw">recode</span>(CS1, <span class="st">&quot;2&quot;</span>=<span class="st">&quot;Artisans, commerçants et chefs d&#39;entreprise&quot;</span>, </span>
<span id="cb45-17"><a href="12-statistics.html#cb45-17"></a>                    <span class="st">&quot;3&quot;</span>=<span class="st">&quot;Cadres et professions intellectuelles supérieures&quot;</span>,</span>
<span id="cb45-18"><a href="12-statistics.html#cb45-18"></a>                    <span class="st">&quot;4&quot;</span>=<span class="st">&quot;Professions Intermédiaires&quot;</span>, <span class="st">&quot;5&quot;</span>=<span class="st">&quot;Employés&quot;</span>, <span class="st">&quot;6&quot;</span>=<span class="st">&quot;Ouvriers&quot;</span>,</span>
<span id="cb45-19"><a href="12-statistics.html#cb45-19"></a>                    <span class="st">&quot;7&quot;</span>=<span class="st">&quot;Retraités&quot;</span>, <span class="st">&quot;8&quot;</span>=<span class="st">&quot;Autres personnes sans activité professionnelle&quot;</span>),</span>
<span id="cb45-20"><a href="12-statistics.html#cb45-20"></a>                  <span class="dt">LPRM_1 =</span> <span class="kw">case_when</span>(LPRM <span class="op">==</span><span class="st"> &quot;1&quot;</span> <span class="op">~</span><span class="st"> &quot;1&quot;</span>, <span class="ot">TRUE</span> <span class="op">~</span><span class="st"> &quot;0&quot;</span>)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb45-21"><a href="12-statistics.html#cb45-21"></a><span class="st">            </span><span class="kw">tab_var</span>(<span class="dt">codecom =</span> <span class="st">&quot;94071&quot;</span>, <span class="dt">list_mod=</span><span class="kw">c</span>(<span class="st">&quot;1&quot;</span>, <span class="st">&quot;0&quot;</span>), <span class="dt">var =</span> CS1)</span>
<span id="cb45-22"><a href="12-statistics.html#cb45-22"></a></span>
<span id="cb45-23"><a href="12-statistics.html#cb45-23"></a><span class="kw">graph_baton</span>(<span class="dt">data =</span> tab_CS, <span class="dt">var_x =</span> CS1, <span class="dt">var_y =</span> pct,</span>
<span id="cb45-24"><a href="12-statistics.html#cb45-24"></a>          <span class="dt">nom_titre =</span><span class="st">&quot;Population de 15 ans ou plus selon la catégorie socioprofessionnelle&quot;</span>)</span></code></pre></div>
<p><img src="Projet-Data-Mining-2021_files/figure-html/unnamed-chunk-28-1.svg" width="672" /></p>
<p>Si certaines options du graphique ne s’adapteront pas bien pour d’autres variables, il est possible dans la fonction créée d’enlever les lignes de codes comprenant les fonctions <code>geom_text()</code> et <code>theme()</code>, et de les ajouter ensuite au graphe que l’on aura stocké préalablement dans un objet. De même, ici on a voulu “économiser” le nombre de paramètres cités pour le graphe en reprenant le même nom de variables que pour le tableau, mais il sera finalement peut-être plus judicieux de bien distinguer les variables appelées dans le tableau et les variables appelées dans le graphe. On le verra plus loin.</p>
</div>
<div id="création-dune-seule-fonction-comprenant-tableau-et-graphe" class="section level3" number="2.4.3">
<h3><span class="header-section-number">2.4.3</span> Création d’une seule fonction comprenant tableau et graphe</h3>
<p>Vous l’avez compris, on peut constamment optimiser son code, y compris ses fonctions. Par exemple ici, au lieu d’appeler la fonction tableau, puis ensuite la fonction graphe, on peut créer une fonction qui renverra le graphique voulu en intégrant l’étape du tableau. On va l’appeler <code>graph_baton1</code> :</p>
<div class="sourceCode" id="cb46"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb46-1"><a href="12-statistics.html#cb46-1"></a><span class="co">#Fonction Graph intégrant la fonction tab</span></span>
<span id="cb46-2"><a href="12-statistics.html#cb46-2"></a>graph_baton1 &lt;-<span class="st"> </span><span class="cf">function</span>(data, codecom, list_mod, var, var_x, var_y, nom_titre)</span>
<span id="cb46-3"><a href="12-statistics.html#cb46-3"></a>{</span>
<span id="cb46-4"><a href="12-statistics.html#cb46-4"></a>  tabvar &lt;-<span class="st"> </span><span class="kw">tab_var</span>(<span class="dt">data =</span> data, <span class="dt">codecom =</span> codecom, list_mod, <span class="dt">var =</span> {{ var }})</span>
<span id="cb46-5"><a href="12-statistics.html#cb46-5"></a>  </span>
<span id="cb46-6"><a href="12-statistics.html#cb46-6"></a>  graph &lt;-<span class="st"> </span>tabvar <span class="op">%&gt;%</span></span>
<span id="cb46-7"><a href="12-statistics.html#cb46-7"></a><span class="st">    </span><span class="kw">ggplot</span>() <span class="op">+</span><span class="st"> </span><span class="kw">aes</span>(<span class="dt">x =</span> {{ var_x }}, <span class="dt">y =</span> {{ var_y }}, <span class="dt">fill =</span> {{ var_x }}) <span class="op">+</span><span class="st"> </span></span>
<span id="cb46-8"><a href="12-statistics.html#cb46-8"></a><span class="st">    </span><span class="kw">geom_bar</span>(<span class="dt">stat=</span><span class="st">&quot;identity&quot;</span>) <span class="op">+</span><span class="st"> </span><span class="kw">scale_fill_brewer</span>(<span class="dt">palette =</span> <span class="st">&quot;Set2&quot;</span>) <span class="op">+</span></span>
<span id="cb46-9"><a href="12-statistics.html#cb46-9"></a><span class="st">    </span><span class="kw">geom_text</span>(<span class="kw">aes</span>(<span class="dt">y =</span> {{ var_y }}, <span class="dt">label =</span> {{ var_y }}), <span class="dt">vjust=</span><span class="fl">1.4</span>, <span class="dt">color=</span><span class="st">&quot;gray30&quot;</span>, <span class="dt">size=</span><span class="fl">3.5</span>) <span class="op">+</span><span class="st"> </span></span>
<span id="cb46-10"><a href="12-statistics.html#cb46-10"></a><span class="st">    </span><span class="kw">labs</span>(<span class="dt">title =</span> nom_titre, <span class="dt">x=</span><span class="st">&quot;&quot;</span>, <span class="dt">y=</span><span class="st">&quot;&quot;</span>) <span class="op">+</span><span class="st">  </span></span>
<span id="cb46-11"><a href="12-statistics.html#cb46-11"></a><span class="st">    </span><span class="kw">theme</span>(<span class="dt">legend.position =</span> <span class="st">&quot;none&quot;</span>, <span class="dt">axis.text.x =</span> <span class="kw">element_text</span>(<span class="dt">angle =</span> <span class="dv">75</span>, <span class="dt">hjust=</span><span class="dv">1</span>))</span>
<span id="cb46-12"><a href="12-statistics.html#cb46-12"></a>  </span>
<span id="cb46-13"><a href="12-statistics.html#cb46-13"></a>  <span class="kw">return</span>(graph)</span>
<span id="cb46-14"><a href="12-statistics.html#cb46-14"></a>}</span>
<span id="cb46-15"><a href="12-statistics.html#cb46-15"></a></span>
<span id="cb46-16"><a href="12-statistics.html#cb46-16"></a>RP <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(<span class="op">!</span>AGER20 <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;02&quot;</span>, <span class="st">&quot;05&quot;</span>, <span class="st">&quot;10&quot;</span>, <span class="st">&quot;14&quot;</span>) <span class="op">&amp;</span><span class="st"> </span>TACT<span class="op">!=</span><span class="st">&quot;23&quot;</span> <span class="op">&amp;</span><span class="st"> </span>CS1<span class="op">!=</span><span class="st">&quot;1&quot;</span>) <span class="op">%&gt;%</span></span>
<span id="cb46-17"><a href="12-statistics.html#cb46-17"></a><span class="st">       </span><span class="kw">mutate</span>(<span class="dt">CS1=</span><span class="kw">recode</span>(CS1, <span class="st">&quot;2&quot;</span>=<span class="st">&quot;Artisans, commerçants et chefs d&#39;entreprise&quot;</span>, </span>
<span id="cb46-18"><a href="12-statistics.html#cb46-18"></a>                    <span class="st">&quot;3&quot;</span>=<span class="st">&quot;Cadres et professions intellectuelles supérieures&quot;</span>,</span>
<span id="cb46-19"><a href="12-statistics.html#cb46-19"></a>                    <span class="st">&quot;4&quot;</span>=<span class="st">&quot;Professions Intermédiaires&quot;</span>, <span class="st">&quot;5&quot;</span>=<span class="st">&quot;Employés&quot;</span>, <span class="st">&quot;6&quot;</span>=<span class="st">&quot;Ouvriers&quot;</span>,</span>
<span id="cb46-20"><a href="12-statistics.html#cb46-20"></a>                    <span class="st">&quot;7&quot;</span>=<span class="st">&quot;Retraités&quot;</span>, <span class="st">&quot;8&quot;</span>=<span class="st">&quot;Autres personnes sans activité professionnelle&quot;</span>),</span>
<span id="cb46-21"><a href="12-statistics.html#cb46-21"></a>              <span class="dt">LPRM_1 =</span> <span class="kw">case_when</span>(LPRM <span class="op">==</span><span class="st"> &quot;1&quot;</span> <span class="op">~</span><span class="st"> &quot;1&quot;</span>, <span class="ot">TRUE</span> <span class="op">~</span><span class="st"> &quot;0&quot;</span>)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb46-22"><a href="12-statistics.html#cb46-22"></a><span class="st">       </span><span class="kw">graph_baton1</span>(<span class="dt">codecom =</span> <span class="st">&quot;94071&quot;</span>, <span class="dt">list_mod =</span> <span class="kw">c</span>(<span class="st">&quot;1&quot;</span>, <span class="st">&quot;0&quot;</span>), <span class="dt">var =</span> CS1,<span class="dt">var_x=</span>CS1, <span class="dt">var_y =</span> pct,</span>
<span id="cb46-23"><a href="12-statistics.html#cb46-23"></a>                    <span class="dt">nom_titre =</span> <span class="st">&quot;Population de 15 ans ou plus selon la catégorie socioprofessionnelle&quot;</span>)</span></code></pre></div>
<p><img src="Projet-Data-Mining-2021_files/figure-html/unnamed-chunk-29-1.svg" width="672" /></p>
<p>En revanche, vous voyez ici qu’il nous renvoie le seul graphique. Et si on veut aussi le tableau ?
Le problème est qu’<em>a priori</em> une fonction ne sait pas renvoyer plusieurs valeurs de sortie. Par conséquent, on est obligés de contourner le problème en utilisant une petite astuce : on crée une liste d’objets.</p>
<div class="sourceCode" id="cb47"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb47-1"><a href="12-statistics.html#cb47-1"></a>graph_baton2 &lt;-<span class="st"> </span><span class="cf">function</span>(data, codecom, list_mod, var, var_x, var_y, nom_titre)</span>
<span id="cb47-2"><a href="12-statistics.html#cb47-2"></a>{</span>
<span id="cb47-3"><a href="12-statistics.html#cb47-3"></a>  tabvar &lt;-<span class="st"> </span><span class="kw">tab_var</span>(<span class="dt">data =</span> data, <span class="dt">codecom =</span> codecom, list_mod, <span class="dt">var =</span> {{ var }})</span>
<span id="cb47-4"><a href="12-statistics.html#cb47-4"></a>  </span>
<span id="cb47-5"><a href="12-statistics.html#cb47-5"></a>  graph &lt;-<span class="st"> </span>tabvar <span class="op">%&gt;%</span></span>
<span id="cb47-6"><a href="12-statistics.html#cb47-6"></a><span class="st">    </span><span class="kw">ggplot</span>() <span class="op">+</span><span class="st"> </span><span class="kw">aes</span>(<span class="dt">x =</span> {{ var_x }}, <span class="dt">y =</span> {{ var_y }}, <span class="dt">fill =</span> {{ var_x }}) <span class="op">+</span><span class="st"> </span></span>
<span id="cb47-7"><a href="12-statistics.html#cb47-7"></a><span class="st">    </span><span class="kw">geom_bar</span>(<span class="dt">stat=</span><span class="st">&quot;identity&quot;</span>) <span class="op">+</span><span class="st"> </span><span class="kw">scale_fill_brewer</span>(<span class="dt">palette =</span> <span class="st">&quot;Set2&quot;</span>) <span class="op">+</span></span>
<span id="cb47-8"><a href="12-statistics.html#cb47-8"></a><span class="st">    </span><span class="kw">geom_text</span>(<span class="kw">aes</span>(<span class="dt">y =</span> {{ var_y }}, <span class="dt">label =</span> {{ var_y }}), <span class="dt">vjust=</span><span class="fl">1.4</span>, <span class="dt">color=</span><span class="st">&quot;gray30&quot;</span>, <span class="dt">size=</span><span class="fl">3.5</span>) <span class="op">+</span><span class="st"> </span></span>
<span id="cb47-9"><a href="12-statistics.html#cb47-9"></a><span class="st">    </span><span class="kw">labs</span>(<span class="dt">title =</span> nom_titre, <span class="dt">x=</span><span class="st">&quot;&quot;</span>, <span class="dt">y=</span><span class="st">&quot;&quot;</span>) <span class="op">+</span><span class="st">  </span></span>
<span id="cb47-10"><a href="12-statistics.html#cb47-10"></a><span class="st">    </span><span class="kw">theme</span>(<span class="dt">legend.position =</span> <span class="st">&quot;none&quot;</span>, <span class="dt">axis.text.x =</span> <span class="kw">element_text</span>(<span class="dt">angle =</span> <span class="dv">75</span>, <span class="dt">hjust=</span><span class="dv">1</span>))</span>
<span id="cb47-11"><a href="12-statistics.html#cb47-11"></a>  </span>
<span id="cb47-12"><a href="12-statistics.html#cb47-12"></a>  <span class="kw">return</span>(<span class="kw">list</span>(tabvar, graph))</span>
<span id="cb47-13"><a href="12-statistics.html#cb47-13"></a>}</span>
<span id="cb47-14"><a href="12-statistics.html#cb47-14"></a></span>
<span id="cb47-15"><a href="12-statistics.html#cb47-15"></a>RP <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(<span class="op">!</span>AGER20 <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;02&quot;</span>, <span class="st">&quot;05&quot;</span>, <span class="st">&quot;10&quot;</span>, <span class="st">&quot;14&quot;</span>) <span class="op">&amp;</span><span class="st"> </span>TACT<span class="op">!=</span><span class="st">&quot;23&quot;</span> <span class="op">&amp;</span><span class="st"> </span>CS1<span class="op">!=</span><span class="st">&quot;1&quot;</span>) <span class="op">%&gt;%</span></span>
<span id="cb47-16"><a href="12-statistics.html#cb47-16"></a><span class="st">       </span><span class="kw">mutate</span>(<span class="dt">CS1=</span><span class="kw">recode</span>(CS1, <span class="st">&quot;2&quot;</span>=<span class="st">&quot;Artisans, commerçants et chefs d&#39;entreprise&quot;</span>, </span>
<span id="cb47-17"><a href="12-statistics.html#cb47-17"></a>                    <span class="st">&quot;3&quot;</span>=<span class="st">&quot;Cadres et professions intellectuelles supérieures&quot;</span>,</span>
<span id="cb47-18"><a href="12-statistics.html#cb47-18"></a>                    <span class="st">&quot;4&quot;</span>=<span class="st">&quot;Professions Intermédiaires&quot;</span>, <span class="st">&quot;5&quot;</span>=<span class="st">&quot;Employés&quot;</span>, <span class="st">&quot;6&quot;</span>=<span class="st">&quot;Ouvriers&quot;</span>,</span>
<span id="cb47-19"><a href="12-statistics.html#cb47-19"></a>                    <span class="st">&quot;7&quot;</span>=<span class="st">&quot;Retraités&quot;</span>, </span>
<span id="cb47-20"><a href="12-statistics.html#cb47-20"></a>                    <span class="st">&quot;8&quot;</span>=<span class="st">&quot;Autres personnes sans activité professionnelle&quot;</span>),</span>
<span id="cb47-21"><a href="12-statistics.html#cb47-21"></a>               <span class="dt">LPRM_1 =</span> <span class="kw">case_when</span>(LPRM <span class="op">==</span><span class="st"> &quot;1&quot;</span> <span class="op">~</span><span class="st"> &quot;1&quot;</span>, <span class="ot">TRUE</span> <span class="op">~</span><span class="st"> &quot;0&quot;</span>)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb47-22"><a href="12-statistics.html#cb47-22"></a><span class="st">       </span><span class="kw">graph_baton2</span>(<span class="dt">codecom =</span> <span class="st">&quot;94071&quot;</span>, <span class="dt">list_mod =</span> <span class="kw">c</span>(<span class="st">&quot;1&quot;</span>, <span class="st">&quot;0&quot;</span>), <span class="dt">var =</span> CS1, <span class="dt">var_x=</span>CS1, <span class="dt">var_y =</span> pct,</span>
<span id="cb47-23"><a href="12-statistics.html#cb47-23"></a>                    <span class="dt">nom_titre =</span> <span class="st">&quot;Population de 15 ans ou plus selon la catégorie socioprofessionnelle&quot;</span>)</span></code></pre></div>
<pre><code>[[1]]
                                                CS1    n  pct
1       Artisans, commerçants et chefs d&#39;entreprise  713  3.3
2 Cadres et professions intellectuelles supérieures 3487 16.1
3                        Professions Intermédiaires 3317 15.3
4                                          Employés 3244 14.9
5                                          Ouvriers 1691  7.8
6                                         Retraités 5610 25.8
7    Autres personnes sans activité professionnelle 3644 16.8

[[2]]</code></pre>
<p><img src="Projet-Data-Mining-2021_files/figure-html/unnamed-chunk-30-1.svg" width="672" /></p>
</div>
<div id="et-pour-distinguer-par-groupe-et-pour-avoir-des-moyennes" class="section level3" number="2.4.4">
<h3><span class="header-section-number">2.4.4</span> Et pour distinguer par groupe ? Et pour avoir des moyennes… ?</h3>
<p>Et si on veut représenter la population par catégorie socio-professionnelle en distinguant par sexe, comme précédemment ? Il faut rajouter la fonction <code>group_by()</code>, mais en faisant en sorte qu’on ne sache pas d’une part quelle variable on va mettre, ni combien de variables on va mettre, et d’autre part on pourrait se laisser le choix de ne pas en mettre du tout.</p>
<p>On peut repartir de notre fonction <code>tab_var</code>, pour rappel ci-dessous (non-exécutée) :</p>
<div class="sourceCode" id="cb49"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb49-1"><a href="12-statistics.html#cb49-1"></a>tab_var &lt;-<span class="st"> </span><span class="cf">function</span>(data, codecom, list_mod, var)</span>
<span id="cb49-2"><a href="12-statistics.html#cb49-2"></a>{</span>
<span id="cb49-3"><a href="12-statistics.html#cb49-3"></a>  tab &lt;-<span class="st"> </span>data <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb49-4"><a href="12-statistics.html#cb49-4"></a><span class="st">    </span><span class="kw">mutate</span>(<span class="dt">COM =</span> <span class="kw">substr</span>(IRIS,<span class="dv">1</span>,<span class="dv">5</span>)) <span class="op">%&gt;%</span></span>
<span id="cb49-5"><a href="12-statistics.html#cb49-5"></a><span class="st">    </span><span class="kw">filter</span>(LPRM_<span class="dv">1</span> <span class="op">%in%</span><span class="st"> </span>list_mod <span class="op">&amp;</span><span class="st"> </span>COM <span class="op">==</span><span class="st"> </span>codecom) <span class="op">%&gt;%</span></span>
<span id="cb49-6"><a href="12-statistics.html#cb49-6"></a><span class="st">    </span><span class="kw">count</span>({{ var }}, <span class="dt">wt=</span>IPONDI) <span class="op">%&gt;%</span><span class="st">  </span></span>
<span id="cb49-7"><a href="12-statistics.html#cb49-7"></a><span class="st">    </span><span class="kw">mutate</span>(<span class="dt">n=</span><span class="kw">round</span>(n,<span class="dv">0</span>), <span class="dt">pct=</span><span class="kw">prop.table</span>(n)<span class="op">*</span><span class="dv">100</span>, <span class="dt">pct=</span><span class="kw">round</span>(pct, <span class="dv">1</span>))</span>
<span id="cb49-8"><a href="12-statistics.html#cb49-8"></a></span>
<span id="cb49-9"><a href="12-statistics.html#cb49-9"></a>  <span class="kw">return</span>(tab)</span>
<span id="cb49-10"><a href="12-statistics.html#cb49-10"></a>}</span></code></pre></div>
<p>Procédons par étapes : on lui ajoute la fonction <code>group_by()</code> qui nous permettrait de distinguer selon une seule autre variable :</p>
<div class="sourceCode" id="cb50"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb50-1"><a href="12-statistics.html#cb50-1"></a>tab_var1 &lt;-<span class="st"> </span><span class="cf">function</span>(data, codecom, list_mod, var, var2)</span>
<span id="cb50-2"><a href="12-statistics.html#cb50-2"></a>{</span>
<span id="cb50-3"><a href="12-statistics.html#cb50-3"></a>  tab &lt;-<span class="st"> </span>data <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb50-4"><a href="12-statistics.html#cb50-4"></a><span class="st">    </span><span class="kw">mutate</span>(<span class="dt">COM =</span> <span class="kw">substr</span>(IRIS,<span class="dv">1</span>,<span class="dv">5</span>)) <span class="op">%&gt;%</span></span>
<span id="cb50-5"><a href="12-statistics.html#cb50-5"></a><span class="st">    </span><span class="kw">filter</span>(LPRM_<span class="dv">1</span> <span class="op">%in%</span><span class="st"> </span>list_mod <span class="op">&amp;</span><span class="st"> </span>COM <span class="op">==</span><span class="st"> </span>codecom) <span class="op">%&gt;%</span></span>
<span id="cb50-6"><a href="12-statistics.html#cb50-6"></a><span class="st">    </span><span class="kw">group_by</span>({{ var2 }}) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb50-7"><a href="12-statistics.html#cb50-7"></a><span class="st">    </span><span class="kw">count</span>({{ var }}, <span class="dt">wt=</span>IPONDI) <span class="op">%&gt;%</span><span class="st">  </span></span>
<span id="cb50-8"><a href="12-statistics.html#cb50-8"></a><span class="st">    </span><span class="kw">mutate</span>(<span class="dt">n=</span><span class="kw">round</span>(n,<span class="dv">0</span>), <span class="dt">pct=</span><span class="kw">prop.table</span>(n)<span class="op">*</span><span class="dv">100</span>, <span class="dt">pct=</span><span class="kw">round</span>(pct, <span class="dv">1</span>))</span>
<span id="cb50-9"><a href="12-statistics.html#cb50-9"></a></span>
<span id="cb50-10"><a href="12-statistics.html#cb50-10"></a>  <span class="kw">return</span>(tab)</span>
<span id="cb50-11"><a href="12-statistics.html#cb50-11"></a>}</span>
<span id="cb50-12"><a href="12-statistics.html#cb50-12"></a></span>
<span id="cb50-13"><a href="12-statistics.html#cb50-13"></a>RP <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb50-14"><a href="12-statistics.html#cb50-14"></a><span class="st">    </span><span class="kw">filter</span>(<span class="op">!</span>AGER20 <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;02&quot;</span>, <span class="st">&quot;05&quot;</span>, <span class="st">&quot;10&quot;</span>, <span class="st">&quot;14&quot;</span>) <span class="op">&amp;</span><span class="st"> </span>TACT<span class="op">!=</span><span class="st">&quot;23&quot;</span> <span class="op">&amp;</span><span class="st"> </span>CS1<span class="op">!=</span><span class="st">&quot;1&quot;</span>) <span class="op">%&gt;%</span></span>
<span id="cb50-15"><a href="12-statistics.html#cb50-15"></a><span class="st">    </span><span class="kw">mutate</span>(<span class="dt">SEXE=</span><span class="kw">recode</span>(SEXE, <span class="st">&quot;1&quot;</span>=<span class="st">&quot;Homme&quot;</span>, <span class="st">&quot;2&quot;</span>=<span class="st">&quot;Femme&quot;</span>),</span>
<span id="cb50-16"><a href="12-statistics.html#cb50-16"></a>           <span class="dt">CS1=</span><span class="kw">recode</span>(CS1, <span class="st">&quot;2&quot;</span>=<span class="st">&quot;Artisans, commerçants et chefs d&#39;entreprise&quot;</span>, </span>
<span id="cb50-17"><a href="12-statistics.html#cb50-17"></a>                    <span class="st">&quot;3&quot;</span>=<span class="st">&quot;Cadres et professions intellectuelles supérieures&quot;</span>, </span>
<span id="cb50-18"><a href="12-statistics.html#cb50-18"></a>                    <span class="st">&quot;4&quot;</span>=<span class="st">&quot;Professions Intermédiaires&quot;</span>, <span class="st">&quot;5&quot;</span>=<span class="st">&quot;Employés&quot;</span>, <span class="st">&quot;6&quot;</span>=<span class="st">&quot;Ouvriers&quot;</span>,</span>
<span id="cb50-19"><a href="12-statistics.html#cb50-19"></a>                    <span class="st">&quot;7&quot;</span>=<span class="st">&quot;Retraités&quot;</span>, <span class="st">&quot;8&quot;</span>=<span class="st">&quot;Autres personnes sans activité professionnelle&quot;</span>),</span>
<span id="cb50-20"><a href="12-statistics.html#cb50-20"></a>           <span class="dt">LPRM_1 =</span> <span class="kw">case_when</span>(LPRM <span class="op">==</span><span class="st"> &quot;1&quot;</span> <span class="op">~</span><span class="st"> &quot;1&quot;</span>, <span class="ot">TRUE</span> <span class="op">~</span><span class="st"> &quot;0&quot;</span>)) <span class="op">%&gt;%</span></span>
<span id="cb50-21"><a href="12-statistics.html#cb50-21"></a><span class="st">    </span><span class="kw">tab_var1</span>(<span class="dt">codecom=</span><span class="st">&quot;94071&quot;</span>, <span class="dt">list_mod=</span><span class="kw">c</span>(<span class="st">&quot;1&quot;</span>, <span class="st">&quot;0&quot;</span>), <span class="dt">var=</span>CS1, <span class="dt">var2=</span>SEXE)</span></code></pre></div>
<pre><code># A tibble: 14 x 4
   SEXE  CS1                                                   n   pct
   &lt;fct&gt; &lt;fct&gt;                                             &lt;dbl&gt; &lt;dbl&gt;
 1 Homme Artisans, commerçants et chefs d&#39;entreprise         516   5  
 2 Homme Cadres et professions intellectuelles supérieures  2018  19.7
 3 Homme Professions Intermédiaires                         1409  13.8
 4 Homme Employés                                            857   8.4
 5 Homme Ouvriers                                           1407  13.8
 6 Homme Retraités                                          2466  24.1
 7 Homme Autres personnes sans activité professionnelle     1555  15.2
 8 Femme Artisans, commerçants et chefs d&#39;entreprise         197   1.7
 9 Femme Cadres et professions intellectuelles supérieures  1469  12.8
10 Femme Professions Intermédiaires                         1908  16.6
11 Femme Employés                                           2387  20.8
12 Femme Ouvriers                                            284   2.5
13 Femme Retraités                                          3143  27.4
14 Femme Autres personnes sans activité professionnelle     2089  18.2</code></pre>
<p>Mais on voudrait pouvoir éventuellement distinguer selon plusieurs variables, par IRIS et sexe par exemple, ou tout autre chose ; et puis on voudrait aussi pendant qu’on y est n’avoir qu’une seule fonction <code>tab_var</code> pour avoir un tableau selon une seule variable ou selon plusieurs autres variables.
Pour laisser à la fonction la possibilité d’appeler plusieurs paramètres (ou aucun !), il faut utiliser les “…”, que l’on va ici mettre dans la fonction <code>group_by(...)</code>.</p>
<div class="sourceCode" id="cb52"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb52-1"><a href="12-statistics.html#cb52-1"></a>tab_var &lt;-<span class="st"> </span><span class="cf">function</span>(data, codecom, list_mod, var, ...)</span>
<span id="cb52-2"><a href="12-statistics.html#cb52-2"></a>{</span>
<span id="cb52-3"><a href="12-statistics.html#cb52-3"></a>  tab &lt;-<span class="st"> </span>data <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb52-4"><a href="12-statistics.html#cb52-4"></a><span class="st">    </span><span class="kw">mutate</span>(<span class="dt">COM =</span> <span class="kw">substr</span>(IRIS,<span class="dv">1</span>,<span class="dv">5</span>)) <span class="op">%&gt;%</span></span>
<span id="cb52-5"><a href="12-statistics.html#cb52-5"></a><span class="st">    </span><span class="kw">filter</span>(LPRM_<span class="dv">1</span> <span class="op">%in%</span><span class="st"> </span>list_mod <span class="op">&amp;</span><span class="st"> </span>COM <span class="op">==</span><span class="st"> </span>codecom) <span class="op">%&gt;%</span></span>
<span id="cb52-6"><a href="12-statistics.html#cb52-6"></a><span class="st">    </span><span class="kw">group_by</span>(...) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb52-7"><a href="12-statistics.html#cb52-7"></a><span class="st">    </span><span class="kw">count</span>({{ var }}, <span class="dt">wt=</span>IPONDI) <span class="op">%&gt;%</span><span class="st">  </span></span>
<span id="cb52-8"><a href="12-statistics.html#cb52-8"></a><span class="st">    </span><span class="kw">mutate</span>(<span class="dt">n=</span><span class="kw">round</span>(n,<span class="dv">0</span>), <span class="dt">pct=</span><span class="kw">prop.table</span>(n)<span class="op">*</span><span class="dv">100</span>, <span class="dt">pct=</span><span class="kw">round</span>(pct, <span class="dv">1</span>))</span>
<span id="cb52-9"><a href="12-statistics.html#cb52-9"></a></span>
<span id="cb52-10"><a href="12-statistics.html#cb52-10"></a>  <span class="kw">return</span>(tab)</span>
<span id="cb52-11"><a href="12-statistics.html#cb52-11"></a>}</span>
<span id="cb52-12"><a href="12-statistics.html#cb52-12"></a></span>
<span id="cb52-13"><a href="12-statistics.html#cb52-13"></a><span class="co">#Ici, je crée un nouvel objet, pour pouvoir lancer les 2 fonctions de test à la suite</span></span>
<span id="cb52-14"><a href="12-statistics.html#cb52-14"></a>RP_stats &lt;-<span class="st"> </span>RP <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb52-15"><a href="12-statistics.html#cb52-15"></a><span class="st">        </span><span class="kw">filter</span>(<span class="op">!</span>AGER20 <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;02&quot;</span>, <span class="st">&quot;05&quot;</span>, <span class="st">&quot;10&quot;</span>, <span class="st">&quot;14&quot;</span>) <span class="op">&amp;</span><span class="st"> </span>TACT<span class="op">!=</span><span class="st">&quot;23&quot;</span> <span class="op">&amp;</span><span class="st"> </span>CS1<span class="op">!=</span><span class="st">&quot;1&quot;</span>) <span class="op">%&gt;%</span></span>
<span id="cb52-16"><a href="12-statistics.html#cb52-16"></a><span class="st">        </span><span class="kw">mutate</span>(<span class="dt">SEXE=</span><span class="kw">recode</span>(SEXE, <span class="st">&quot;1&quot;</span>=<span class="st">&quot;Homme&quot;</span>, <span class="st">&quot;2&quot;</span>=<span class="st">&quot;Femme&quot;</span>),</span>
<span id="cb52-17"><a href="12-statistics.html#cb52-17"></a>               <span class="dt">CS1=</span><span class="kw">recode</span>(CS1, <span class="st">&quot;2&quot;</span>=<span class="st">&quot;Artisans, commerçants et chefs d&#39;entreprise&quot;</span>, </span>
<span id="cb52-18"><a href="12-statistics.html#cb52-18"></a>                          <span class="st">&quot;3&quot;</span>=<span class="st">&quot;Cadres et professions intellectuelles supérieures&quot;</span>, </span>
<span id="cb52-19"><a href="12-statistics.html#cb52-19"></a>                          <span class="st">&quot;4&quot;</span>=<span class="st">&quot;Professions Intermédiaires&quot;</span>, <span class="st">&quot;5&quot;</span>=<span class="st">&quot;Employés&quot;</span>, <span class="st">&quot;6&quot;</span>=<span class="st">&quot;Ouvriers&quot;</span>,</span>
<span id="cb52-20"><a href="12-statistics.html#cb52-20"></a>                          <span class="st">&quot;7&quot;</span>=<span class="st">&quot;Retraités&quot;</span>, <span class="st">&quot;8&quot;</span>=<span class="st">&quot;Autres personnes sans activité professionnelle&quot;</span>),</span>
<span id="cb52-21"><a href="12-statistics.html#cb52-21"></a>               <span class="dt">LPRM_1 =</span> <span class="kw">case_when</span>(LPRM <span class="op">==</span><span class="st"> &quot;1&quot;</span> <span class="op">~</span><span class="st"> &quot;1&quot;</span>, <span class="ot">TRUE</span> <span class="op">~</span><span class="st"> &quot;0&quot;</span>)) </span>
<span id="cb52-22"><a href="12-statistics.html#cb52-22"></a>        </span>
<span id="cb52-23"><a href="12-statistics.html#cb52-23"></a><span class="kw">tab_var</span>(<span class="dt">data=</span>RP_stats, <span class="dt">codecom=</span><span class="st">&quot;94071&quot;</span>, <span class="dt">list_mod=</span><span class="kw">c</span>(<span class="st">&quot;1&quot;</span>, <span class="st">&quot;0&quot;</span>), <span class="dt">var=</span>CS1)</span></code></pre></div>
<pre><code># A tibble: 7 x 3
  CS1                                                   n   pct
  &lt;fct&gt;                                             &lt;dbl&gt; &lt;dbl&gt;
1 Artisans, commerçants et chefs d&#39;entreprise         713   3.3
2 Cadres et professions intellectuelles supérieures  3487  16.1
3 Professions Intermédiaires                         3317  15.3
4 Employés                                           3244  14.9
5 Ouvriers                                           1691   7.8
6 Retraités                                          5610  25.8
7 Autres personnes sans activité professionnelle     3644  16.8</code></pre>
<div class="sourceCode" id="cb54"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb54-1"><a href="12-statistics.html#cb54-1"></a><span class="kw">tab_var</span>(<span class="dt">data=</span>RP_stats, <span class="dt">codecom=</span><span class="st">&quot;94071&quot;</span>, <span class="dt">list_mod=</span><span class="kw">c</span>(<span class="st">&quot;1&quot;</span>, <span class="st">&quot;0&quot;</span>), <span class="dt">var=</span>CS1, SEXE)</span></code></pre></div>
<pre><code># A tibble: 14 x 4
   SEXE  CS1                                                   n   pct
   &lt;fct&gt; &lt;fct&gt;                                             &lt;dbl&gt; &lt;dbl&gt;
 1 Homme Artisans, commerçants et chefs d&#39;entreprise         516   5  
 2 Homme Cadres et professions intellectuelles supérieures  2018  19.7
 3 Homme Professions Intermédiaires                         1409  13.8
 4 Homme Employés                                            857   8.4
 5 Homme Ouvriers                                           1407  13.8
 6 Homme Retraités                                          2466  24.1
 7 Homme Autres personnes sans activité professionnelle     1555  15.2
 8 Femme Artisans, commerçants et chefs d&#39;entreprise         197   1.7
 9 Femme Cadres et professions intellectuelles supérieures  1469  12.8
10 Femme Professions Intermédiaires                         1908  16.6
11 Femme Employés                                           2387  20.8
12 Femme Ouvriers                                            284   2.5
13 Femme Retraités                                          3143  27.4
14 Femme Autres personnes sans activité professionnelle     2089  18.2</code></pre>
<p>Et on peut réécrire ainsi notre fonction <code>graph_baton1()</code> pour intégrer cette nouvelle version de notre fonction <code>tabvar()</code> !</p>
<div class="sourceCode" id="cb56"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb56-1"><a href="12-statistics.html#cb56-1"></a>graph_baton1 &lt;-<span class="st"> </span><span class="cf">function</span>(data, codecom, list_mod, var, ..., var_x, var_y, nom_titre)</span>
<span id="cb56-2"><a href="12-statistics.html#cb56-2"></a>{</span>
<span id="cb56-3"><a href="12-statistics.html#cb56-3"></a>  tabvar &lt;-<span class="st"> </span><span class="kw">tab_var</span>(<span class="dt">data =</span> data, <span class="dt">codecom =</span> codecom, list_mod, <span class="dt">var =</span> {{ var }}, ...)</span>
<span id="cb56-4"><a href="12-statistics.html#cb56-4"></a>  </span>
<span id="cb56-5"><a href="12-statistics.html#cb56-5"></a>  graph &lt;-<span class="st"> </span>tabvar <span class="op">%&gt;%</span></span>
<span id="cb56-6"><a href="12-statistics.html#cb56-6"></a><span class="st">    </span><span class="kw">ggplot</span>() <span class="op">+</span><span class="st"> </span><span class="kw">aes</span>(<span class="dt">x =</span> {{ var_x }}, <span class="dt">y =</span> {{ var_y }}, <span class="dt">fill =</span> {{ var_x }}) <span class="op">+</span><span class="st"> </span></span>
<span id="cb56-7"><a href="12-statistics.html#cb56-7"></a><span class="st">    </span><span class="kw">geom_bar</span>(<span class="dt">stat=</span><span class="st">&quot;identity&quot;</span>) <span class="op">+</span><span class="st"> </span><span class="kw">scale_fill_brewer</span>(<span class="dt">palette =</span> <span class="st">&quot;Set2&quot;</span>) <span class="op">+</span></span>
<span id="cb56-8"><a href="12-statistics.html#cb56-8"></a><span class="st">    </span><span class="kw">geom_text</span>(<span class="kw">aes</span>(<span class="dt">y =</span> {{ var_y }}, <span class="dt">label =</span> {{ var_y }}), <span class="dt">vjust=</span><span class="fl">1.4</span>, <span class="dt">color=</span><span class="st">&quot;gray30&quot;</span>, <span class="dt">size=</span><span class="fl">3.5</span>) <span class="op">+</span><span class="st"> </span></span>
<span id="cb56-9"><a href="12-statistics.html#cb56-9"></a><span class="st">    </span><span class="kw">labs</span>(<span class="dt">title =</span> nom_titre, <span class="dt">x=</span><span class="st">&quot;&quot;</span>, <span class="dt">y=</span><span class="st">&quot;&quot;</span>) <span class="op">+</span><span class="st">  </span></span>
<span id="cb56-10"><a href="12-statistics.html#cb56-10"></a><span class="st">    </span><span class="kw">theme</span>(<span class="dt">legend.position =</span> <span class="st">&quot;none&quot;</span>, <span class="dt">axis.text.x =</span> <span class="kw">element_text</span>(<span class="dt">angle =</span> <span class="dv">75</span>, <span class="dt">hjust=</span><span class="dv">1</span>))</span>
<span id="cb56-11"><a href="12-statistics.html#cb56-11"></a>  </span>
<span id="cb56-12"><a href="12-statistics.html#cb56-12"></a>  <span class="kw">return</span>(graph)</span>
<span id="cb56-13"><a href="12-statistics.html#cb56-13"></a>}</span></code></pre></div>
<p>Ainsi, pour avoir un graphique similaire à celui de fin de section précédente (qui s’intitulait “Population de 15 ans ou plus par sexe et catégorie socioprofessionnelle”), on y arrive avec ce code, c’est-à-dire en sauvegardant le résultat de notre fonction dans un objet graphe (intitulé ici “gg”) puis en lui ajoutant ensuite la fonction <code>facet_wrap()</code> et la variable qu’on a utilisée dans le <code>group_by()</code> à l’intérieur de la fonction (ici donc le sexe), et en lui spécifiant éventuellement quelques ajouts supplémentaires concernant l’arrière-plan du graphique avec <code>theme()</code> :</p>
<div class="sourceCode" id="cb57"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb57-1"><a href="12-statistics.html#cb57-1"></a>gg &lt;-<span class="st"> </span>RP <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb57-2"><a href="12-statistics.html#cb57-2"></a><span class="st">        </span><span class="kw">filter</span>(<span class="op">!</span>AGER20 <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;02&quot;</span>, <span class="st">&quot;05&quot;</span>, <span class="st">&quot;10&quot;</span>, <span class="st">&quot;14&quot;</span>) <span class="op">&amp;</span><span class="st"> </span>TACT<span class="op">!=</span><span class="st">&quot;23&quot;</span> <span class="op">&amp;</span><span class="st"> </span>CS1<span class="op">!=</span><span class="st">&quot;1&quot;</span>) <span class="op">%&gt;%</span><span class="st">  </span></span>
<span id="cb57-3"><a href="12-statistics.html#cb57-3"></a><span class="st">        </span><span class="kw">mutate</span>(<span class="dt">CS1=</span><span class="kw">recode</span>(CS1, <span class="st">&quot;2&quot;</span>=<span class="st">&quot;Artisans, commerçants et chefs d&#39;entreprise&quot;</span>,</span>
<span id="cb57-4"><a href="12-statistics.html#cb57-4"></a>                          <span class="st">&quot;3&quot;</span>=<span class="st">&quot;Cadres et professions intellectuelles supérieures&quot;</span>, </span>
<span id="cb57-5"><a href="12-statistics.html#cb57-5"></a>                          <span class="st">&quot;4&quot;</span>=<span class="st">&quot;Professions Intermédiaires&quot;</span>, <span class="st">&quot;5&quot;</span>=<span class="st">&quot;Employés&quot;</span>, <span class="st">&quot;6&quot;</span>=<span class="st">&quot;Ouvriers&quot;</span>,</span>
<span id="cb57-6"><a href="12-statistics.html#cb57-6"></a>                          <span class="st">&quot;7&quot;</span>=<span class="st">&quot;Retraités&quot;</span>, <span class="st">&quot;8&quot;</span>=<span class="st">&quot;Autres personnes sans activité professionnelle&quot;</span>),</span>
<span id="cb57-7"><a href="12-statistics.html#cb57-7"></a>               <span class="dt">SEXE=</span><span class="kw">recode</span>(SEXE, <span class="st">&quot;1&quot;</span>=<span class="st">&quot;Homme&quot;</span>, <span class="st">&quot;2&quot;</span>=<span class="st">&quot;Femme&quot;</span>),</span>
<span id="cb57-8"><a href="12-statistics.html#cb57-8"></a>               <span class="dt">LPRM_1 =</span> <span class="kw">case_when</span>(LPRM <span class="op">==</span><span class="st"> &quot;1&quot;</span> <span class="op">~</span><span class="st"> &quot;1&quot;</span>, <span class="ot">TRUE</span> <span class="op">~</span><span class="st"> &quot;0&quot;</span>)) <span class="op">%&gt;%</span></span>
<span id="cb57-9"><a href="12-statistics.html#cb57-9"></a><span class="st">        </span><span class="kw">graph_baton1</span>(<span class="dt">codecom=</span> <span class="st">&quot;94071&quot;</span>, <span class="dt">list_mod=</span> <span class="kw">c</span>(<span class="st">&quot;1&quot;</span>, <span class="st">&quot;0&quot;</span>), <span class="dt">var=</span>CS1, SEXE, <span class="dt">var_x=</span>CS1, <span class="dt">var_y=</span> pct,</span>
<span id="cb57-10"><a href="12-statistics.html#cb57-10"></a>               <span class="dt">nom_titre=</span> <span class="st">&quot;Population de 15 ans ou plus par sexe et catégorie socioprofessionnelle&quot;</span>)</span>
<span id="cb57-11"><a href="12-statistics.html#cb57-11"></a></span>
<span id="cb57-12"><a href="12-statistics.html#cb57-12"></a>gg <span class="op">+</span><span class="st"> </span><span class="kw">facet_wrap</span>(<span class="op">~</span>SEXE,<span class="dt">nrow=</span><span class="dv">1</span>, <span class="dt">ncol=</span><span class="dv">2</span>) <span class="op">+</span><span class="st">  </span><span class="kw">theme_grey</span>() <span class="op">+</span><span class="st"> </span></span>
<span id="cb57-13"><a href="12-statistics.html#cb57-13"></a><span class="st">  </span><span class="kw">theme</span>(<span class="dt">axis.text.x=</span><span class="kw">element_blank</span>(), <span class="dt">axis.ticks.x=</span><span class="kw">element_blank</span>(), <span class="dt">legend.position=</span><span class="st">&quot;bottom&quot;</span>,</span>
<span id="cb57-14"><a href="12-statistics.html#cb57-14"></a>        <span class="dt">legend.title =</span> <span class="kw">element_blank</span>(), <span class="dt">plot.title =</span> <span class="kw">element_text</span>(<span class="dt">hjust =</span> <span class="fl">0.5</span>))</span></code></pre></div>
<p><img src="Projet-Data-Mining-2021_files/figure-html/unnamed-chunk-35-1.svg" width="672" /></p>
<p>En réalité, pour une utilisation plus générale, il est sans doute préférable de ne pas indiquer dans la fonction les éléments relatifs ni au <code>theme()</code>, ni à <code>geom_text()</code>, et enfin de distinguer les variables utilisées pour le tableau, et les variables utilisées dans le graphique car dès qu’on sera sur des graphiques plus complexes avec plusieurs variables dans le <code>group_by()</code>, les choses risquent de ne pas fonctionner avec une fonction ne distinguant pas bien l’ensemble des variables. On peut donc finalement, ou en plus, proposer cette fonction, en ajoutant un paramètre “var_z” pour bien distinguer les différentes variables :</p>
<div class="sourceCode" id="cb58"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb58-1"><a href="12-statistics.html#cb58-1"></a>graph_baton3 &lt;-<span class="st"> </span><span class="cf">function</span>(data, codecom, list_mod, var, ..., var_x, var_y, var_z, nom_titre)</span>
<span id="cb58-2"><a href="12-statistics.html#cb58-2"></a>{</span>
<span id="cb58-3"><a href="12-statistics.html#cb58-3"></a>  tabvar &lt;-<span class="st"> </span><span class="kw">tab_var</span>(<span class="dt">data =</span> data, <span class="dt">codecom =</span> codecom, list_mod, <span class="dt">var =</span> {{ var }}, ...)</span>
<span id="cb58-4"><a href="12-statistics.html#cb58-4"></a>  </span>
<span id="cb58-5"><a href="12-statistics.html#cb58-5"></a>  graph &lt;-<span class="st"> </span>tabvar <span class="op">%&gt;%</span></span>
<span id="cb58-6"><a href="12-statistics.html#cb58-6"></a><span class="st">    </span><span class="kw">ggplot</span>() <span class="op">+</span><span class="st"> </span><span class="kw">aes</span>(<span class="dt">x =</span> {{ var_x }}, <span class="dt">y =</span> {{ var_y }}, <span class="dt">fill =</span> {{ var_z }}) <span class="op">+</span><span class="st"> </span></span>
<span id="cb58-7"><a href="12-statistics.html#cb58-7"></a><span class="st">    </span><span class="kw">geom_bar</span>(<span class="dt">stat=</span><span class="st">&quot;identity&quot;</span>) <span class="op">+</span><span class="st"> </span><span class="kw">scale_fill_brewer</span>(<span class="dt">palette =</span> <span class="st">&quot;Set2&quot;</span>) <span class="op">+</span></span>
<span id="cb58-8"><a href="12-statistics.html#cb58-8"></a><span class="st">    </span><span class="kw">labs</span>(<span class="dt">title =</span> nom_titre, <span class="dt">x=</span><span class="st">&quot;&quot;</span>, <span class="dt">y=</span><span class="st">&quot;&quot;</span>) </span>
<span id="cb58-9"><a href="12-statistics.html#cb58-9"></a>  </span>
<span id="cb58-10"><a href="12-statistics.html#cb58-10"></a>  <span class="kw">return</span>(graph)</span>
<span id="cb58-11"><a href="12-statistics.html#cb58-11"></a>}</span></code></pre></div>
<p>Elle est par exemple utile pour réaliser le graphique en fin de section précédente qui était intitulé : “Population de 15 ans ou plus en emploi par statut, sexe et catégorie socioprofessionnelle”:</p>
<div class="sourceCode" id="cb59"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb59-1"><a href="12-statistics.html#cb59-1"></a>gg &lt;-RP <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb59-2"><a href="12-statistics.html#cb59-2"></a><span class="st">      </span><span class="kw">filter</span>(<span class="op">!</span>AGER20 <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;02&quot;</span>, <span class="st">&quot;05&quot;</span>, <span class="st">&quot;10&quot;</span>, <span class="st">&quot;14&quot;</span>) <span class="op">&amp;</span><span class="st"> </span>TACT<span class="op">==</span><span class="st">&quot;11&quot;</span> <span class="op">&amp;</span><span class="st"> </span>CS1<span class="op">!=</span><span class="st">&quot;1&quot;</span>) <span class="op">%&gt;%</span></span>
<span id="cb59-3"><a href="12-statistics.html#cb59-3"></a><span class="st">      </span><span class="kw">mutate</span>(<span class="dt">EMPL=</span><span class="kw">case_when</span>(EMPL <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;11&quot;</span>,<span class="st">&quot;12&quot;</span>,<span class="st">&quot;13&quot;</span>,<span class="st">&quot;14&quot;</span>,<span class="st">&quot;15&quot;</span>,<span class="st">&quot;16&quot;</span>) <span class="op">~</span><span class="st"> &quot;Salariés&quot;</span>, </span>
<span id="cb59-4"><a href="12-statistics.html#cb59-4"></a>                            EMPL <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;21&quot;</span>,<span class="st">&quot;22&quot;</span>,<span class="st">&quot;23&quot;</span>) <span class="op">~</span><span class="st"> &quot;Non Salariés&quot;</span>),</span>
<span id="cb59-5"><a href="12-statistics.html#cb59-5"></a>             <span class="dt">CS1=</span><span class="kw">recode</span>(CS1, <span class="st">&quot;2&quot;</span>=<span class="st">&quot;Artisans, commerçants et chefs d&#39;entreprise&quot;</span>, </span>
<span id="cb59-6"><a href="12-statistics.html#cb59-6"></a>                             <span class="st">&quot;3&quot;</span>=<span class="st">&quot;Cadres et professions intellectuelles supérieures&quot;</span>, </span>
<span id="cb59-7"><a href="12-statistics.html#cb59-7"></a>                             <span class="st">&quot;4&quot;</span>=<span class="st">&quot;Professions Intermédiaires&quot;</span>, <span class="st">&quot;5&quot;</span>=<span class="st">&quot;Employés&quot;</span>, <span class="st">&quot;6&quot;</span>=<span class="st">&quot;Ouvriers&quot;</span>),</span>
<span id="cb59-8"><a href="12-statistics.html#cb59-8"></a>             <span class="dt">SEXE=</span><span class="kw">recode</span>(SEXE, <span class="st">&quot;1&quot;</span>=<span class="st">&quot;Homme&quot;</span>, <span class="st">&quot;2&quot;</span>=<span class="st">&quot;Femme&quot;</span>),</span>
<span id="cb59-9"><a href="12-statistics.html#cb59-9"></a>             <span class="dt">LPRM_1 =</span> <span class="kw">case_when</span>(LPRM <span class="op">==</span><span class="st"> &quot;1&quot;</span> <span class="op">~</span><span class="st"> &quot;1&quot;</span>, <span class="ot">TRUE</span> <span class="op">~</span><span class="st"> &quot;0&quot;</span>)) <span class="op">%&gt;%</span></span>
<span id="cb59-10"><a href="12-statistics.html#cb59-10"></a><span class="st">      </span><span class="kw">graph_baton3</span>(<span class="dt">codecom=</span> <span class="st">&quot;94071&quot;</span>, <span class="dt">list_mod=</span> <span class="kw">c</span>(<span class="st">&quot;1&quot;</span>, <span class="st">&quot;0&quot;</span>), <span class="dt">var =</span> CS1, SEXE, EMPL, <span class="dt">var_x =</span> SEXE, </span>
<span id="cb59-11"><a href="12-statistics.html#cb59-11"></a>                   <span class="dt">var_y =</span> pct, <span class="dt">var_z =</span> CS1, <span class="dt">nom_titre=</span> <span class="st">&quot;Population de 15 ans ou plus en emploi par statut, sexe et catégorie socioprofessionnelle&quot;</span>)</span>
<span id="cb59-12"><a href="12-statistics.html#cb59-12"></a></span>
<span id="cb59-13"><a href="12-statistics.html#cb59-13"></a>gg <span class="op">+</span><span class="st"> </span><span class="kw">facet_wrap</span>(<span class="op">~</span>EMPL, <span class="dt">nrow=</span><span class="dv">1</span>, <span class="dt">ncol=</span><span class="dv">2</span>) <span class="op">+</span><span class="st"> </span><span class="kw">geom_text</span>(<span class="kw">aes</span>(<span class="dt">label =</span> <span class="kw">after_stat</span>(y)), <span class="dt">color=</span><span class="st">&quot;gray24&quot;</span>, </span>
<span id="cb59-14"><a href="12-statistics.html#cb59-14"></a>                                                   <span class="dt">position =</span> <span class="kw">position_stack</span>(.<span class="dv">5</span>), <span class="dt">size=</span><span class="fl">3.5</span>) <span class="op">+</span></span>
<span id="cb59-15"><a href="12-statistics.html#cb59-15"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">fill=</span><span class="st">&quot;Catégorie socio-professionnelle&quot;</span>) <span class="op">+</span><span class="st"> </span><span class="kw">theme</span>(<span class="dt">legend.position=</span><span class="st">&quot;right&quot;</span>)</span></code></pre></div>
<p><img src="Projet-Data-Mining-2021_files/figure-html/unnamed-chunk-37-1.svg" width="672" /></p>
<p>Enfin, on peut vouloir créer une fonction pour réaliser des statistiques sur des variables quantitatives, comme on le fait avec la fonction <code>summarise()</code>. On avait par exemple calculé, plus haut, le nombre moyen de pièces par logement selon l’ancienneté d’emménagement du ménage. On peut prendre exemple sur le code de notre fonction <code>tabvar()</code> et intégrer la fonction <code>summarise()</code> au lieu de <code>count()</code> ; et ajouter un paramètre pour expliciter le nom que l’on souhaite donner à la variable de sortie (la moyenne ici), avec les <code>{{ }}</code> comme pour la variable (paramètre “nom_var” ici donc).</p>
<div class="sourceCode" id="cb60"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb60-1"><a href="12-statistics.html#cb60-1"></a>mean_var &lt;-<span class="st"> </span><span class="cf">function</span>(data, codecom,list_mod, var, ..., nom_var)</span>
<span id="cb60-2"><a href="12-statistics.html#cb60-2"></a>{</span>
<span id="cb60-3"><a href="12-statistics.html#cb60-3"></a>  var_mean &lt;-<span class="st"> </span>data <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb60-4"><a href="12-statistics.html#cb60-4"></a><span class="st">            </span><span class="kw">mutate</span>(<span class="dt">COM =</span> <span class="kw">substr</span>(IRIS,<span class="dv">1</span>,<span class="dv">5</span>)) <span class="op">%&gt;%</span></span>
<span id="cb60-5"><a href="12-statistics.html#cb60-5"></a><span class="st">            </span><span class="kw">filter</span>(LPRM_<span class="dv">1</span> <span class="op">%in%</span><span class="st"> </span>list_mod <span class="op">&amp;</span><span class="st"> </span>COM <span class="op">==</span><span class="st"> </span>codecom) <span class="op">%&gt;%</span></span>
<span id="cb60-6"><a href="12-statistics.html#cb60-6"></a><span class="st">            </span><span class="kw">group_by</span>(...) <span class="op">%&gt;%</span></span>
<span id="cb60-7"><a href="12-statistics.html#cb60-7"></a><span class="st">            </span><span class="kw">summarise</span>({{ nom_var }} =<span class="st"> </span><span class="kw">weighted.mean</span>({{ var }}, IPONDI, <span class="dt">na.rm=</span>T))</span>
<span id="cb60-8"><a href="12-statistics.html#cb60-8"></a>  </span>
<span id="cb60-9"><a href="12-statistics.html#cb60-9"></a>  <span class="kw">return</span>(var_mean)</span>
<span id="cb60-10"><a href="12-statistics.html#cb60-10"></a>}</span></code></pre></div>
<p>Mais si vous exécutez ce code, cela devrait vous mettre un message d’erreur en rouge : “<em>Erreur : ‘=’ inattendu(e) in: "group_by(…) %&gt;% summarise({{ nom }} ="</em>”.
Et oui, ça ne fonctionne pas car la fonction <code>summarise()</code> ne comprend pas le paramètre “nom_var”, il faut en fait mettre avant <code>weighted.mean()</code> un <strong>:=</strong> et non un simple <strong>=</strong> !</p>
<div class="sourceCode" id="cb61"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb61-1"><a href="12-statistics.html#cb61-1"></a>mean_var &lt;-<span class="st"> </span><span class="cf">function</span>(data, codecom,list_mod, var, ..., nom_var)</span>
<span id="cb61-2"><a href="12-statistics.html#cb61-2"></a>{</span>
<span id="cb61-3"><a href="12-statistics.html#cb61-3"></a>  var_mean &lt;-<span class="st"> </span>data <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb61-4"><a href="12-statistics.html#cb61-4"></a><span class="st">            </span><span class="kw">mutate</span>(<span class="dt">COM =</span> <span class="kw">substr</span>(IRIS,<span class="dv">1</span>,<span class="dv">5</span>)) <span class="op">%&gt;%</span></span>
<span id="cb61-5"><a href="12-statistics.html#cb61-5"></a><span class="st">            </span><span class="kw">filter</span>(LPRM_<span class="dv">1</span> <span class="op">%in%</span><span class="st"> </span>list_mod <span class="op">&amp;</span><span class="st"> </span>COM <span class="op">==</span><span class="st"> </span>codecom) <span class="op">%&gt;%</span></span>
<span id="cb61-6"><a href="12-statistics.html#cb61-6"></a><span class="st">            </span><span class="kw">group_by</span>(...) <span class="op">%&gt;%</span></span>
<span id="cb61-7"><a href="12-statistics.html#cb61-7"></a><span class="st">            </span><span class="kw">summarise</span>({{ nom_var }} <span class="op">:</span><span class="er">=</span><span class="st"> </span><span class="kw">weighted.mean</span>({{ var }}, IPONDI, <span class="dt">na.rm=</span>T))</span>
<span id="cb61-8"><a href="12-statistics.html#cb61-8"></a>  </span>
<span id="cb61-9"><a href="12-statistics.html#cb61-9"></a>  <span class="kw">return</span>(var_mean)</span>
<span id="cb61-10"><a href="12-statistics.html#cb61-10"></a>}</span></code></pre></div>
<p>On la teste :</p>
<div class="sourceCode" id="cb62"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb62-1"><a href="12-statistics.html#cb62-1"></a><span class="co"># Nombre moyen de pièces par logement, pour notre commune de référence Sucy-en-Brie</span></span>
<span id="cb62-2"><a href="12-statistics.html#cb62-2"></a>RP <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb62-3"><a href="12-statistics.html#cb62-3"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">Np_pieces=</span><span class="kw">as.numeric</span>(<span class="kw">as.character</span>(NBPI), <span class="dt">na.rm=</span><span class="ot">TRUE</span>),</span>
<span id="cb62-4"><a href="12-statistics.html#cb62-4"></a>         <span class="dt">LPRM_1 =</span> <span class="kw">case_when</span>(LPRM <span class="op">==</span><span class="st"> &quot;1&quot;</span> <span class="op">~</span><span class="st"> &quot;1&quot;</span>, <span class="ot">TRUE</span> <span class="op">~</span><span class="st"> &quot;0&quot;</span>)) <span class="op">%&gt;%</span></span>
<span id="cb62-5"><a href="12-statistics.html#cb62-5"></a><span class="st">  </span><span class="kw">mean_var</span>(<span class="dt">codecom =</span><span class="st">&quot;94071&quot;</span>, <span class="dt">list_mod=</span><span class="kw">c</span>(<span class="st">&quot;1&quot;</span>), <span class="dt">var=</span>Np_pieces, <span class="dt">nom_var=</span>Nbmoy_pieces)</span></code></pre></div>
<pre><code># A tibble: 1 x 1
  Nbmoy_pieces
         &lt;dbl&gt;
1         4.09</code></pre>
<div class="sourceCode" id="cb64"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb64-1"><a href="12-statistics.html#cb64-1"></a><span class="co"># Nombre moyen de pièces par logement selon l&#39;ancienneté d&#39;emménagement du ménage, toujours pour notre commune de référence Sucy-en-Brie</span></span>
<span id="cb64-2"><a href="12-statistics.html#cb64-2"></a>RP <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb64-3"><a href="12-statistics.html#cb64-3"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">Anciennete=</span><span class="kw">case_when</span>(ANEMR<span class="op">==</span><span class="st">&quot;00&quot;</span> <span class="op">~</span><span class="st"> &quot;Depuis moins de 2 ans&quot;</span>, ANEMR<span class="op">==</span><span class="st">&quot;01&quot;</span> <span class="op">~</span><span class="st"> &quot;De 2 à 4 ans&quot;</span>,</span>
<span id="cb64-4"><a href="12-statistics.html#cb64-4"></a>                              ANEMR<span class="op">==</span><span class="st">&quot;02&quot;</span> <span class="op">~</span><span class="st"> &quot;De 5 à 9 ans&quot;</span>, <span class="kw">as.numeric</span>(ANEMR)<span class="op">&gt;</span><span class="dv">3</span> <span class="op">~</span><span class="st"> &quot;10 ans ou plus&quot;</span>),</span>
<span id="cb64-5"><a href="12-statistics.html#cb64-5"></a>         <span class="dt">Anciennete =</span> <span class="kw">factor</span>(Anciennete, </span>
<span id="cb64-6"><a href="12-statistics.html#cb64-6"></a>                             <span class="dt">levels=</span><span class="kw">c</span>(<span class="st">&quot;Depuis moins de 2 ans&quot;</span>,<span class="st">&quot;De 2 à 4 ans&quot;</span>,<span class="st">&quot;De 5 à 9 ans&quot;</span>,</span>
<span id="cb64-7"><a href="12-statistics.html#cb64-7"></a>                                      <span class="st">&quot;10 ans ou plus&quot;</span>)),</span>
<span id="cb64-8"><a href="12-statistics.html#cb64-8"></a>         <span class="dt">Np_pieces=</span><span class="kw">as.numeric</span>(<span class="kw">as.character</span>(NBPI), <span class="dt">na.rm=</span><span class="ot">TRUE</span>),</span>
<span id="cb64-9"><a href="12-statistics.html#cb64-9"></a>         <span class="dt">LPRM_1 =</span> <span class="kw">case_when</span>(LPRM <span class="op">==</span><span class="st"> &quot;1&quot;</span> <span class="op">~</span><span class="st"> &quot;1&quot;</span>, <span class="ot">TRUE</span> <span class="op">~</span><span class="st"> &quot;0&quot;</span>)) <span class="op">%&gt;%</span></span>
<span id="cb64-10"><a href="12-statistics.html#cb64-10"></a><span class="st">  </span><span class="kw">mean_var</span>(<span class="dt">codecom =</span><span class="st">&quot;94071&quot;</span>, <span class="dt">list_mod=</span><span class="kw">c</span>(<span class="st">&quot;1&quot;</span>), <span class="dt">var=</span>Np_pieces, Anciennete, <span class="dt">nom_var=</span>Nbmoy_pieces_anc)</span></code></pre></div>
<pre><code>`summarise()` ungrouping output (override with `.groups` argument)</code></pre>
<pre><code># A tibble: 4 x 2
  Anciennete            Nbmoy_pieces_anc
  &lt;fct&gt;                            &lt;dbl&gt;
1 Depuis moins de 2 ans             3.27
2 De 2 à 4 ans                      3.40
3 De 5 à 9 ans                      3.92
4 10 ans ou plus                    4.45</code></pre>
<p>On peut également faire une fonction pour avoir une somme et non une moyenne, cela nous servira pour notre analyse de clustering (prochaine séance).</p>
<div class="sourceCode" id="cb67"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb67-1"><a href="12-statistics.html#cb67-1"></a>sum_var &lt;-<span class="st"> </span><span class="cf">function</span>(data, codecom,list_mod, ..., nom_var)</span>
<span id="cb67-2"><a href="12-statistics.html#cb67-2"></a>{</span>
<span id="cb67-3"><a href="12-statistics.html#cb67-3"></a>  var_sum &lt;-<span class="st"> </span>data <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb67-4"><a href="12-statistics.html#cb67-4"></a><span class="st">              </span><span class="kw">mutate</span>(<span class="dt">COM =</span> <span class="kw">substr</span>(IRIS,<span class="dv">1</span>,<span class="dv">5</span>)) <span class="op">%&gt;%</span></span>
<span id="cb67-5"><a href="12-statistics.html#cb67-5"></a><span class="st">              </span><span class="kw">filter</span>(LPRM_<span class="dv">1</span> <span class="op">%in%</span><span class="st"> </span>list_mod <span class="op">&amp;</span><span class="st"> </span>COM <span class="op">==</span><span class="st"> </span>codecom) <span class="op">%&gt;%</span></span>
<span id="cb67-6"><a href="12-statistics.html#cb67-6"></a><span class="st">              </span><span class="kw">group_by</span>(...) <span class="op">%&gt;%</span></span>
<span id="cb67-7"><a href="12-statistics.html#cb67-7"></a><span class="st">              </span><span class="kw">summarise</span>({{ nom_var }} <span class="op">:</span><span class="er">=</span><span class="st"> </span><span class="kw">sum</span>(IPONDI))</span>
<span id="cb67-8"><a href="12-statistics.html#cb67-8"></a>  </span>
<span id="cb67-9"><a href="12-statistics.html#cb67-9"></a>  <span class="kw">return</span>(var_sum)</span>
<span id="cb67-10"><a href="12-statistics.html#cb67-10"></a>}</span>
<span id="cb67-11"><a href="12-statistics.html#cb67-11"></a></span>
<span id="cb67-12"><a href="12-statistics.html#cb67-12"></a>RP <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">mutate</span>(<span class="dt">LPRM_1 =</span> <span class="kw">case_when</span>(LPRM <span class="op">==</span><span class="st"> &quot;1&quot;</span> <span class="op">~</span><span class="st"> &quot;1&quot;</span>, <span class="ot">TRUE</span> <span class="op">~</span><span class="st"> &quot;0&quot;</span>)) <span class="op">%&gt;%</span></span>
<span id="cb67-13"><a href="12-statistics.html#cb67-13"></a><span class="st">  </span><span class="kw">sum_var</span>(<span class="dt">codecom =</span> <span class="st">&quot;94071&quot;</span>,<span class="dt">list_mod =</span> <span class="kw">c</span>(<span class="st">&quot;0&quot;</span>,<span class="st">&quot;1&quot;</span>), IRIS, <span class="dt">nom_var =</span> nbhab)</span></code></pre></div>
<pre><code>`summarise()` ungrouping output (override with `.groups` argument)</code></pre>
<pre><code># A tibble: 11 x 2
   IRIS      nbhab
   &lt;fct&gt;     &lt;dbl&gt;
 1 940710101 2151.
 2 940710102 2204.
 3 940710103 2843.
 4 940710104 2631.
 5 940710105 3006.
 6 940710106 2368.
 7 940710107 2545.
 8 940710108 2853.
 9 940710109 2528.
10 940710110 1525.
11 940710111 1825.</code></pre>
</div>
<div id="enregistrerstocker-ses-fonctions" class="section level3" number="2.4.5">
<h3><span class="header-section-number">2.4.5</span> Enregistrer/Stocker ses fonctions</h3>
<p>Pour cela, il faut copier le seul code de la fonction ou des fonctions écrites et le(s) mettre dans un script (il faut bien les mettre l’une après l’autre si vous souhaitez en sauvegarder plusieurs dans un même fichier), puis enregistrer ce script. Vous pouvez pour cela créer un nouveau dossier dans votre projet et le nommer “Fonctions”.</p>
<p>Ensuite, pour l’appeler il faudra faire appel à la fonction <code>source()</code>. Vous pouvez le mettre en 1ère commande dans un nouveau script.</p>
<div class="sourceCode" id="cb70"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb70-1"><a href="12-statistics.html#cb70-1"></a><span class="co">#si j&#39;ai enregistré mes 5 fonctions intitulé dans ce script `tab_var`, `graph_baton1`, `graph_baton3`, `mean_var` et `sum_var` dans un fichier/script &quot;mes_fonctions&quot; dans le dossier &quot;Fonctions&quot; de mon projet, alors je l&#39;appelerai ainsi au début d&#39;un nouveau script si je veux les réutiliser :</span></span>
<span id="cb70-2"><a href="12-statistics.html#cb70-2"></a><span class="kw">source</span>(<span class="st">&quot;fonctions/mes_fonctions.R&quot;</span>)</span></code></pre></div>

</div>
</div>
</div>
<script src="js/tidyverse.js"></script>
            </section>

          </div>
        </div>
      </div>
<a href="11-data.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="21-cartography_V2.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": false,
"twitter": false,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"],
"instapper": false
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/ClaudeGrasland/DataMiningProject2021/blob/master/12-statistics.Rmd",
"text": "Source"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "section"
}
});
});
</script>

</body>

</html>
