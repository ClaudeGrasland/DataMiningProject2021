<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapitre 3 Analyse cartographique I (C.G.) | Projet DATA MINING 2021</title>
  <meta name="description" content="Titre du cours" />
  <meta name="generator" content="bookdown 0.21 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapitre 3 Analyse cartographique I (C.G.) | Projet DATA MINING 2021" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="Titre du cours" />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapitre 3 Analyse cartographique I (C.G.) | Projet DATA MINING 2021" />
  
  <meta name="twitter:description" content="Titre du cours" />
  

<meta name="author" content="C. Grasland et C. Signoretto" />


<meta name="date" content="2021-03-31" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="12-statistics.html"/>

<script src="libs/header-attrs-2.6/header-attrs.js"></script>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<script src="libs/accessible-code-block-0.0.1/empty-anchor.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    background-color: #ffffff;
    color: #a0a0a0;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #a0a0a0;  padding-left: 4px; }
div.sourceCode
  { color: #1f1c1b; background-color: #ffffff; }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span. { color: #1f1c1b; } /* Normal */
code span.al { color: #bf0303; background-color: #f7e6e6; font-weight: bold; } /* Alert */
code span.an { color: #ca60ca; } /* Annotation */
code span.at { color: #0057ae; } /* Attribute */
code span.bn { color: #b08000; } /* BaseN */
code span.bu { color: #644a9b; font-weight: bold; } /* BuiltIn */
code span.cf { color: #1f1c1b; font-weight: bold; } /* ControlFlow */
code span.ch { color: #924c9d; } /* Char */
code span.cn { color: #aa5500; } /* Constant */
code span.co { color: #898887; } /* Comment */
code span.cv { color: #0095ff; } /* CommentVar */
code span.do { color: #607880; } /* Documentation */
code span.dt { color: #0057ae; } /* DataType */
code span.dv { color: #b08000; } /* DecVal */
code span.er { color: #bf0303; text-decoration: underline; } /* Error */
code span.ex { color: #0095ff; font-weight: bold; } /* Extension */
code span.fl { color: #b08000; } /* Float */
code span.fu { color: #644a9b; } /* Function */
code span.im { color: #ff5500; } /* Import */
code span.in { color: #b08000; } /* Information */
code span.kw { color: #1f1c1b; font-weight: bold; } /* Keyword */
code span.op { color: #1f1c1b; } /* Operator */
code span.ot { color: #006e28; } /* Other */
code span.pp { color: #006e28; } /* Preprocessor */
code span.re { color: #0057ae; background-color: #e0e9f8; } /* RegionMarker */
code span.sc { color: #3daee9; } /* SpecialChar */
code span.ss { color: #ff5500; } /* SpecialString */
code span.st { color: #bf0303; } /* String */
code span.va { color: #0057ae; } /* Variable */
code span.vs { color: #bf0303; } /* VerbatimString */
code span.wa { color: #bf0303; } /* Warning */
</style>

<link rel="stylesheet" href="css/tidyverse.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./index.html">Data Mining 2021  <em>C. Grasland  & C.Signoretto</em></a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="00-presentation.html"><a href="00-presentation.html"><i class="fa fa-check"></i>Présentation</a>
<ul>
<li class="chapter" data-level="" data-path="00-presentation.html"><a href="00-presentation.html#à-propos-de-ce-document"><i class="fa fa-check"></i>À propos de ce document</a></li>
<li class="chapter" data-level="" data-path="00-presentation.html"><a href="00-presentation.html#prérequis"><i class="fa fa-check"></i>Prérequis</a></li>
<li class="chapter" data-level="" data-path="00-presentation.html"><a href="00-presentation.html#remerciements"><i class="fa fa-check"></i>Remerciements</a></li>
<li class="chapter" data-level="" data-path="00-presentation.html"><a href="00-presentation.html#licence"><i class="fa fa-check"></i>Licence</a></li>
</ul></li>
<li class="chapter" data-level="1" data-path="11-data.html"><a href="11-data.html"><i class="fa fa-check"></i><b>1</b> Données</a>
<ul>
<li class="chapter" data-level="1.1" data-path="11-data.html"><a href="11-data.html#introduction"><i class="fa fa-check"></i><b>1.1</b> Introduction</a></li>
<li class="chapter" data-level="1.2" data-path="11-data.html"><a href="11-data.html#données-statistiques-sur-les-individus"><i class="fa fa-check"></i><b>1.2</b> Données statistiques sur les individus</a>
<ul>
<li class="chapter" data-level="1.2.1" data-path="11-data.html"><a href="11-data.html#etape-1-téléchargement-des-données-et-stockage-temporaire"><i class="fa fa-check"></i><b>1.2.1</b> Etape 1 : téléchargement des données et stockage temporaire</a></li>
<li class="chapter" data-level="1.2.2" data-path="11-data.html"><a href="11-data.html#etape-2-transformation-des-données-au-format-r"><i class="fa fa-check"></i><b>1.2.2</b> Etape 2 : Transformation des données au format R</a></li>
<li class="chapter" data-level="1.2.3" data-path="11-data.html"><a href="11-data.html#etape-3-sélection-des-données-utiles-et-sauvegarde-au-format-.rdata"><i class="fa fa-check"></i><b>1.2.3</b> Etape 3 : Sélection des données utiles et sauvegarde au format .Rdata</a></li>
</ul></li>
<li class="chapter" data-level="1.3" data-path="11-data.html"><a href="11-data.html#données-statistiques-sur-les-logements-ordinaires"><i class="fa fa-check"></i><b>1.3</b> Données statistiques sur les logements ordinaires</a>
<ul>
<li class="chapter" data-level="1.3.1" data-path="11-data.html"><a href="11-data.html#etape-1-récupération-des-fichiers"><i class="fa fa-check"></i><b>1.3.1</b> Etape 1 : récupération des fichiers</a></li>
<li class="chapter" data-level="1.3.2" data-path="11-data.html"><a href="11-data.html#etape-2-transformation-des-données-au-format-r-1"><i class="fa fa-check"></i><b>1.3.2</b> Etape 2 : Transformation des données au format R</a></li>
<li class="chapter" data-level="1.3.3" data-path="11-data.html"><a href="11-data.html#etape-3-sélection-des-données-utiles-et-sauvegarde-au-format-.rdata-1"><i class="fa fa-check"></i><b>1.3.3</b> Etape 3 : Sélection des données utiles et sauvegarde au format .Rdata</a></li>
</ul></li>
<li class="chapter" data-level="1.4" data-path="11-data.html"><a href="11-data.html#données-géométriques"><i class="fa fa-check"></i><b>1.4</b> Données géométriques</a>
<ul>
<li class="chapter" data-level="1.4.1" data-path="11-data.html"><a href="11-data.html#etape-1-récupération-du-fonds-iris-au-format-shapefile"><i class="fa fa-check"></i><b>1.4.1</b> Etape 1 : récupération du fonds IRIS au format shapefile</a></li>
<li class="chapter" data-level="1.4.2" data-path="11-data.html"><a href="11-data.html#etape-2-importation-et-transformation-au-format-sf"><i class="fa fa-check"></i><b>1.4.2</b> Etape 2 : Importation et transformation au format sf</a></li>
<li class="chapter" data-level="1.4.3" data-path="11-data.html"><a href="11-data.html#etape-3-extraction-des-iris-de-la-zone-détude"><i class="fa fa-check"></i><b>1.4.3</b> Etape 3 : Extraction des IRIS de la zone d’étude</a></li>
<li class="chapter" data-level="1.4.4" data-path="11-data.html"><a href="11-data.html#etape-4-création-dun-fonds-de-carte-des-communes"><i class="fa fa-check"></i><b>1.4.4</b> Etape 4 : création d’un fonds de carte des communes</a></li>
<li class="chapter" data-level="1.4.5" data-path="11-data.html"><a href="11-data.html#etape-5-création-dun-fonds-de-carte-par-département"><i class="fa fa-check"></i><b>1.4.5</b> Etape 5 : création d’un fonds de carte par département</a></li>
<li class="chapter" data-level="1.4.6" data-path="11-data.html"><a href="11-data.html#etape-6-superposition-des-trois-fonds-de-carte"><i class="fa fa-check"></i><b>1.4.6</b> Etape 6: Superposition des trois fonds de carte</a></li>
</ul></li>
<li class="chapter" data-level="1.5" data-path="11-data.html"><a href="11-data.html#bilan-et-nettoyage"><i class="fa fa-check"></i><b>1.5</b> Bilan et nettoyage</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="12-statistics.html"><a href="12-statistics.html"><i class="fa fa-check"></i><b>2</b> Analyse statistique I (C.S.)</a>
<ul>
<li class="chapter" data-level="2.1" data-path="12-statistics.html"><a href="12-statistics.html#introduction-1"><i class="fa fa-check"></i><b>2.1</b> Introduction</a>
<ul>
<li class="chapter" data-level="2.1.1" data-path="12-statistics.html"><a href="12-statistics.html#les-données-du-recensement-de-la-population-rp"><i class="fa fa-check"></i><b>2.1.1</b> Les données du Recensement de la Population (RP)</a></li>
<li class="chapter" data-level="2.1.2" data-path="12-statistics.html"><a href="12-statistics.html#quelles-variables-sont-présentes-dans-les-données-quelle-spécificité"><i class="fa fa-check"></i><b>2.1.2</b> Quelles variables sont présentes dans les données ? Quelle spécificité ?</a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="12-statistics.html"><a href="12-statistics.html#quelques-statistiques-sur-les-logements-et-ménages"><i class="fa fa-check"></i><b>2.2</b> Quelques statistiques sur les logements et ménages</a></li>
<li class="chapter" data-level="2.3" data-path="12-statistics.html"><a href="12-statistics.html#quelles-caractéristiques-des-individus-résidant-dans-le-val-de-marne-en-2017"><i class="fa fa-check"></i><b>2.3</b> Quelles caractéristiques des individus résidant dans le Val de Marne en 2017 ?</a></li>
<li class="chapter" data-level="2.4" data-path="12-statistics.html"><a href="12-statistics.html#la-création-de-fonctions"><i class="fa fa-check"></i><b>2.4</b> La création de fonctions</a>
<ul>
<li class="chapter" data-level="2.4.1" data-path="12-statistics.html"><a href="12-statistics.html#création-dune-fonction-pour-retourner-un-tableau"><i class="fa fa-check"></i><b>2.4.1</b> Création d’une fonction pour retourner un tableau</a></li>
<li class="chapter" data-level="2.4.2" data-path="12-statistics.html"><a href="12-statistics.html#création-dune-fonction-pour-retourner-un-graphique"><i class="fa fa-check"></i><b>2.4.2</b> Création d’une fonction pour retourner un graphique</a></li>
<li class="chapter" data-level="2.4.3" data-path="12-statistics.html"><a href="12-statistics.html#création-dune-seule-fonction-comprenant-tableau-et-graphe"><i class="fa fa-check"></i><b>2.4.3</b> Création d’une seule fonction comprenant tableau et graphe</a></li>
<li class="chapter" data-level="2.4.4" data-path="12-statistics.html"><a href="12-statistics.html#et-pour-distinguer-par-groupe-et-pour-avoir-des-moyennes"><i class="fa fa-check"></i><b>2.4.4</b> Et pour distinguer par groupe ? Et pour avoir des moyennes… ?</a></li>
<li class="chapter" data-level="2.4.5" data-path="12-statistics.html"><a href="12-statistics.html#enregistrerstocker-ses-fonctions"><i class="fa fa-check"></i><b>2.4.5</b> Enregistrer/Stocker ses fonctions</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="21-cartography.html"><a href="21-cartography.html"><i class="fa fa-check"></i><b>3</b> Analyse cartographique I (C.G.)</a>
<ul>
<li class="chapter" data-level="3.1" data-path="21-cartography.html"><a href="21-cartography.html#introduction-2"><i class="fa fa-check"></i><b>3.1</b> Introduction</a>
<ul>
<li class="chapter" data-level="3.1.1" data-path="21-cartography.html"><a href="21-cartography.html#packages-utilisés"><i class="fa fa-check"></i><b>3.1.1</b> Packages utilisés</a></li>
<li class="chapter" data-level="3.1.2" data-path="21-cartography.html"><a href="21-cartography.html#chargement-des-données"><i class="fa fa-check"></i><b>3.1.2</b> Chargement des données</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="21-cartography.html"><a href="21-cartography.html#le-package-cartography"><i class="fa fa-check"></i><b>3.2</b> Le package cartography</a>
<ul>
<li class="chapter" data-level="3.2.1" data-path="21-cartography.html"><a href="21-cartography.html#création-du-tableau-de-contingence"><i class="fa fa-check"></i><b>3.2.1</b> Création du tableau de contingence</a></li>
<li class="chapter" data-level="3.2.2" data-path="21-cartography.html"><a href="21-cartography.html#ajout-dun-tableau-de-pourcentage"><i class="fa fa-check"></i><b>3.2.2</b> Ajout d’un tableau de pourcentage</a></li>
<li class="chapter" data-level="3.2.3" data-path="21-cartography.html"><a href="21-cartography.html#estimation-du-nombre-moyen-dautomobile-par-menages"><i class="fa fa-check"></i><b>3.2.3</b> Estimation du nombre moyen d’automobile par menages</a></li>
<li class="chapter" data-level="3.2.4" data-path="21-cartography.html"><a href="21-cartography.html#analyse-statistique"><i class="fa fa-check"></i><b>3.2.4</b> Analyse statistique</a></li>
<li class="chapter" data-level="3.2.5" data-path="21-cartography.html"><a href="21-cartography.html#sauvegarde-du-tableau-et-jointure-avec-le-fonds-de-carte"><i class="fa fa-check"></i><b>3.2.5</b> Sauvegarde du tableau et jointure avec le fonds de carte</a></li>
<li class="chapter" data-level="3.2.6" data-path="21-cartography.html"><a href="21-cartography.html#carte-de-stock"><i class="fa fa-check"></i><b>3.2.6</b> Carte de stock</a></li>
<li class="chapter" data-level="3.2.7" data-path="21-cartography.html"><a href="21-cartography.html#carte-dintensité-choroplèthe"><i class="fa fa-check"></i><b>3.2.7</b> Carte d’intensité (choroplèthe)</a></li>
<li class="chapter" data-level="3.2.8" data-path="21-cartography.html"><a href="21-cartography.html#carte-de-stock-intensité"><i class="fa fa-check"></i><b>3.2.8</b> Carte de stock + intensité</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="21-cartography.html"><a href="21-cartography.html#création-de-fonctions"><i class="fa fa-check"></i><b>3.3</b> Création de fonctions</a>
<ul>
<li class="chapter" data-level="3.3.1" data-path="21-cartography.html"><a href="21-cartography.html#fonction-tab_cont_iris"><i class="fa fa-check"></i><b>3.3.1</b> fonction tab_cont_iris()</a></li>
<li class="chapter" data-level="3.3.2" data-path="21-cartography.html"><a href="21-cartography.html#fonction-map_count_iris"><i class="fa fa-check"></i><b>3.3.2</b> fonction map_count_iris</a></li>
<li class="chapter" data-level="3.3.3" data-path="21-cartography.html"><a href="21-cartography.html#fonction-map_pct_iris"><i class="fa fa-check"></i><b>3.3.3</b> fonction map_pct_iris</a></li>
<li class="chapter" data-level="3.3.4" data-path="21-cartography.html"><a href="21-cartography.html#sauvegarde-des-fonctions"><i class="fa fa-check"></i><b>3.3.4</b> Sauvegarde des fonctions</a></li>
</ul></li>
</ul></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Projet DATA MINING 2021</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="c21-cartography1" class="section level1" number="3">
<h1><span class="header-section-number">Chapitre 3</span> Analyse cartographique I (C.G.)</h1>
<div id="introduction-2" class="section level2" number="3.1">
<h2><span class="header-section-number">3.1</span> Introduction</h2>
<p>L’objectif de cette section est</p>
<ol style="list-style-type: decimal">
<li>d’apprendre à réaliser des cartographies statiques d’indicateurs relatifs aux unités spatiales à différentes échelles à l’aide du package <code>cartography</code>.</li>
<li>de créer des fonctions permetant d’automatiser la tâche de cartographie à l’échelle des communes</li>
</ol>
<div id="packages-utilisés" class="section level3" number="3.1.1">
<h3><span class="header-section-number">3.1.1</span> Packages utilisés</h3>
<p>Nous allons nous limiter à un nombre limité de packages</p>
<ul>
<li><strong>dplyr</strong> et <strong>tidyr</strong>: pour la manipulation des tableaux et leur agrégation (inutile de charger l’ensemble du package tidyverse)</li>
<li><strong>knitr</strong> : pour afficher proprement les tableaux de résultats</li>
<li><strong>ggplot2</strong> : pour visualiser les résultats sous formes de graphiques</li>
<li><strong>sf</strong> : pour manipuler les données cartographiques et les agréger</li>
<li><strong>cartography</strong> : pour la réalisation de cartes statiques de qualité imprimables aux formats .pdf ou .doc</li>
</ul>
<div class="sourceCode" id="cb114"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb114-1"><a href="21-cartography.html#cb114-1"></a><span class="kw">library</span>(knitr)</span>
<span id="cb114-2"><a href="21-cartography.html#cb114-2"></a><span class="kw">library</span>(tidyr)</span>
<span id="cb114-3"><a href="21-cartography.html#cb114-3"></a><span class="kw">library</span>(dplyr)</span>
<span id="cb114-4"><a href="21-cartography.html#cb114-4"></a><span class="kw">library</span>(ggplot2)</span>
<span id="cb114-5"><a href="21-cartography.html#cb114-5"></a><span class="kw">library</span>(sf)</span>
<span id="cb114-6"><a href="21-cartography.html#cb114-6"></a><span class="kw">library</span>(cartography)</span></code></pre></div>
</div>
<div id="chargement-des-données" class="section level3" number="3.1.2">
<h3><span class="header-section-number">3.1.2</span> Chargement des données</h3>
<p>Nous avons besoin uniquement de trois fichiers</p>
<ul>
<li>Le fichier des individus</li>
<li>le fichier des métadonnées relatives aux individus</li>
<li>le fonds de carte des IRIS</li>
</ul>
<div class="sourceCode" id="cb115"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb115-1"><a href="21-cartography.html#cb115-1"></a>indiv &lt;-<span class="st"> </span><span class="kw">readRDS</span>(<span class="st">&quot;data/indiv2017.Rdata&quot;</span>)</span>
<span id="cb115-2"><a href="21-cartography.html#cb115-2"></a>meta &lt;-<span class="st"> </span><span class="kw">readRDS</span>(<span class="st">&quot;data/indiv2017_meta.Rdata&quot;</span>)</span>
<span id="cb115-3"><a href="21-cartography.html#cb115-3"></a>map &lt;-<span class="kw">readRDS</span>(<span class="st">&quot;data/map_iris.Rdata&quot;</span>)</span></code></pre></div>
</div>
</div>
<div id="le-package-cartography" class="section level2" number="3.2">
<h2><span class="header-section-number">3.2</span> Le package cartography</h2>
<p>Le package <em>cartography</em> permet de réaliser des cartes statiques de très haute qualité. Il a en effet été mis au point par des cartographes et des géomaticiens professionnels. Il propose une gamme de possibilités sans équivalent. On ne verra ici qu’une toute petite partie de ses possibilités.</p>
<p>Nous allons prendre comme exemple l’analyse d’un tableau du <strong>nombre d’automobiles par ménage</strong> en nous limitant aux ménages ordinaires c’est-à-dire en excluant les personnes habitant dans des logements collectifs (pensionnats, prisons, congrégations religieuses, …)</p>
<p>Nous ne conservons que les individus chefs de ménages (<em>LPRM=1</em>) ce qui va logiquement éliminer les individus présents dans les ménages non ordinaires (<em>LPRM=Z</em>) ainsi que tous les membres d’un logement qui ne sont pas chefs de ménages.</p>
<div class="sourceCode" id="cb116"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb116-1"><a href="21-cartography.html#cb116-1"></a>menag&lt;-indiv <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(LPRM<span class="op">==</span><span class="dv">1</span>)</span></code></pre></div>
<div id="création-du-tableau-de-contingence" class="section level3" number="3.2.1">
<h3><span class="header-section-number">3.2.1</span> Création du tableau de contingence</h3>
<p>Nous souhaitons ventiler les ménages en fonction de leur localisation géographique (<em>IRIS</em>) et de leur nombre d’automobile (<em>VOIT</em>) en tenant compte de leur poids (<em>IPONDI</em>) puisque les données sont issues d’uin échantillonage qu’il faut redresser.</p>
<p>Cette opération se réalise très facilement à l’aide du package <strong>dplyr</strong> à l’aide des fonctions <code>group_by</code>, <code>mutate</code> et <code>summarize</code> :</p>
<div class="sourceCode" id="cb117"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb117-1"><a href="21-cartography.html#cb117-1"></a>tab &lt;-<span class="st"> </span>menag <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">group_by</span>(IRIS, VOIT) <span class="op">%&gt;%</span></span>
<span id="cb117-2"><a href="21-cartography.html#cb117-2"></a><span class="st">                 </span><span class="kw">summarise</span>(<span class="dt">nbmen =</span> <span class="kw">sum</span>(IPONDI)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb117-3"><a href="21-cartography.html#cb117-3"></a><span class="st">                 </span><span class="kw">ungroup</span>()</span></code></pre></div>
<pre><code>`summarise()` regrouping output by &#39;IRIS&#39; (override with `.groups` argument)</code></pre>
<div class="sourceCode" id="cb119"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb119-1"><a href="21-cartography.html#cb119-1"></a><span class="kw">str</span>(tab)</span></code></pre></div>
<pre><code>tibble [2,070 × 3] (S3: tbl_df/tbl/data.frame)
 $ IRIS : Factor w/ 4243 levels &quot;751010101&quot;,&quot;751010102&quot;,..: 3300 3300 3300 3300 3301 3301 3301 3301 3302 3302 ...
 $ VOIT : Factor w/ 5 levels &quot;0&quot;,&quot;1&quot;,&quot;2&quot;,&quot;3&quot;,..: 1 2 3 4 1 2 3 4 1 2 ...
 $ nbmen: num [1:2070] 674.1 679.5 142.2 29.5 801.4 ...</code></pre>
<div class="sourceCode" id="cb121"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb121-1"><a href="21-cartography.html#cb121-1"></a><span class="kw">head</span>(tab,<span class="dv">5</span>)</span></code></pre></div>
<pre><code># A tibble: 5 x 3
  IRIS      VOIT  nbmen
  &lt;fct&gt;     &lt;fct&gt; &lt;dbl&gt;
1 940020101 0     674. 
2 940020101 1     679. 
3 940020101 2     142. 
4 940020101 3      29.5
5 940020102 0     801. </code></pre>
<p>Le résultat est un <em>tibble</em> au format “long” qui comporte 4 lignes différentes pour chaque IRIS, correspondant aux nombres de ménages ayant respectivement 0, 1, 2 et 3 voitures ou plus.</p>
<p>Nous allons transformer ce tableau en format “large” pour placer côte à côte les différentes modalités du nombre de voitures. Pour cela il faut utiliser la fonction <code>pivot_wider</code>du package <strong>tidyr</strong>.</p>
<div class="sourceCode" id="cb123"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb123-1"><a href="21-cartography.html#cb123-1"></a><span class="kw">library</span>(tidyr)</span>
<span id="cb123-2"><a href="21-cartography.html#cb123-2"></a>tabcont &lt;-<span class="st"> </span>tab <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">pivot_wider</span>(<span class="dt">names_from =</span> VOIT, </span>
<span id="cb123-3"><a href="21-cartography.html#cb123-3"></a>                           <span class="dt">values_from =</span> nbmen,</span>
<span id="cb123-4"><a href="21-cartography.html#cb123-4"></a>                           <span class="dt">names_prefix =</span> <span class="st">&quot;MEN_VOIT&quot;</span>,</span>
<span id="cb123-5"><a href="21-cartography.html#cb123-5"></a>                           <span class="dt">values_fill =</span> <span class="dv">0</span>)</span>
<span id="cb123-6"><a href="21-cartography.html#cb123-6"></a></span>
<span id="cb123-7"><a href="21-cartography.html#cb123-7"></a><span class="kw">head</span>(tabcont)</span></code></pre></div>
<pre><code># A tibble: 6 x 5
  IRIS      MEN_VOIT0 MEN_VOIT1 MEN_VOIT2 MEN_VOIT3
  &lt;fct&gt;         &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;
1 940020101      674.      679.     142.       29.5
2 940020102      801.      903.     170.       24.8
3 940020103      661.      703.      76.0      10.6
4 940020104      694.      701.     126.       23.0
5 940020105      434.      960.     237.       29.3
6 940020106      625.      735.     166.       29.2</code></pre>
<p>Grâce à cette transformation, nous disposons maintenant pour chaque IRIS de la distribution des ménages en fonction de leur nombre de voitures, ce qui constitue le <strong>tableau de contingence</strong> recherché.</p>
</div>
<div id="ajout-dun-tableau-de-pourcentage" class="section level3" number="3.2.2">
<h3><span class="header-section-number">3.2.2</span> Ajout d’un tableau de pourcentage</h3>
<p>Nous allons maintenant calculer le nombre total de ménage puis en déduire la proportion de ménages en fonction de leur nombre d’automobile pour chacun des IRIS.</p>
<div class="sourceCode" id="cb125"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb125-1"><a href="21-cartography.html#cb125-1"></a>tabdon &lt;-<span class="st"> </span>tabcont <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">mutate</span> (<span class="dt">MEN_TOTAL =</span> MEN_VOIT0<span class="op">+</span>MEN_VOIT1<span class="op">+</span>MEN_VOIT2<span class="op">+</span>MEN_VOIT3,</span>
<span id="cb125-2"><a href="21-cartography.html#cb125-2"></a>                              <span class="dt">PCT_VOIT0 =</span> <span class="dv">100</span><span class="op">*</span><span class="st"> </span>MEN_VOIT0 <span class="op">/</span><span class="st"> </span>MEN_TOTAL,</span>
<span id="cb125-3"><a href="21-cartography.html#cb125-3"></a>                              <span class="dt">PCT_VOIT1 =</span> <span class="dv">100</span><span class="op">*</span><span class="st"> </span>MEN_VOIT1 <span class="op">/</span><span class="st"> </span>MEN_TOTAL,</span>
<span id="cb125-4"><a href="21-cartography.html#cb125-4"></a>                              <span class="dt">PCT_VOIT2 =</span> <span class="dv">100</span><span class="op">*</span><span class="st"> </span>MEN_VOIT2 <span class="op">/</span><span class="st"> </span>MEN_TOTAL,</span>
<span id="cb125-5"><a href="21-cartography.html#cb125-5"></a>                              <span class="dt">PCT_VOIT3 =</span> <span class="dv">100</span><span class="op">*</span><span class="st"> </span>MEN_VOIT3 <span class="op">/</span><span class="st"> </span>MEN_TOTAL)</span>
<span id="cb125-6"><a href="21-cartography.html#cb125-6"></a>                              </span>
<span id="cb125-7"><a href="21-cartography.html#cb125-7"></a><span class="kw">head</span>(tabdon[,<span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">6</span><span class="op">:</span><span class="dv">10</span>)])                              </span></code></pre></div>
<pre><code># A tibble: 6 x 6
  IRIS      MEN_TOTAL PCT_VOIT0 PCT_VOIT1 PCT_VOIT2 PCT_VOIT3
  &lt;fct&gt;         &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;
1 940020101     1525.      44.2      44.5      9.32     1.93 
2 940020102     1899.      42.2      47.6      8.93     1.31 
3 940020103     1450.      45.6      48.5      5.24     0.729
4 940020104     1544.      45.0      45.4      8.14     1.49 
5 940020105     1660.      26.1      57.8     14.3      1.76 
6 940020106     1555.      40.2      47.3     10.7      1.87 </code></pre>
</div>
<div id="estimation-du-nombre-moyen-dautomobile-par-menages" class="section level3" number="3.2.3">
<h3><span class="header-section-number">3.2.3</span> Estimation du nombre moyen d’automobile par menages</h3>
<p>Il n’est pas possible d’estimer le nombre exact d’automobile par ménage car l’INSEE ne détaille pas la catégorie VOIT = 3 qui correspond à <em>“Trois automobiles ou +”</em>. On peut néanmoins procéder à une estimation minimale du nombre d’automobile en supposant que les ménages de ce type ont exactement rois automobiles. On en déduit alors le nombre total d’automobile par IRIS (VOIT_TOTAL) et le nombre moyen d’automobile par ménage (VOIT_MEN).</p>
<div class="sourceCode" id="cb127"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb127-1"><a href="21-cartography.html#cb127-1"></a>tabdon &lt;-tabdon <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">mutate</span>(<span class="dt">VOIT_TOTAL =</span> MEN_VOIT1 <span class="op">+</span><span class="st"> </span><span class="dv">2</span><span class="op">*</span>MEN_VOIT2 <span class="op">+</span><span class="st"> </span><span class="dv">3</span><span class="op">*</span>MEN_VOIT3,</span>
<span id="cb127-2"><a href="21-cartography.html#cb127-2"></a>                           <span class="dt">VOIT_MEN =</span> VOIT_TOTAL <span class="op">/</span><span class="st"> </span>MEN_TOTAL)</span>
<span id="cb127-3"><a href="21-cartography.html#cb127-3"></a><span class="kw">head</span>(tabdon[,<span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">6</span>,<span class="dv">11</span>,<span class="dv">12</span>)])</span></code></pre></div>
<pre><code># A tibble: 6 x 4
  IRIS      MEN_TOTAL VOIT_TOTAL VOIT_MEN
  &lt;fct&gt;         &lt;dbl&gt;      &lt;dbl&gt;    &lt;dbl&gt;
1 940020101     1525.      1052.    0.690
2 940020102     1899.      1317.    0.694
3 940020103     1450.       886.    0.611
4 940020104     1544.      1021.    0.662
5 940020105     1660.      1522.    0.917
6 940020106     1555.      1154.    0.742</code></pre>
</div>
<div id="analyse-statistique" class="section level3" number="3.2.4">
<h3><span class="header-section-number">3.2.4</span> Analyse statistique</h3>
<p>Avant de passer à la cartographie, on peut analyser quelques variables intéressantes.</p>
<div id="part-des-ménages-sans-automobiles" class="section level4" number="3.2.4.1">
<h4><span class="header-section-number">3.2.4.1</span> Part des ménages sans automobiles</h4>
<p>Les ménages sans automobiles sont une catégorie intéressante, même si elle peut recouper des situations très diverses (étudiants, personnes âgées, pauvres, …).</p>
<div class="sourceCode" id="cb129"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb129-1"><a href="21-cartography.html#cb129-1"></a><span class="kw">summary</span>(tabdon<span class="op">$</span>PCT_VOIT0)</span></code></pre></div>
<pre><code>   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
   0.00   21.94   30.95   31.13   40.84   65.31 </code></pre>
<div class="sourceCode" id="cb131"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb131-1"><a href="21-cartography.html#cb131-1"></a><span class="kw">ggplot</span>(tabdon, <span class="kw">aes</span>(<span class="dt">x=</span>PCT_VOIT0)) <span class="op">+</span><span class="st"> </span></span>
<span id="cb131-2"><a href="21-cartography.html#cb131-2"></a><span class="st">       </span><span class="kw">geom_histogram</span>(<span class="dt">bins=</span><span class="dv">20</span>, <span class="dt">fill=</span><span class="st">&quot;gray30&quot;</span>) <span class="op">+</span></span>
<span id="cb131-3"><a href="21-cartography.html#cb131-3"></a><span class="st">       </span><span class="kw">scale_y_continuous</span>(<span class="st">&quot;Nombre d&#39;IRIS&quot;</span>)<span class="op">+</span></span>
<span id="cb131-4"><a href="21-cartography.html#cb131-4"></a><span class="st">       </span><span class="kw">scale_x_continuous</span>(<span class="st">&quot;% de ménages&quot;</span>)<span class="op">+</span></span>
<span id="cb131-5"><a href="21-cartography.html#cb131-5"></a><span class="st">       </span><span class="kw">ggtitle</span>(<span class="st">&quot;Par des ménages sans automobiles en 2017&quot;</span>)</span></code></pre></div>
<p><img src="Projet-Data-Mining-2021_files/figure-html/unnamed-chunk-75-1.svg" width="672" /></p>
<p>La distribution apparaît très variable puisque les ménages sans automobiles sont absents de certains IRIS alors qu’ils représentent plus de la moitié des ménages dans d’autres IRIS.</p>
</div>
<div id="nombre-moyen-dautomobiles-par-ménage" class="section level4" number="3.2.4.2">
<h4><span class="header-section-number">3.2.4.2</span> Nombre moyen d’automobiles par ménage</h4>
<p>Même s’il est légèrement sous-estimé, le nombre d’automobile par ménage est un bon indicateur de la dépendance de certains logements mals desservis par les transports en commun.</p>
<div class="sourceCode" id="cb132"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb132-1"><a href="21-cartography.html#cb132-1"></a><span class="kw">summary</span>(tabdon<span class="op">$</span>VOIT_MEN)</span></code></pre></div>
<pre><code>   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
 0.3944  0.7190  0.8675  0.9003  1.0458  2.0000 </code></pre>
<div class="sourceCode" id="cb134"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb134-1"><a href="21-cartography.html#cb134-1"></a><span class="kw">ggplot</span>(tabdon, <span class="kw">aes</span>(<span class="dt">x=</span>VOIT_MEN)) <span class="op">+</span><span class="st"> </span></span>
<span id="cb134-2"><a href="21-cartography.html#cb134-2"></a><span class="st">       </span><span class="kw">geom_histogram</span>(<span class="dt">bins=</span><span class="dv">20</span>, <span class="dt">fill=</span><span class="st">&quot;gray30&quot;</span>) <span class="op">+</span></span>
<span id="cb134-3"><a href="21-cartography.html#cb134-3"></a><span class="st">       </span><span class="kw">scale_y_continuous</span>(<span class="st">&quot;Nombre d&#39;IRIS&quot;</span>)<span class="op">+</span></span>
<span id="cb134-4"><a href="21-cartography.html#cb134-4"></a><span class="st">       </span><span class="kw">scale_x_continuous</span>(<span class="st">&quot;voitures / ménage&quot;</span>)<span class="op">+</span></span>
<span id="cb134-5"><a href="21-cartography.html#cb134-5"></a><span class="st">       </span><span class="kw">ggtitle</span>(<span class="st">&quot;Nombre moyen d&#39;automobile par ménage en 2017&quot;</span>)</span></code></pre></div>
<p><img src="Projet-Data-Mining-2021_files/figure-html/unnamed-chunk-76-1.svg" width="672" /></p>
<p>Alors qu’on trouve en général entre 0.6 et 1.2 automobiles par ménage, certains IRIS affichent des valeurs moyennes de 1.5 à 2 automobiles par ménage.</p>
</div>
</div>
<div id="sauvegarde-du-tableau-et-jointure-avec-le-fonds-de-carte" class="section level3" number="3.2.5">
<h3><span class="header-section-number">3.2.5</span> Sauvegarde du tableau et jointure avec le fonds de carte</h3>
<p>On commence par effectuer une sauvegarde simple de notre tableau :</p>
<div class="sourceCode" id="cb135"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb135-1"><a href="21-cartography.html#cb135-1"></a><span class="kw">saveRDS</span>(tabdon,<span class="st">&quot;data/VOIT_IRIS.Rdata&quot;</span>)</span></code></pre></div>
<p>Puis on effectue une jointure avec le fonds de carte map_iris et on réalise une sauvegarde sous un autre nom.</p>
<div class="sourceCode" id="cb136"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb136-1"><a href="21-cartography.html#cb136-1"></a>tabfin&lt;-tabdon <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">rename</span>(<span class="dt">CODE_IRIS =</span> IRIS)</span>
<span id="cb136-2"><a href="21-cartography.html#cb136-2"></a>map_VOIT_IRIS&lt;-<span class="kw">left_join</span>(map, tabfin) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">st_as_sf</span>()</span></code></pre></div>
<pre><code>Joining, by = &quot;CODE_IRIS&quot;</code></pre>
<div class="sourceCode" id="cb138"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb138-1"><a href="21-cartography.html#cb138-1"></a><span class="kw">saveRDS</span>(map_VOIT_IRIS, <span class="st">&quot;data/map_VOIT_IRIS.Rdata&quot;</span>)</span></code></pre></div>
</div>
<div id="carte-de-stock" class="section level3" number="3.2.6">
<h3><span class="header-section-number">3.2.6</span> Carte de stock</h3>
<p>Une <em>carte de stock</em> représente la localisation de quantités que l’on peut aditionner et dont le total a un sens. Par exemple un nombre d’habitants, un nombre de ménages, un nombre d’automobiles. Ce quantités doivent être représentées par des figures (cercles, carrés, …) dont la <em>surface est proportionelle au stock</em> afin que l’oeil du lecteur puisse les aditionner visuellement.</p>
<p>Dans le package <strong>cartography</strong>, on réalise ce type de carte à l’aide de la fonction <code>PropSymbolLayer</code> et on complète l’habillage de la carte (titre, sources, auteur, …) à l’aide de la fonction <code>layoutLayer</code></p>
<div id="distribution-des-ménages" class="section level4" number="3.2.6.1">
<h4><span class="header-section-number">3.2.6.1</span> Distribution des ménages</h4>
<div class="sourceCode" id="cb139"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb139-1"><a href="21-cartography.html#cb139-1"></a>map_com&lt;-<span class="kw">readRDS</span>(<span class="st">&quot;data/map_com.Rdata&quot;</span>)</span>
<span id="cb139-2"><a href="21-cartography.html#cb139-2"></a>map_iris&lt;-<span class="kw">readRDS</span>(<span class="st">&quot;data/map_VOIT_IRIS.Rdata&quot;</span>)</span>
<span id="cb139-3"><a href="21-cartography.html#cb139-3"></a></span>
<span id="cb139-4"><a href="21-cartography.html#cb139-4"></a><span class="kw">par</span>(<span class="dt">mar=</span><span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">2</span>,<span class="dv">0</span>))</span>
<span id="cb139-5"><a href="21-cartography.html#cb139-5"></a></span>
<span id="cb139-6"><a href="21-cartography.html#cb139-6"></a></span>
<span id="cb139-7"><a href="21-cartography.html#cb139-7"></a><span class="kw">plot</span>(map_iris<span class="op">$</span>geometry, <span class="dt">col=</span><span class="st">&quot;lightyellow&quot;</span>, <span class="dt">border=</span><span class="st">&quot;gray80&quot;</span>,<span class="dt">lwd=</span><span class="fl">0.4</span>)</span>
<span id="cb139-8"><a href="21-cartography.html#cb139-8"></a><span class="kw">plot</span>(map_com<span class="op">$</span>geometry, <span class="dt">col=</span><span class="ot">NA</span>, <span class="dt">border=</span><span class="st">&quot;gray40&quot;</span>,<span class="dt">lwd=</span><span class="fl">0.8</span>, <span class="dt">add=</span>T)</span>
<span id="cb139-9"><a href="21-cartography.html#cb139-9"></a></span>
<span id="cb139-10"><a href="21-cartography.html#cb139-10"></a><span class="kw">propSymbolsLayer</span>(<span class="dt">x =</span> map_iris,</span>
<span id="cb139-11"><a href="21-cartography.html#cb139-11"></a>                 <span class="dt">var =</span> <span class="st">&quot;MEN_TOTAL&quot;</span>,</span>
<span id="cb139-12"><a href="21-cartography.html#cb139-12"></a>                 <span class="dt">col=</span><span class="st">&quot;blue&quot;</span>,</span>
<span id="cb139-13"><a href="21-cartography.html#cb139-13"></a>                 <span class="dt">inches =</span> <span class="fl">0.06</span>,</span>
<span id="cb139-14"><a href="21-cartography.html#cb139-14"></a>                 <span class="dt">legend.title.txt =</span> <span class="st">&quot;Nb ménages&quot;</span>,</span>
<span id="cb139-15"><a href="21-cartography.html#cb139-15"></a>                 <span class="dt">legend.pos =</span> <span class="st">&quot;left&quot;</span>)</span>
<span id="cb139-16"><a href="21-cartography.html#cb139-16"></a></span>
<span id="cb139-17"><a href="21-cartography.html#cb139-17"></a><span class="kw">layoutLayer</span>(<span class="dt">title =</span> <span class="st">&quot;Distribution des ménages du Val de Marne en 2017&quot;</span>,</span>
<span id="cb139-18"><a href="21-cartography.html#cb139-18"></a>            <span class="dt">author =</span> <span class="st">&quot;Master MECI / Option data mining&quot;</span>,</span>
<span id="cb139-19"><a href="21-cartography.html#cb139-19"></a>            <span class="dt">sources =</span> <span class="st">&quot;INSEE, RP 2017, fichiers détail&quot;</span>)</span></code></pre></div>
<p><img src="Projet-Data-Mining-2021_files/figure-html/unnamed-chunk-79-1.svg" width="672" /></p>
</div>
<div id="distribution-des-automobiles" class="section level4" number="3.2.6.2">
<h4><span class="header-section-number">3.2.6.2</span> Distribution des automobiles</h4>
<div class="sourceCode" id="cb140"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb140-1"><a href="21-cartography.html#cb140-1"></a>map_com&lt;-<span class="kw">readRDS</span>(<span class="st">&quot;data/map_com.Rdata&quot;</span>)</span>
<span id="cb140-2"><a href="21-cartography.html#cb140-2"></a>map_iris&lt;-<span class="kw">readRDS</span>(<span class="st">&quot;data/map_VOIT_IRIS.Rdata&quot;</span>)</span>
<span id="cb140-3"><a href="21-cartography.html#cb140-3"></a></span>
<span id="cb140-4"><a href="21-cartography.html#cb140-4"></a><span class="kw">par</span>(<span class="dt">mar=</span><span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">2</span>,<span class="dv">0</span>))</span>
<span id="cb140-5"><a href="21-cartography.html#cb140-5"></a></span>
<span id="cb140-6"><a href="21-cartography.html#cb140-6"></a></span>
<span id="cb140-7"><a href="21-cartography.html#cb140-7"></a><span class="kw">plot</span>(map_iris<span class="op">$</span>geometry, <span class="dt">col=</span><span class="st">&quot;lightyellow&quot;</span>, <span class="dt">border=</span><span class="st">&quot;gray80&quot;</span>,<span class="dt">lwd=</span><span class="fl">0.4</span>)</span>
<span id="cb140-8"><a href="21-cartography.html#cb140-8"></a><span class="kw">plot</span>(map_com<span class="op">$</span>geometry, <span class="dt">col=</span><span class="ot">NA</span>, <span class="dt">border=</span><span class="st">&quot;gray40&quot;</span>,<span class="dt">lwd=</span><span class="fl">0.8</span>, <span class="dt">add=</span>T)</span>
<span id="cb140-9"><a href="21-cartography.html#cb140-9"></a></span>
<span id="cb140-10"><a href="21-cartography.html#cb140-10"></a><span class="kw">propSymbolsLayer</span>(<span class="dt">x =</span> map_iris,</span>
<span id="cb140-11"><a href="21-cartography.html#cb140-11"></a>                 <span class="dt">var =</span> <span class="st">&quot;VOIT_TOTAL&quot;</span>,</span>
<span id="cb140-12"><a href="21-cartography.html#cb140-12"></a>                 <span class="dt">col=</span><span class="st">&quot;red&quot;</span>,</span>
<span id="cb140-13"><a href="21-cartography.html#cb140-13"></a>                 <span class="dt">inches =</span> <span class="fl">0.06</span>,</span>
<span id="cb140-14"><a href="21-cartography.html#cb140-14"></a>                 <span class="dt">legend.title.txt =</span> <span class="st">&quot;nb. véhicules&quot;</span>,</span>
<span id="cb140-15"><a href="21-cartography.html#cb140-15"></a>                 <span class="dt">legend.pos =</span> <span class="st">&quot;left&quot;</span>)</span>
<span id="cb140-16"><a href="21-cartography.html#cb140-16"></a></span>
<span id="cb140-17"><a href="21-cartography.html#cb140-17"></a><span class="kw">layoutLayer</span>(<span class="dt">title =</span> <span class="st">&quot;Distribution des automobiles des ménages du Val de Marne en 2017&quot;</span>,</span>
<span id="cb140-18"><a href="21-cartography.html#cb140-18"></a>            <span class="dt">author =</span> <span class="st">&quot;Master MECI / Option data mining&quot;</span>,</span>
<span id="cb140-19"><a href="21-cartography.html#cb140-19"></a>            <span class="dt">sources =</span> <span class="st">&quot;INSEE, RP 2017, fichiers détail&quot;</span>)</span></code></pre></div>
<p><img src="Projet-Data-Mining-2021_files/figure-html/unnamed-chunk-80-1.svg" width="672" /></p>
</div>
</div>
<div id="carte-dintensité-choroplèthe" class="section level3" number="3.2.7">
<h3><span class="header-section-number">3.2.7</span> Carte d’intensité (choroplèthe)</h3>
<p>Une <em>carte d’intensité</em> représente un phénomène relatif dont la somme n’a pas de sens. Par exemple, il serait absurde d’aditionner les nombres d’automobiles par habitant des IRIS du Val de Marne. Ces variables d’intensité caractèrisent donc l’état général d’une zone (<em>choros</em>) at elles vont être représentées par une couleur appliquée à toute la surface de la zone, d’où leur nom de <em>cartes choroplèthes</em>.</p>
<p>La fonction u package <strong>cartography</strong> adaptée aux variables d’intensité est la fonction <code>Chorolayer</code>. Comme précédemment on la combine avec la fonction <code>LayoutLayer</code>pour réaliser l’habillage de la carte.</p>
<div id="part-des-ménages-sans-automobile" class="section level4" number="3.2.7.1">
<h4><span class="header-section-number">3.2.7.1</span> Part des ménages sans automobile</h4>
<p>On va réaliser une carte allant du vert clair au vert foncé au fur et à mesure que le nombre de ménages sans automobiles augmente.</p>
<div class="sourceCode" id="cb141"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb141-1"><a href="21-cartography.html#cb141-1"></a>map_com&lt;-<span class="kw">readRDS</span>(<span class="st">&quot;data/map_com.Rdata&quot;</span>)</span>
<span id="cb141-2"><a href="21-cartography.html#cb141-2"></a>map_iris&lt;-<span class="kw">readRDS</span>(<span class="st">&quot;data/map_VOIT_IRIS.Rdata&quot;</span>)</span>
<span id="cb141-3"><a href="21-cartography.html#cb141-3"></a></span>
<span id="cb141-4"><a href="21-cartography.html#cb141-4"></a><span class="kw">par</span>(<span class="dt">mar=</span><span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">2</span>,<span class="dv">0</span>))</span>
<span id="cb141-5"><a href="21-cartography.html#cb141-5"></a></span>
<span id="cb141-6"><a href="21-cartography.html#cb141-6"></a></span>
<span id="cb141-7"><a href="21-cartography.html#cb141-7"></a>mybreaks =<span class="st"> </span><span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">10</span>, <span class="dv">20</span>, <span class="dv">30</span>, <span class="dv">40</span>, <span class="dv">50</span>, <span class="dv">60</span>, <span class="dv">70</span>)</span>
<span id="cb141-8"><a href="21-cartography.html#cb141-8"></a>mycols &lt;-<span class="kw">carto.pal</span>(<span class="dt">pal1 =</span> <span class="st">&quot;green.pal&quot;</span>, <span class="dt">n1 =</span> <span class="dv">7</span>)</span>
<span id="cb141-9"><a href="21-cartography.html#cb141-9"></a></span>
<span id="cb141-10"><a href="21-cartography.html#cb141-10"></a></span>
<span id="cb141-11"><a href="21-cartography.html#cb141-11"></a><span class="kw">choroLayer</span>(<span class="dt">x =</span> map_iris,</span>
<span id="cb141-12"><a href="21-cartography.html#cb141-12"></a>                 <span class="dt">var =</span> <span class="st">&quot;PCT_VOIT0&quot;</span>,</span>
<span id="cb141-13"><a href="21-cartography.html#cb141-13"></a>                 <span class="dt">breaks =</span> mybreaks,</span>
<span id="cb141-14"><a href="21-cartography.html#cb141-14"></a>                 <span class="dt">col=</span> mycols,</span>
<span id="cb141-15"><a href="21-cartography.html#cb141-15"></a>                 <span class="dt">lwd=</span><span class="fl">0.2</span>,</span>
<span id="cb141-16"><a href="21-cartography.html#cb141-16"></a>                 <span class="dt">colNA =</span> <span class="st">&quot;gray80&quot;</span>,</span>
<span id="cb141-17"><a href="21-cartography.html#cb141-17"></a>                 <span class="dt">legend.title.txt =</span> <span class="st">&quot;% ménages&quot;</span>,</span>
<span id="cb141-18"><a href="21-cartography.html#cb141-18"></a>                 <span class="dt">legend.pos =</span> <span class="st">&quot;left&quot;</span>,</span>
<span id="cb141-19"><a href="21-cartography.html#cb141-19"></a>                 <span class="dt">legend.values.rnd =</span> <span class="dv">2</span>,</span>
<span id="cb141-20"><a href="21-cartography.html#cb141-20"></a>                 <span class="dt">legend.nodata =</span> <span class="st">&quot;Pas de données&quot;</span>)</span>
<span id="cb141-21"><a href="21-cartography.html#cb141-21"></a></span>
<span id="cb141-22"><a href="21-cartography.html#cb141-22"></a></span>
<span id="cb141-23"><a href="21-cartography.html#cb141-23"></a><span class="kw">plot</span>(map_com<span class="op">$</span>geometry, <span class="dt">col=</span><span class="ot">NA</span>, <span class="dt">border=</span><span class="st">&quot;gray10&quot;</span>,<span class="dt">lwd=</span><span class="fl">0.8</span>, <span class="dt">add=</span>T)</span>
<span id="cb141-24"><a href="21-cartography.html#cb141-24"></a></span>
<span id="cb141-25"><a href="21-cartography.html#cb141-25"></a><span class="kw">layoutLayer</span>(<span class="dt">title =</span> <span class="st">&quot;Part des ménages sans automobiles du Val de Marne en 2017&quot;</span>,</span>
<span id="cb141-26"><a href="21-cartography.html#cb141-26"></a>            <span class="dt">author =</span> <span class="st">&quot;Master MECI / Option data mining&quot;</span>,</span>
<span id="cb141-27"><a href="21-cartography.html#cb141-27"></a>            <span class="dt">sources =</span> <span class="st">&quot;INSEE, RP 2017, fichiers détail&quot;</span>)</span></code></pre></div>
<p><img src="Projet-Data-Mining-2021_files/figure-html/unnamed-chunk-81-1.svg" width="672" /></p>
</div>
<div id="nombre-moyen-dautomobiles-par-ménage-1" class="section level4" number="3.2.7.2">
<h4><span class="header-section-number">3.2.7.2</span> Nombre moyen d’automobiles par ménage</h4>
<p>On va prendre comme référence la valeur de 1 automobile par ménage et on va construire une double palette qui se dirrige vers le brun lorsque le nombre d’automobile par ménage augmente et vers l’orange lorsque le nombre d’automobile par ménage diminue</p>
<div class="sourceCode" id="cb142"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb142-1"><a href="21-cartography.html#cb142-1"></a>map_com&lt;-<span class="kw">readRDS</span>(<span class="st">&quot;data/map_com.Rdata&quot;</span>)</span>
<span id="cb142-2"><a href="21-cartography.html#cb142-2"></a>map_iris&lt;-<span class="kw">readRDS</span>(<span class="st">&quot;data/map_VOIT_IRIS.Rdata&quot;</span>)</span>
<span id="cb142-3"><a href="21-cartography.html#cb142-3"></a></span>
<span id="cb142-4"><a href="21-cartography.html#cb142-4"></a><span class="kw">par</span>(<span class="dt">mar=</span><span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">2</span>,<span class="dv">0</span>))</span>
<span id="cb142-5"><a href="21-cartography.html#cb142-5"></a></span>
<span id="cb142-6"><a href="21-cartography.html#cb142-6"></a></span>
<span id="cb142-7"><a href="21-cartography.html#cb142-7"></a>mybreaks =<span class="st"> </span><span class="kw">c</span>(<span class="fl">0.3</span>,<span class="fl">0.5</span>, <span class="fl">0.6</span>,<span class="fl">0.7</span>,<span class="fl">0.8</span>,<span class="fl">0.9</span>, <span class="dv">1</span>,<span class="fl">1.1</span>, <span class="fl">1.2</span>,<span class="fl">1.3</span>,<span class="fl">1.4</span>,<span class="fl">1.5</span>,<span class="fl">2.1</span>)</span>
<span id="cb142-8"><a href="21-cartography.html#cb142-8"></a>mycols &lt;-<span class="kw">carto.pal</span>(<span class="dt">pal1 =</span> <span class="st">&quot;green.pal&quot;</span>, <span class="dt">n1 =</span> <span class="dv">6</span>, <span class="dt">pal2 =</span> <span class="st">&quot;orange.pal&quot;</span>, <span class="dt">n2 =</span> <span class="dv">6</span>)</span>
<span id="cb142-9"><a href="21-cartography.html#cb142-9"></a></span>
<span id="cb142-10"><a href="21-cartography.html#cb142-10"></a></span>
<span id="cb142-11"><a href="21-cartography.html#cb142-11"></a><span class="kw">choroLayer</span>(<span class="dt">x =</span> map_iris,</span>
<span id="cb142-12"><a href="21-cartography.html#cb142-12"></a>                 <span class="dt">var =</span> <span class="st">&quot;VOIT_MEN&quot;</span>,</span>
<span id="cb142-13"><a href="21-cartography.html#cb142-13"></a>                 <span class="dt">breaks =</span> mybreaks,</span>
<span id="cb142-14"><a href="21-cartography.html#cb142-14"></a>                 <span class="dt">col=</span> mycols,</span>
<span id="cb142-15"><a href="21-cartography.html#cb142-15"></a>                 <span class="dt">lwd=</span><span class="fl">0.2</span>,</span>
<span id="cb142-16"><a href="21-cartography.html#cb142-16"></a>                 <span class="dt">colNA =</span> <span class="st">&quot;gray80&quot;</span>,</span>
<span id="cb142-17"><a href="21-cartography.html#cb142-17"></a>                 <span class="dt">legend.title.txt =</span> <span class="st">&quot;auto. / menage&quot;</span>,</span>
<span id="cb142-18"><a href="21-cartography.html#cb142-18"></a>                 <span class="dt">legend.pos =</span> <span class="st">&quot;left&quot;</span>,</span>
<span id="cb142-19"><a href="21-cartography.html#cb142-19"></a>                 <span class="dt">legend.values.rnd =</span> <span class="dv">2</span>,</span>
<span id="cb142-20"><a href="21-cartography.html#cb142-20"></a>                 <span class="dt">legend.nodata =</span> <span class="st">&quot;Pas de données&quot;</span>)</span>
<span id="cb142-21"><a href="21-cartography.html#cb142-21"></a></span>
<span id="cb142-22"><a href="21-cartography.html#cb142-22"></a></span>
<span id="cb142-23"><a href="21-cartography.html#cb142-23"></a><span class="kw">plot</span>(map_com<span class="op">$</span>geometry, <span class="dt">col=</span><span class="ot">NA</span>, <span class="dt">border=</span><span class="st">&quot;gray10&quot;</span>,<span class="dt">lwd=</span><span class="fl">0.8</span>, <span class="dt">add=</span>T)</span>
<span id="cb142-24"><a href="21-cartography.html#cb142-24"></a></span>
<span id="cb142-25"><a href="21-cartography.html#cb142-25"></a><span class="kw">layoutLayer</span>(<span class="dt">title =</span> <span class="st">&quot;Dépendance automobile des ménages du Val de Marne en 2017&quot;</span>,</span>
<span id="cb142-26"><a href="21-cartography.html#cb142-26"></a>            <span class="dt">author =</span> <span class="st">&quot;Master MECI / Option data mining&quot;</span>,</span>
<span id="cb142-27"><a href="21-cartography.html#cb142-27"></a>            <span class="dt">sources =</span> <span class="st">&quot;INSEE, RP 2017, fichiers détail&quot;</span>)</span></code></pre></div>
<p><img src="Projet-Data-Mining-2021_files/figure-html/unnamed-chunk-82-1.svg" width="672" /></p>
</div>
</div>
<div id="carte-de-stock-intensité" class="section level3" number="3.2.8">
<h3><span class="header-section-number">3.2.8</span> Carte de stock + intensité</h3>
<p>On peut combiner les deux modes cartographiques. Prenons à titre d’exemple le cas des ménages ayant trois automobiles ou plus. Onn peut décrire ce phénomène soit en terme de stock, soit en termes d’intensité.</p>
<div class="sourceCode" id="cb143"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb143-1"><a href="21-cartography.html#cb143-1"></a><span class="kw">summary</span>(map_iris<span class="op">$</span>MEN_VOIT3)</span></code></pre></div>
<pre><code>   Min. 1st Qu.  Median    Mean 3rd Qu.    Max.    NA&#39;s 
   0.00   12.50   21.42   26.20   33.77  145.76       9 </code></pre>
<div class="sourceCode" id="cb145"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb145-1"><a href="21-cartography.html#cb145-1"></a><span class="kw">summary</span>(map_iris<span class="op">$</span>PCT_VOIT3)</span></code></pre></div>
<pre><code>   Min. 1st Qu.  Median    Mean 3rd Qu.    Max.    NA&#39;s 
  0.000   1.170   1.943   2.510   3.160  16.114       9 </code></pre>
<p>On réalise les deux cartes successivement en commençant par la carte de taux puis en lui ajoutant la carte de stock par dessus.</p>
<div class="sourceCode" id="cb147"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb147-1"><a href="21-cartography.html#cb147-1"></a>map_com&lt;-<span class="kw">readRDS</span>(<span class="st">&quot;data/map_com.Rdata&quot;</span>)</span>
<span id="cb147-2"><a href="21-cartography.html#cb147-2"></a>map_iris&lt;-<span class="kw">readRDS</span>(<span class="st">&quot;data/map_VOIT_IRIS.Rdata&quot;</span>)</span>
<span id="cb147-3"><a href="21-cartography.html#cb147-3"></a></span>
<span id="cb147-4"><a href="21-cartography.html#cb147-4"></a><span class="kw">par</span>(<span class="dt">mar=</span><span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">2</span>,<span class="dv">0</span>))</span>
<span id="cb147-5"><a href="21-cartography.html#cb147-5"></a></span>
<span id="cb147-6"><a href="21-cartography.html#cb147-6"></a></span>
<span id="cb147-7"><a href="21-cartography.html#cb147-7"></a>mybreaks =<span class="st"> </span><span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">4</span>,<span class="dv">8</span>,<span class="dv">17</span>)</span>
<span id="cb147-8"><a href="21-cartography.html#cb147-8"></a>mycols &lt;-<span class="kw">carto.pal</span>(<span class="dt">pal1 =</span> <span class="st">&quot;taupe.pal&quot;</span>, <span class="dt">n1 =</span> <span class="dv">5</span>)</span>
<span id="cb147-9"><a href="21-cartography.html#cb147-9"></a></span>
<span id="cb147-10"><a href="21-cartography.html#cb147-10"></a></span>
<span id="cb147-11"><a href="21-cartography.html#cb147-11"></a><span class="kw">choroLayer</span>(<span class="dt">x =</span> map_iris,</span>
<span id="cb147-12"><a href="21-cartography.html#cb147-12"></a>                 <span class="dt">var =</span> <span class="st">&quot;PCT_VOIT3&quot;</span>,</span>
<span id="cb147-13"><a href="21-cartography.html#cb147-13"></a>                 <span class="dt">breaks =</span> mybreaks,</span>
<span id="cb147-14"><a href="21-cartography.html#cb147-14"></a>                 <span class="dt">col=</span> mycols,</span>
<span id="cb147-15"><a href="21-cartography.html#cb147-15"></a>                 <span class="dt">lwd=</span><span class="fl">0.2</span>,</span>
<span id="cb147-16"><a href="21-cartography.html#cb147-16"></a>                 <span class="dt">colNA =</span> <span class="st">&quot;gray80&quot;</span>,</span>
<span id="cb147-17"><a href="21-cartography.html#cb147-17"></a>                 <span class="dt">legend.title.txt =</span> <span class="st">&quot;% ménages&quot;</span>,</span>
<span id="cb147-18"><a href="21-cartography.html#cb147-18"></a>                 <span class="dt">legend.pos =</span> <span class="st">&quot;topleft&quot;</span>,</span>
<span id="cb147-19"><a href="21-cartography.html#cb147-19"></a>                 <span class="dt">legend.values.rnd =</span> <span class="dv">2</span>,</span>
<span id="cb147-20"><a href="21-cartography.html#cb147-20"></a>                 <span class="dt">legend.nodata =</span> <span class="st">&quot;Pas de données&quot;</span>)</span>
<span id="cb147-21"><a href="21-cartography.html#cb147-21"></a></span>
<span id="cb147-22"><a href="21-cartography.html#cb147-22"></a></span>
<span id="cb147-23"><a href="21-cartography.html#cb147-23"></a><span class="kw">plot</span>(map_com<span class="op">$</span>geometry, <span class="dt">col=</span><span class="ot">NA</span>, <span class="dt">border=</span><span class="st">&quot;gray10&quot;</span>,<span class="dt">lwd=</span><span class="fl">0.8</span>, <span class="dt">add=</span>T)</span>
<span id="cb147-24"><a href="21-cartography.html#cb147-24"></a></span>
<span id="cb147-25"><a href="21-cartography.html#cb147-25"></a><span class="kw">propSymbolsLayer</span>(<span class="dt">x =</span> map_iris,</span>
<span id="cb147-26"><a href="21-cartography.html#cb147-26"></a>                 <span class="dt">var =</span> <span class="st">&quot;MEN_VOIT3&quot;</span>,</span>
<span id="cb147-27"><a href="21-cartography.html#cb147-27"></a>                 <span class="dt">col=</span><span class="st">&quot;red&quot;</span>,</span>
<span id="cb147-28"><a href="21-cartography.html#cb147-28"></a>                 <span class="dt">inches =</span> <span class="fl">0.06</span>,</span>
<span id="cb147-29"><a href="21-cartography.html#cb147-29"></a>                 <span class="dt">legend.title.txt =</span> <span class="st">&quot;nb. ménages&quot;</span>,</span>
<span id="cb147-30"><a href="21-cartography.html#cb147-30"></a>                 <span class="dt">legend.pos =</span> <span class="st">&quot;left&quot;</span>)</span>
<span id="cb147-31"><a href="21-cartography.html#cb147-31"></a></span>
<span id="cb147-32"><a href="21-cartography.html#cb147-32"></a><span class="kw">layoutLayer</span>(<span class="dt">title =</span> <span class="st">&quot;Nombre et proportion des ménages ayant 3 automobiles ou plus en 2017&quot;</span>,</span>
<span id="cb147-33"><a href="21-cartography.html#cb147-33"></a>            <span class="dt">author =</span> <span class="st">&quot;Master MECI / Option data mining&quot;</span>,</span>
<span id="cb147-34"><a href="21-cartography.html#cb147-34"></a>            <span class="dt">sources =</span> <span class="st">&quot;INSEE, RP 2017, fichiers détail&quot;</span>)</span></code></pre></div>
<p><img src="Projet-Data-Mining-2021_files/figure-html/unnamed-chunk-84-1.svg" width="672" /></p>
</div>
</div>
<div id="création-de-fonctions" class="section level2" number="3.3">
<h2><span class="header-section-number">3.3</span> Création de fonctions</h2>
<p>L’objectif de cette section est de préparer des fonctions de cartographie qui pourront être intégrés dans une application shiny. On va pour cela reprendre les fonctions mises au point dans la partie statistiques et les coupler avec des procédures de cartographie. On se limitera dans l’immédiat à l’emploi des packages <code>sf</code>et <code>cartography</code>,mais on pourra par la suite créer d’autres fonctions fondées sur des packages tels que <code>leaflet</code>, <code>plotly</code>ou <code>tmap</code>…</p>
<div id="fonction-tab_cont_iris" class="section level3" number="3.3.1">
<h3><span class="header-section-number">3.3.1</span> fonction tab_cont_iris()</h3>
<p>On va prendre comme point de départ la création d’un <strong>tableau de contingence spatial</strong> c’est-à-dire un tableau dont les lignes correspondent aux IRIS d’une commune et les colonnes aux modalités d’une variable de type factor.</p>
<p>On récupère les fonctions statistiques mises au point précédemment</p>
<div class="sourceCode" id="cb148"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb148-1"><a href="21-cartography.html#cb148-1"></a><span class="kw">source</span>(<span class="st">&quot;fonctions/mes_fonctions.R&quot;</span>)</span></code></pre></div>
<p>On charge le fichier de données en lui ajoutant la variable LPRM_1 dont nous aurons besoin pour distinguer les données par ménage et pour l’ensemble de la population.</p>
<div id="création-du-tableau-avec-la-fonction-tab_var" class="section level4" number="3.3.1.1">
<h4><span class="header-section-number">3.3.1.1</span> création du tableau avec la fonction tab_var</h4>
<div class="sourceCode" id="cb149"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb149-1"><a href="21-cartography.html#cb149-1"></a>tab&lt;-<span class="kw">tab_var</span>(<span class="dt">data =</span> RP, </span>
<span id="cb149-2"><a href="21-cartography.html#cb149-2"></a>              <span class="dt">codecom =</span> <span class="st">&quot;94071&quot;</span>, </span>
<span id="cb149-3"><a href="21-cartography.html#cb149-3"></a>              <span class="dt">list_mod =</span> <span class="kw">c</span>(<span class="st">&quot;1&quot;</span>),</span>
<span id="cb149-4"><a href="21-cartography.html#cb149-4"></a>              <span class="dt">var =</span> VOIT, IRIS)</span></code></pre></div>
</div>
<div id="pivotage-du-tableau" class="section level4" number="3.3.1.2">
<h4><span class="header-section-number">3.3.1.2</span> pivotage du tableau</h4>
<p>On opére deux opérations de pivotage du tableau pour récupérer les valeurs brutes (<em>raw</em>) et les valeurs en % (<em>pct</em>).</p>
<div class="sourceCode" id="cb150"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb150-1"><a href="21-cartography.html#cb150-1"></a>tab_raw &lt;-<span class="st"> </span><span class="kw">pivot_wider</span>(<span class="dt">data =</span> tab <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(<span class="op">-</span>pct),</span>
<span id="cb150-2"><a href="21-cartography.html#cb150-2"></a>                    <span class="dt">names_from =</span> VOIT,</span>
<span id="cb150-3"><a href="21-cartography.html#cb150-3"></a>                    <span class="dt">values_from =</span> n,</span>
<span id="cb150-4"><a href="21-cartography.html#cb150-4"></a>                    <span class="dt">values_fill =</span> <span class="dv">0</span>)</span>
<span id="cb150-5"><a href="21-cartography.html#cb150-5"></a><span class="kw">names</span>(tab_raw)[<span class="op">-</span><span class="dv">1</span>] &lt;-<span class="st"> </span><span class="kw">paste</span>(<span class="st">&quot;count_&quot;</span>,<span class="kw">names</span>(tab_raw)[<span class="op">-</span><span class="dv">1</span>], <span class="dt">sep=</span><span class="st">&quot;&quot;</span>)</span>
<span id="cb150-6"><a href="21-cartography.html#cb150-6"></a>                    </span>
<span id="cb150-7"><a href="21-cartography.html#cb150-7"></a>tab_pct &lt;-<span class="st"> </span><span class="kw">pivot_wider</span>(<span class="dt">data =</span> tab <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(<span class="op">-</span>n),</span>
<span id="cb150-8"><a href="21-cartography.html#cb150-8"></a>                    <span class="dt">names_from =</span> VOIT,</span>
<span id="cb150-9"><a href="21-cartography.html#cb150-9"></a>                    <span class="dt">values_from =</span> pct,</span>
<span id="cb150-10"><a href="21-cartography.html#cb150-10"></a>           <span class="dt">values_fill =</span> <span class="dv">0</span>)                      </span>
<span id="cb150-11"><a href="21-cartography.html#cb150-11"></a><span class="kw">names</span>(tab_pct)[<span class="op">-</span><span class="dv">1</span>] &lt;-<span class="st"> </span><span class="kw">paste</span>(<span class="st">&quot;pct_&quot;</span>,<span class="kw">names</span>(tab_pct)[<span class="op">-</span><span class="dv">1</span>], <span class="dt">sep=</span><span class="st">&quot;&quot;</span>)  </span></code></pre></div>
</div>
<div id="ajout-de-la-géométrie" class="section level4" number="3.3.1.3">
<h4><span class="header-section-number">3.3.1.3</span> Ajout de la géométrie</h4>
<p>On fusionne les deux tableaux précédents et bon effectue la jointure avec le fonds de carte, ce qui suppose de renommer la variable IRIS en CODE_IRIS.</p>
<div class="sourceCode" id="cb151"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb151-1"><a href="21-cartography.html#cb151-1"></a>tab_geo &lt;-<span class="st"> </span><span class="kw">left_join</span>(tab_raw, tab_pct) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb151-2"><a href="21-cartography.html#cb151-2"></a><span class="st">            </span><span class="kw">rename</span>(<span class="dt">CODE_IRIS=</span>IRIS) <span class="op">%&gt;%</span></span>
<span id="cb151-3"><a href="21-cartography.html#cb151-3"></a><span class="st">            </span><span class="kw">left_join</span>(map_iris) <span class="op">%&gt;%</span></span>
<span id="cb151-4"><a href="21-cartography.html#cb151-4"></a><span class="st">            </span><span class="kw">st_as_sf</span>()</span></code></pre></div>
<pre><code>Joining, by = &quot;IRIS&quot;</code></pre>
<pre><code>Joining, by = &quot;CODE_IRIS&quot;</code></pre>
</div>
<div id="création-dune-fonction-unique" class="section level4" number="3.3.1.4">
<h4><span class="header-section-number">3.3.1.4</span> Création d’une fonction unique</h4>
<p>On reprend les étapes précédentes pour en faire une fonction unique appelée <code>tab_cont_iris</code>qui prend en entrée une variable quelconque de type factor et produit en sortie le tableau de contingence spatial soit par individu, soit par ménages.</p>
<div class="sourceCode" id="cb154"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb154-1"><a href="21-cartography.html#cb154-1"></a>tab_cont_iris &lt;-<span class="st"> </span><span class="cf">function</span>(data, codecom, list_mod, var)</span>
<span id="cb154-2"><a href="21-cartography.html#cb154-2"></a>  {</span>
<span id="cb154-3"><a href="21-cartography.html#cb154-3"></a>  <span class="co"># Create tab</span></span>
<span id="cb154-4"><a href="21-cartography.html#cb154-4"></a>  tab &lt;-<span class="kw">tab_var</span>(data, codecom, list_mod, {{var}}, IRIS)</span>
<span id="cb154-5"><a href="21-cartography.html#cb154-5"></a>  </span>
<span id="cb154-6"><a href="21-cartography.html#cb154-6"></a>  <span class="co"># Pivot count</span></span>
<span id="cb154-7"><a href="21-cartography.html#cb154-7"></a>  tab_raw &lt;-<span class="st"> </span><span class="kw">pivot_wider</span>(<span class="dt">data =</span> tab <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(<span class="op">-</span>pct),</span>
<span id="cb154-8"><a href="21-cartography.html#cb154-8"></a>                    <span class="dt">names_from =</span> {{var}},</span>
<span id="cb154-9"><a href="21-cartography.html#cb154-9"></a>                    <span class="dt">values_from =</span> n,</span>
<span id="cb154-10"><a href="21-cartography.html#cb154-10"></a>                    <span class="dt">values_fill =</span> <span class="dv">0</span>)</span>
<span id="cb154-11"><a href="21-cartography.html#cb154-11"></a>  <span class="kw">names</span>(tab_raw)[<span class="op">-</span><span class="dv">1</span>] &lt;-<span class="st"> </span><span class="kw">paste</span>(<span class="st">&quot;count_&quot;</span>,<span class="kw">names</span>(tab_raw)[<span class="op">-</span><span class="dv">1</span>], <span class="dt">sep=</span><span class="st">&quot;&quot;</span>)</span>
<span id="cb154-12"><a href="21-cartography.html#cb154-12"></a>  </span>
<span id="cb154-13"><a href="21-cartography.html#cb154-13"></a>  <span class="co"># Pivot pct                </span></span>
<span id="cb154-14"><a href="21-cartography.html#cb154-14"></a>  tab_pct &lt;-<span class="st"> </span><span class="kw">pivot_wider</span>(<span class="dt">data =</span> tab <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(<span class="op">-</span>n),</span>
<span id="cb154-15"><a href="21-cartography.html#cb154-15"></a>                    <span class="dt">names_from =</span> {{var}},</span>
<span id="cb154-16"><a href="21-cartography.html#cb154-16"></a>                    <span class="dt">values_from =</span> pct,</span>
<span id="cb154-17"><a href="21-cartography.html#cb154-17"></a>           <span class="dt">values_fill =</span> <span class="dv">0</span>)                      </span>
<span id="cb154-18"><a href="21-cartography.html#cb154-18"></a>  <span class="kw">names</span>(tab_pct)[<span class="op">-</span><span class="dv">1</span>] &lt;-<span class="st"> </span><span class="kw">paste</span>(<span class="st">&quot;pct_&quot;</span>,<span class="kw">names</span>(tab_pct)[<span class="op">-</span><span class="dv">1</span>], <span class="dt">sep=</span><span class="st">&quot;&quot;</span>) </span>
<span id="cb154-19"><a href="21-cartography.html#cb154-19"></a>  </span>
<span id="cb154-20"><a href="21-cartography.html#cb154-20"></a>  <span class="co"># join with geom</span></span>
<span id="cb154-21"><a href="21-cartography.html#cb154-21"></a>  tab_geo &lt;-<span class="st"> </span><span class="kw">left_join</span>(tab_raw, tab_pct) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb154-22"><a href="21-cartography.html#cb154-22"></a><span class="st">            </span><span class="kw">rename</span>(<span class="dt">CODE_IRIS=</span>IRIS) <span class="op">%&gt;%</span></span>
<span id="cb154-23"><a href="21-cartography.html#cb154-23"></a><span class="st">            </span><span class="kw">left_join</span>(map_iris) <span class="op">%&gt;%</span></span>
<span id="cb154-24"><a href="21-cartography.html#cb154-24"></a><span class="st">            </span><span class="kw">st_as_sf</span>()</span>
<span id="cb154-25"><a href="21-cartography.html#cb154-25"></a>  <span class="kw">return</span>(tab_geo)</span>
<span id="cb154-26"><a href="21-cartography.html#cb154-26"></a>  }</span></code></pre></div>
</div>
<div id="test-de-la-fonction" class="section level4" number="3.3.1.5">
<h4><span class="header-section-number">3.3.1.5</span> Test de la fonction</h4>
<p>On peut tester la fonction sur la variable SEXE en effectuant un comptage :</p>
<ul>
<li>soit pour la <strong>population totale</strong> en prenant list_mod = “0”</li>
</ul>
<div class="sourceCode" id="cb155"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb155-1"><a href="21-cartography.html#cb155-1"></a>SEXE_IRIS_pop &lt;-<span class="st"> </span><span class="kw">tab_cont_iris</span>(RP,<span class="st">&quot;94071&quot;</span>,<span class="st">&quot;0&quot;</span>,SEXE)</span></code></pre></div>
<pre><code>Joining, by = &quot;IRIS&quot;</code></pre>
<pre><code>Joining, by = &quot;CODE_IRIS&quot;</code></pre>
<div class="sourceCode" id="cb158"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb158-1"><a href="21-cartography.html#cb158-1"></a><span class="kw">head</span>(SEXE_IRIS_pop,<span class="dv">3</span>)</span></code></pre></div>
<pre><code># A tibble: 3 x 12
  CODE_IRIS count_1 count_2 pct_1 pct_2 INSEE_COM NOM_COM IRIS  NOM_IRIS
  &lt;chr&gt;       &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;     &lt;chr&gt;   &lt;chr&gt; &lt;chr&gt;   
1 940710101     620     718  46.3  53.7 94071     Sucy-e… 0101  Le Gran…
2 940710102     645     737  46.7  53.3 94071     Sucy-e… 0102  La Foss…
3 940710103     776    1018  43.3  56.7 94071     Sucy-e… 0103  La Cite…
# … with 3 more variables: TYP_IRIS &lt;chr&gt;, geometry &lt;MULTIPOLYGON [m]&gt;,
#   DEPT &lt;chr&gt;</code></pre>
<ul>
<li>soit pour les <strong>chefs de ménage</strong> en prenant list_mod = “1”</li>
</ul>
<div class="sourceCode" id="cb160"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb160-1"><a href="21-cartography.html#cb160-1"></a>SEXE_IRIS_men &lt;-<span class="st"> </span><span class="kw">tab_cont_iris</span>(RP,<span class="st">&quot;94071&quot;</span>,<span class="st">&quot;1&quot;</span>,SEXE)</span></code></pre></div>
<pre><code>Joining, by = &quot;IRIS&quot;</code></pre>
<pre><code>Joining, by = &quot;CODE_IRIS&quot;</code></pre>
<div class="sourceCode" id="cb163"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb163-1"><a href="21-cartography.html#cb163-1"></a><span class="kw">head</span>(SEXE_IRIS_men,<span class="dv">3</span>)</span></code></pre></div>
<pre><code># A tibble: 3 x 12
  CODE_IRIS count_1 count_2 pct_1 pct_2 INSEE_COM NOM_COM IRIS  NOM_IRIS
  &lt;chr&gt;       &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;     &lt;chr&gt;   &lt;chr&gt; &lt;chr&gt;   
1 940710101     474     338  58.4  41.6 94071     Sucy-e… 0101  Le Gran…
2 940710102     411     411  50    50   94071     Sucy-e… 0102  La Foss…
3 940710103     553     496  52.7  47.3 94071     Sucy-e… 0103  La Cite…
# … with 3 more variables: TYP_IRIS &lt;chr&gt;, geometry &lt;MULTIPOLYGON [m]&gt;,
#   DEPT &lt;chr&gt;</code></pre>
</div>
</div>
<div id="fonction-map_count_iris" class="section level3" number="3.3.2">
<h3><span class="header-section-number">3.3.2</span> fonction map_count_iris</h3>
<p>Nous allons créer différentes fonctions de cartographie selon que la variable à représenter est un stock (<em>count_x</em>) ou une intensité (<em>pct_xx</em>).</p>
<p>Dans l’immédiat nous allons nous limiter aux fonctions de base du package <code>cartography</code>mais ou pourra par la suite proposer d’autres solutions.</p>
<div id="objectifs" class="section level4" number="3.3.2.1">
<h4><span class="header-section-number">3.3.2.1</span> Objectifs</h4>
<p>On prend comme entrée un tableau de contingence spatial et on décide de représenter l’une des modalités de type <em>count</em>. Soit par exemple la modalité 3 de la variable VOIT mesurée en nombre de ménages</p>
<div class="sourceCode" id="cb165"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb165-1"><a href="21-cartography.html#cb165-1"></a>map&lt;-<span class="kw">tab_cont_iris</span>(RP,<span class="st">&quot;94071&quot;</span>,<span class="st">&quot;0&quot;</span>,VOIT)</span></code></pre></div>
<pre><code>Joining, by = &quot;IRIS&quot;</code></pre>
<pre><code>Joining, by = &quot;CODE_IRIS&quot;</code></pre>
<div class="sourceCode" id="cb168"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb168-1"><a href="21-cartography.html#cb168-1"></a><span class="kw">par</span>(<span class="dt">mar=</span><span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">2</span>,<span class="dv">0</span>))</span>
<span id="cb168-2"><a href="21-cartography.html#cb168-2"></a><span class="kw">plot</span>(map<span class="op">$</span>geometry, <span class="dt">col=</span><span class="st">&quot;lightyellow&quot;</span>, <span class="dt">border=</span><span class="st">&quot;gray80&quot;</span>,<span class="dt">lwd=</span><span class="fl">0.4</span>)</span>
<span id="cb168-3"><a href="21-cartography.html#cb168-3"></a><span class="kw">propSymbolsLayer</span>(<span class="dt">x =</span> map,</span>
<span id="cb168-4"><a href="21-cartography.html#cb168-4"></a>                 <span class="dt">var =</span> <span class="st">&quot;count_3&quot;</span>,</span>
<span id="cb168-5"><a href="21-cartography.html#cb168-5"></a>                 <span class="dt">col=</span><span class="st">&quot;blue&quot;</span>,</span>
<span id="cb168-6"><a href="21-cartography.html#cb168-6"></a>                 <span class="dt">inches =</span> <span class="fl">0.06</span>,</span>
<span id="cb168-7"><a href="21-cartography.html#cb168-7"></a>                 <span class="dt">legend.title.txt =</span> <span class="st">&quot;Nb ménages&quot;</span>,</span>
<span id="cb168-8"><a href="21-cartography.html#cb168-8"></a>                 <span class="dt">legend.pos =</span> <span class="st">&quot;topright&quot;</span>)</span>
<span id="cb168-9"><a href="21-cartography.html#cb168-9"></a></span>
<span id="cb168-10"><a href="21-cartography.html#cb168-10"></a><span class="kw">layoutLayer</span>(<span class="dt">title =</span> <span class="st">&quot;Ménages avec trois voitures ou plus&quot;</span>,</span>
<span id="cb168-11"><a href="21-cartography.html#cb168-11"></a>            <span class="dt">author =</span> <span class="st">&quot;Master MECI / Option data mining&quot;</span>,</span>
<span id="cb168-12"><a href="21-cartography.html#cb168-12"></a>            <span class="dt">sources =</span> <span class="st">&quot;INSEE, RP 2017, fichiers détail&quot;</span>)</span></code></pre></div>
<p><img src="Projet-Data-Mining-2021_files/figure-html/unnamed-chunk-93-1.svg" width="672" /></p>
</div>
<div id="fonction-minimale" class="section level4" number="3.3.2.2">
<h4><span class="header-section-number">3.3.2.2</span> Fonction minimale</h4>
<p>On va maintenant créer une fonction ayant autant de paramètres que nécessaire pour pouvoir s’appliquer à n’importe quelle modalité de n’importe quelle variable. La fonction minimale devra comporter 5 paramètres</p>
<div class="sourceCode" id="cb169"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb169-1"><a href="21-cartography.html#cb169-1"></a>map_count_iris &lt;-<span class="st"> </span><span class="cf">function</span> (data,</span>
<span id="cb169-2"><a href="21-cartography.html#cb169-2"></a>                            codecom,</span>
<span id="cb169-3"><a href="21-cartography.html#cb169-3"></a>                            list_mod,</span>
<span id="cb169-4"><a href="21-cartography.html#cb169-4"></a>                            var,</span>
<span id="cb169-5"><a href="21-cartography.html#cb169-5"></a>                            mod,</span>
<span id="cb169-6"><a href="21-cartography.html#cb169-6"></a>                            titre)</span>
<span id="cb169-7"><a href="21-cartography.html#cb169-7"></a></span>
<span id="cb169-8"><a href="21-cartography.html#cb169-8"></a>{</span>
<span id="cb169-9"><a href="21-cartography.html#cb169-9"></a>  </span>
<span id="cb169-10"><a href="21-cartography.html#cb169-10"></a> mymap&lt;-<span class="kw">tab_cont_iris</span>(data,codecom,list_mod,{{var}})</span>
<span id="cb169-11"><a href="21-cartography.html#cb169-11"></a> </span>
<span id="cb169-12"><a href="21-cartography.html#cb169-12"></a> myvar &lt;-<span class="st"> </span><span class="kw">paste</span>(<span class="st">&quot;count_&quot;</span>,mod, <span class="dt">sep=</span><span class="st">&quot;&quot;</span>)</span>
<span id="cb169-13"><a href="21-cartography.html#cb169-13"></a> </span>
<span id="cb169-14"><a href="21-cartography.html#cb169-14"></a> <span class="cf">if</span> (list_mod<span class="op">==</span><span class="dv">0</span>) {myleg =<span class="st"> &quot;nb. d&#39;habitants&quot;</span>} <span class="cf">else</span></span>
<span id="cb169-15"><a href="21-cartography.html#cb169-15"></a> {myleg =<span class="st"> &quot;nb de ménages&quot;</span>}</span>
<span id="cb169-16"><a href="21-cartography.html#cb169-16"></a> </span>
<span id="cb169-17"><a href="21-cartography.html#cb169-17"></a></span>
<span id="cb169-18"><a href="21-cartography.html#cb169-18"></a> </span>
<span id="cb169-19"><a href="21-cartography.html#cb169-19"></a><span class="kw">par</span>(<span class="dt">mar=</span><span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">2</span>,<span class="dv">0</span>))</span>
<span id="cb169-20"><a href="21-cartography.html#cb169-20"></a><span class="kw">plot</span>(mymap<span class="op">$</span>geometry, <span class="dt">col=</span><span class="st">&quot;lightyellow&quot;</span>, <span class="dt">border=</span><span class="st">&quot;gray80&quot;</span>,<span class="dt">lwd=</span><span class="fl">0.4</span>)</span>
<span id="cb169-21"><a href="21-cartography.html#cb169-21"></a><span class="kw">propSymbolsLayer</span>(<span class="dt">x =</span> mymap,</span>
<span id="cb169-22"><a href="21-cartography.html#cb169-22"></a>                 <span class="dt">var =</span> myvar,</span>
<span id="cb169-23"><a href="21-cartography.html#cb169-23"></a>                 <span class="dt">col=</span><span class="st">&quot;blue&quot;</span>,</span>
<span id="cb169-24"><a href="21-cartography.html#cb169-24"></a>                 <span class="dt">inches =</span> <span class="fl">0.06</span>,</span>
<span id="cb169-25"><a href="21-cartography.html#cb169-25"></a>                 <span class="dt">legend.title.txt =</span> myleg,</span>
<span id="cb169-26"><a href="21-cartography.html#cb169-26"></a>                 <span class="dt">legend.pos =</span> <span class="st">&quot;topright&quot;</span>)</span>
<span id="cb169-27"><a href="21-cartography.html#cb169-27"></a></span>
<span id="cb169-28"><a href="21-cartography.html#cb169-28"></a><span class="kw">layoutLayer</span>(<span class="dt">title =</span> titre,</span>
<span id="cb169-29"><a href="21-cartography.html#cb169-29"></a>            <span class="dt">author =</span> <span class="st">&quot;Master MECI / Option data mining&quot;</span>,</span>
<span id="cb169-30"><a href="21-cartography.html#cb169-30"></a>            <span class="dt">sources =</span> <span class="st">&quot;INSEE, RP 2017, fichiers détail&quot;</span>) </span>
<span id="cb169-31"><a href="21-cartography.html#cb169-31"></a>  </span>
<span id="cb169-32"><a href="21-cartography.html#cb169-32"></a>}</span></code></pre></div>
<p>On teste la fonction sur les ménages ayant plus de trois voitures à Sucy-en-Brie</p>
<div class="sourceCode" id="cb170"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb170-1"><a href="21-cartography.html#cb170-1"></a><span class="kw">map_count_iris</span>(<span class="dt">data =</span> RP,</span>
<span id="cb170-2"><a href="21-cartography.html#cb170-2"></a>               <span class="dt">codecom =</span> <span class="st">&quot;94071&quot;</span>,</span>
<span id="cb170-3"><a href="21-cartography.html#cb170-3"></a>               <span class="dt">list_mod =</span> <span class="st">&quot;1&quot;</span>,</span>
<span id="cb170-4"><a href="21-cartography.html#cb170-4"></a>               <span class="dt">var =</span> VOIT,</span>
<span id="cb170-5"><a href="21-cartography.html#cb170-5"></a>               <span class="dt">mod =</span> <span class="dv">3</span>,</span>
<span id="cb170-6"><a href="21-cartography.html#cb170-6"></a>               <span class="st">&quot;Ménages avec trois voitures ou plus&quot;</span>)</span></code></pre></div>
<pre><code>Joining, by = &quot;IRIS&quot;</code></pre>
<pre><code>Joining, by = &quot;CODE_IRIS&quot;</code></pre>
<p><img src="Projet-Data-Mining-2021_files/figure-html/unnamed-chunk-95-1.svg" width="672" /></p>
<p>On vérifie qu’elle marche également sur une autre commune comme Saint-Maur-des-Fossés (94068).</p>
<div class="sourceCode" id="cb173"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb173-1"><a href="21-cartography.html#cb173-1"></a><span class="kw">map_count_iris</span>(<span class="dt">data =</span> RP,</span>
<span id="cb173-2"><a href="21-cartography.html#cb173-2"></a>               <span class="dt">codecom =</span> <span class="st">&quot;94068&quot;</span>,</span>
<span id="cb173-3"><a href="21-cartography.html#cb173-3"></a>               <span class="dt">list_mod =</span> <span class="st">&quot;1&quot;</span>,</span>
<span id="cb173-4"><a href="21-cartography.html#cb173-4"></a>               <span class="dt">var =</span> VOIT,</span>
<span id="cb173-5"><a href="21-cartography.html#cb173-5"></a>               <span class="dt">mod =</span> <span class="dv">3</span>,</span>
<span id="cb173-6"><a href="21-cartography.html#cb173-6"></a>               <span class="st">&quot;Ménages avec trois voitures ou plus&quot;</span>)</span></code></pre></div>
<pre><code>Joining, by = &quot;IRIS&quot;</code></pre>
<pre><code>Joining, by = &quot;CODE_IRIS&quot;</code></pre>
<p><img src="Projet-Data-Mining-2021_files/figure-html/unnamed-chunk-96-1.svg" width="672" /></p>
<p>… ou bien sur une autre modalité d’une autre variable. Par exemple la distribution des ménages dont la personne de référence est ouvrier à Sucy-en-Brie</p>
<div class="sourceCode" id="cb176"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb176-1"><a href="21-cartography.html#cb176-1"></a><span class="kw">map_count_iris</span>(<span class="dt">data =</span> RP,</span>
<span id="cb176-2"><a href="21-cartography.html#cb176-2"></a>               <span class="dt">codecom =</span> <span class="st">&quot;94071&quot;</span>,</span>
<span id="cb176-3"><a href="21-cartography.html#cb176-3"></a>               <span class="dt">list_mod =</span> <span class="st">&quot;1&quot;</span>,</span>
<span id="cb176-4"><a href="21-cartography.html#cb176-4"></a>               <span class="dt">var =</span> CS1,</span>
<span id="cb176-5"><a href="21-cartography.html#cb176-5"></a>               <span class="dt">mod =</span> <span class="dv">6</span>,</span>
<span id="cb176-6"><a href="21-cartography.html#cb176-6"></a>               <span class="st">&quot;Ménages ouvriers en 2017&quot;</span>)</span></code></pre></div>
<pre><code>Joining, by = &quot;IRIS&quot;</code></pre>
<pre><code>Joining, by = &quot;CODE_IRIS&quot;</code></pre>
<p><img src="Projet-Data-Mining-2021_files/figure-html/unnamed-chunk-97-1.svg" width="672" /></p>
</div>
<div id="fonction-améliorée" class="section level4" number="3.3.2.3">
<h4><span class="header-section-number">3.3.2.3</span> Fonction améliorée</h4>
<p>Vous pouvez maintenant améliorer la fonction en lui ajoutant d’autres paramètres variables tels que :</p>
<ul>
<li>la source</li>
<li>l’auteur</li>
<li>la couleur de remplissage des cercles</li>
<li>la couleur d’arrière-plan des iris</li>
<li>le zoom d’aggrandissement des cercles</li>
<li>etc.</li>
</ul>
</div>
</div>
<div id="fonction-map_pct_iris" class="section level3" number="3.3.3">
<h3><span class="header-section-number">3.3.3</span> fonction map_pct_iris</h3>
<p>Nous allons maintenant préparer un pogramme pour cartographier une variable d’intensité (<em>pct_xx</em>) dont la somme n’a pas de sens et qui doit donc utiliser le mode cartographique zonal (carte choroplèthe).</p>
<div id="objectifs-1" class="section level4" number="3.3.3.1">
<h4><span class="header-section-number">3.3.3.1</span> Objectifs</h4>
<p>On prend comme entrée le tableau de contingence spatial qui a été transformé en profil en ligne avec des modalités de type <em>pct</em>. Comme nous allons devoir établir automatiquement des classes sans connaître la forme de la distribution, nous devons utiliser une solution robuste.</p>
<ul>
<li>La méthode des <strong>quantiles</strong> apparaît alors comme la plus adaptée puisqu’elle consiste à découper la distribution en classes d’effectifs égaux.</li>
<li>Concernant le <strong>nombre de classes</strong>, il doit dépendre du nombre d’éléments (ici d’IRIS) et nous allons utiliser pour cela la <strong>formule de Huntsberger</strong> qui indique le nombre maximum de classes souhaitable (K) en fonction du nombre d’élément (n).</li>
</ul>
<p><span class="math inline">\(K = 1 + \frac{10}{3}.log_{10}(x)\)</span></p>
<p>On définit à partir de là une carte-type en prenant l’exemple du % de ménages n’ayant pas de voiture à Sucy-en-Brie</p>
<div class="sourceCode" id="cb179"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb179-1"><a href="21-cartography.html#cb179-1"></a>huntsberger &lt;-<span class="st"> </span><span class="cf">function</span>(x) {<span class="kw">round</span>(<span class="dv">1</span><span class="op">+</span>(<span class="dv">10</span><span class="op">/</span><span class="dv">3</span>)<span class="op">*</span><span class="kw">log10</span>(x))}</span>
<span id="cb179-2"><a href="21-cartography.html#cb179-2"></a></span>
<span id="cb179-3"><a href="21-cartography.html#cb179-3"></a>map&lt;-<span class="kw">tab_cont_iris</span>(RP,<span class="st">&quot;94071&quot;</span>,<span class="st">&quot;0&quot;</span>,VOIT)</span></code></pre></div>
<pre><code>Joining, by = &quot;IRIS&quot;</code></pre>
<pre><code>Joining, by = &quot;CODE_IRIS&quot;</code></pre>
<div class="sourceCode" id="cb182"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb182-1"><a href="21-cartography.html#cb182-1"></a><span class="kw">par</span>(<span class="dt">mar=</span><span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">2</span>,<span class="dv">0</span>))</span>
<span id="cb182-2"><a href="21-cartography.html#cb182-2"></a>nbc&lt;-<span class="kw">huntsberger</span>(<span class="kw">nrow</span>(map))</span>
<span id="cb182-3"><a href="21-cartography.html#cb182-3"></a></span>
<span id="cb182-4"><a href="21-cartography.html#cb182-4"></a><span class="kw">choroLayer</span>(      <span class="dt">x =</span> map,</span>
<span id="cb182-5"><a href="21-cartography.html#cb182-5"></a>                 <span class="dt">nclass =</span> nbc,</span>
<span id="cb182-6"><a href="21-cartography.html#cb182-6"></a>                 <span class="dt">method =</span> <span class="st">&quot;quantile&quot;</span>,</span>
<span id="cb182-7"><a href="21-cartography.html#cb182-7"></a>                 <span class="dt">var =</span> <span class="st">&quot;pct_0&quot;</span>,</span>
<span id="cb182-8"><a href="21-cartography.html#cb182-8"></a>                 <span class="dt">legend.title.txt =</span> <span class="st">&quot;% ménages&quot;</span>,</span>
<span id="cb182-9"><a href="21-cartography.html#cb182-9"></a>                 <span class="dt">legend.pos =</span> <span class="st">&quot;topright&quot;</span>,</span>
<span id="cb182-10"><a href="21-cartography.html#cb182-10"></a>                 <span class="dt">legend.values.rnd =</span> <span class="dv">1</span>)</span>
<span id="cb182-11"><a href="21-cartography.html#cb182-11"></a></span>
<span id="cb182-12"><a href="21-cartography.html#cb182-12"></a><span class="kw">layoutLayer</span>(<span class="dt">title =</span> <span class="st">&quot;Ménages n&#39;ayant pas de voiture&quot;</span>,</span>
<span id="cb182-13"><a href="21-cartography.html#cb182-13"></a>            <span class="dt">author =</span> <span class="st">&quot;Master MECI / Option data mining&quot;</span>,</span>
<span id="cb182-14"><a href="21-cartography.html#cb182-14"></a>            <span class="dt">sources =</span> <span class="st">&quot;INSEE, RP 2017, fichiers détail&quot;</span>)</span></code></pre></div>
<p><img src="Projet-Data-Mining-2021_files/figure-html/unnamed-chunk-98-1.svg" width="672" /></p>
</div>
<div id="fonction-minimale-1" class="section level4" number="3.3.3.2">
<h4><span class="header-section-number">3.3.3.2</span> Fonction minimale</h4>
<p>On va maintenant créer une fonction ayant autant de paramètres que nécessaire pour pouvoir s’appliquer à n’importe quelle modalité de n’importe quelle variable. La fonction minimale devra comporter 5 paramètres</p>
<div class="sourceCode" id="cb183"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb183-1"><a href="21-cartography.html#cb183-1"></a>map_pct_iris &lt;-<span class="st"> </span><span class="cf">function</span> (  data,</span>
<span id="cb183-2"><a href="21-cartography.html#cb183-2"></a>                            codecom,</span>
<span id="cb183-3"><a href="21-cartography.html#cb183-3"></a>                            list_mod,</span>
<span id="cb183-4"><a href="21-cartography.html#cb183-4"></a>                            var,</span>
<span id="cb183-5"><a href="21-cartography.html#cb183-5"></a>                            mod,</span>
<span id="cb183-6"><a href="21-cartography.html#cb183-6"></a>                            titre)</span>
<span id="cb183-7"><a href="21-cartography.html#cb183-7"></a></span>
<span id="cb183-8"><a href="21-cartography.html#cb183-8"></a>{</span>
<span id="cb183-9"><a href="21-cartography.html#cb183-9"></a>  </span>
<span id="cb183-10"><a href="21-cartography.html#cb183-10"></a> mymap&lt;-<span class="kw">tab_cont_iris</span>(data,codecom,list_mod,{{var}})</span>
<span id="cb183-11"><a href="21-cartography.html#cb183-11"></a> </span>
<span id="cb183-12"><a href="21-cartography.html#cb183-12"></a> myvar &lt;-<span class="st"> </span><span class="kw">paste</span>(<span class="st">&quot;pct_&quot;</span>,mod, <span class="dt">sep=</span><span class="st">&quot;&quot;</span>)</span>
<span id="cb183-13"><a href="21-cartography.html#cb183-13"></a> </span>
<span id="cb183-14"><a href="21-cartography.html#cb183-14"></a> <span class="cf">if</span> (list_mod<span class="op">==</span><span class="dv">0</span>) {myleg =<span class="st"> &quot;% des habitants&quot;</span>} <span class="cf">else</span></span>
<span id="cb183-15"><a href="21-cartography.html#cb183-15"></a> {myleg =<span class="st"> &quot;% des ménages&quot;</span>}</span>
<span id="cb183-16"><a href="21-cartography.html#cb183-16"></a> </span>
<span id="cb183-17"><a href="21-cartography.html#cb183-17"></a></span>
<span id="cb183-18"><a href="21-cartography.html#cb183-18"></a> </span>
<span id="cb183-19"><a href="21-cartography.html#cb183-19"></a>huntsberger &lt;-<span class="st"> </span><span class="cf">function</span>(x) {<span class="kw">round</span>(<span class="dv">1</span><span class="op">+</span>(<span class="dv">10</span><span class="op">/</span><span class="dv">3</span>)<span class="op">*</span><span class="kw">log10</span>(x))}</span>
<span id="cb183-20"><a href="21-cartography.html#cb183-20"></a>nbc&lt;-<span class="kw">huntsberger</span>(<span class="kw">nrow</span>(map))</span>
<span id="cb183-21"><a href="21-cartography.html#cb183-21"></a></span>
<span id="cb183-22"><a href="21-cartography.html#cb183-22"></a><span class="kw">par</span>(<span class="dt">mar=</span><span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">2</span>,<span class="dv">0</span>))</span>
<span id="cb183-23"><a href="21-cartography.html#cb183-23"></a></span>
<span id="cb183-24"><a href="21-cartography.html#cb183-24"></a><span class="kw">choroLayer</span>(      <span class="dt">x =</span> mymap,</span>
<span id="cb183-25"><a href="21-cartography.html#cb183-25"></a>                 <span class="dt">var =</span> myvar,</span>
<span id="cb183-26"><a href="21-cartography.html#cb183-26"></a>                 <span class="dt">nclass =</span> nbc,</span>
<span id="cb183-27"><a href="21-cartography.html#cb183-27"></a>                 <span class="dt">method =</span> <span class="st">&quot;quantile&quot;</span>,</span>
<span id="cb183-28"><a href="21-cartography.html#cb183-28"></a>                 <span class="dt">legend.title.txt =</span> myleg,</span>
<span id="cb183-29"><a href="21-cartography.html#cb183-29"></a>                 <span class="dt">legend.pos =</span> <span class="st">&quot;topright&quot;</span>,</span>
<span id="cb183-30"><a href="21-cartography.html#cb183-30"></a>                 <span class="dt">legend.values.rnd =</span> <span class="dv">1</span>)</span>
<span id="cb183-31"><a href="21-cartography.html#cb183-31"></a></span>
<span id="cb183-32"><a href="21-cartography.html#cb183-32"></a><span class="kw">layoutLayer</span>(<span class="dt">title =</span> titre,</span>
<span id="cb183-33"><a href="21-cartography.html#cb183-33"></a>            <span class="dt">author =</span> <span class="st">&quot;Master MECI / Option data mining&quot;</span>,</span>
<span id="cb183-34"><a href="21-cartography.html#cb183-34"></a>            <span class="dt">sources =</span> <span class="st">&quot;INSEE, RP 2017, fichiers détail&quot;</span>)</span>
<span id="cb183-35"><a href="21-cartography.html#cb183-35"></a></span>
<span id="cb183-36"><a href="21-cartography.html#cb183-36"></a></span>
<span id="cb183-37"><a href="21-cartography.html#cb183-37"></a>}</span></code></pre></div>
<p>On teste la fonction sur les ménages ayant plus de trois voitures à Sucy-en-Brie</p>
<div class="sourceCode" id="cb184"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb184-1"><a href="21-cartography.html#cb184-1"></a><span class="kw">map_pct_iris</span>(<span class="dt">data =</span> RP,</span>
<span id="cb184-2"><a href="21-cartography.html#cb184-2"></a>               <span class="dt">codecom =</span> <span class="st">&quot;94071&quot;</span>,</span>
<span id="cb184-3"><a href="21-cartography.html#cb184-3"></a>               <span class="dt">list_mod =</span> <span class="st">&quot;1&quot;</span>,</span>
<span id="cb184-4"><a href="21-cartography.html#cb184-4"></a>               <span class="dt">var =</span> VOIT,</span>
<span id="cb184-5"><a href="21-cartography.html#cb184-5"></a>               <span class="dt">mod =</span> <span class="dv">3</span>,</span>
<span id="cb184-6"><a href="21-cartography.html#cb184-6"></a>               <span class="st">&quot;Ménages avec trois voitures ou plus&quot;</span>)</span></code></pre></div>
<pre><code>Joining, by = &quot;IRIS&quot;</code></pre>
<pre><code>Joining, by = &quot;CODE_IRIS&quot;</code></pre>
<p><img src="Projet-Data-Mining-2021_files/figure-html/unnamed-chunk-100-1.svg" width="672" /></p>
<p>On vérifie qu’elle marche également sur une autre commune comme Saint-Maur-des-Fossés (94068).</p>
<div class="sourceCode" id="cb187"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb187-1"><a href="21-cartography.html#cb187-1"></a><span class="kw">map_pct_iris</span>(<span class="dt">data =</span> RP,</span>
<span id="cb187-2"><a href="21-cartography.html#cb187-2"></a>               <span class="dt">codecom =</span> <span class="st">&quot;94068&quot;</span>,</span>
<span id="cb187-3"><a href="21-cartography.html#cb187-3"></a>               <span class="dt">list_mod =</span> <span class="st">&quot;1&quot;</span>,</span>
<span id="cb187-4"><a href="21-cartography.html#cb187-4"></a>               <span class="dt">var =</span> VOIT,</span>
<span id="cb187-5"><a href="21-cartography.html#cb187-5"></a>               <span class="dt">mod =</span> <span class="dv">3</span>,</span>
<span id="cb187-6"><a href="21-cartography.html#cb187-6"></a>               <span class="st">&quot;Ménages avec trois voitures ou plus&quot;</span>)</span></code></pre></div>
<pre><code>Joining, by = &quot;IRIS&quot;</code></pre>
<pre><code>Joining, by = &quot;CODE_IRIS&quot;</code></pre>
<p><img src="Projet-Data-Mining-2021_files/figure-html/unnamed-chunk-101-1.svg" width="672" /></p>
<p>… ou bien sur une autre modalité d’une autre variable. Par exemple la distribution des ménages dont la personne de référence est ouvrier à Sucy-en-Brie</p>
<div class="sourceCode" id="cb190"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb190-1"><a href="21-cartography.html#cb190-1"></a><span class="kw">map_pct_iris</span>(<span class="dt">data =</span> RP,</span>
<span id="cb190-2"><a href="21-cartography.html#cb190-2"></a>               <span class="dt">codecom =</span> <span class="st">&quot;94071&quot;</span>,</span>
<span id="cb190-3"><a href="21-cartography.html#cb190-3"></a>               <span class="dt">list_mod =</span> <span class="st">&quot;1&quot;</span>,</span>
<span id="cb190-4"><a href="21-cartography.html#cb190-4"></a>               <span class="dt">var =</span> CS1,</span>
<span id="cb190-5"><a href="21-cartography.html#cb190-5"></a>               <span class="dt">mod =</span> <span class="dv">6</span>,</span>
<span id="cb190-6"><a href="21-cartography.html#cb190-6"></a>               <span class="st">&quot;Ménages ouvriers en 2017&quot;</span>)</span></code></pre></div>
<pre><code>Joining, by = &quot;IRIS&quot;</code></pre>
<pre><code>Joining, by = &quot;CODE_IRIS&quot;</code></pre>
<p><img src="Projet-Data-Mining-2021_files/figure-html/unnamed-chunk-102-1.svg" width="672" /></p>
</div>
<div id="fonction-améliorée-1" class="section level4" number="3.3.3.3">
<h4><span class="header-section-number">3.3.3.3</span> Fonction améliorée</h4>
<p>Vous pouvez maintenant améliorer la fonction en lui ajoutant d’autres paramètres variables tels que :</p>
<ul>
<li>la source</li>
<li>l’auteur</li>
<li>la palette de couleur</li>
<li>le nombre de classes</li>
<li>le mode de découpage des classes</li>
<li>etc.</li>
</ul>
</div>
</div>
<div id="sauvegarde-des-fonctions" class="section level3" number="3.3.4">
<h3><span class="header-section-number">3.3.4</span> Sauvegarde des fonctions</h3>
<p>On sauvegarde les nouvelles fonctions dans un nouveau fichier <em>mes_fonctions_V2.R</em> qui comporte les fonctions statistiques précédents et les nouvelles fonctions cartographiques mises au point dans ce chapitre.</p>

</div>
</div>
</div>






<script src="js/tidyverse.js"></script>
            </section>

          </div>
        </div>
      </div>
<a href="12-statistics.html" class="navigation navigation-prev navigation-unique" aria-label="Previous page"><i class="fa fa-angle-left"></i></a>

    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": false,
"twitter": false,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"],
"instapper": false
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/ClaudeGrasland/DataMiningProject2021/blob/master/21-cartography.Rmd",
"text": "Source"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "section"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
